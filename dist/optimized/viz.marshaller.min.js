(function(e,t){typeof define=="function"&&define.amd?define("marshaller/HipieDDL.js",["../other/Comms","../common/Widget"],t):e.marshaller_HipieDDL=t(e.other_Comms,e.common_Widget)})(this,function(e,t){function s(e,t){this.visualization=e,this.mappings=t,this.hasMappings=!1,this.reverseMappings={},this.columns=[],this.columnsIdx={},this.columnsRHS=[],this.columnsRHSIdx={}}function o(e,t){s.call(this,e,t),this.columns=["label","weight"],this.columnsIdx={label:0,weight:1},this.init()}function u(e,t){s.call(this,e,t),t.state?(this.columns=["state","weight"],this.columnsIdx={state:0,weight:1}):t.county&&(this.columns=["county","weight"],this.columnsIdx={county:0,weight:1}),this.init()}function a(e,t){var n={label:t.x[0]};t.y.forEach(function(e,t){n[e]=e}),s.call(this,e,n),this.init()}function f(e,t){var n={};for(var r in t)t[r].forEach(function(t,r){n[e.label[r]]=t});s.call(this,e,n),this.init()}function l(e,t,n){s.call(this,e,t),this.columns=["uid","label","weight","flags"],this.columnsIdx={uid:0,label:1,weight:2,flags:3},this.init(),this.link=n}function c(e,t){this.visualization=e,this._id=t.id,this._output=t.output,this.mappings=null;switch(this.visualization.type){case"LINE":this.mappings=new a(this.visualization,t.mappings);break;case"TABLE":this.mappings=new f(this.visualization,t.mappings);break;case"GRAPH":this.mappings=new l(this.visualization,t.mappings,t.link);break;case"CHORO":this.mappings=new u(this.visualization,t.mappings,t.link);break;default:this.mappings=new o(this.visualization,t.mappings)}this.first=t.first,this.reverse=t.reverse,this.sort=t.sort}function h(e,t){this.visualization=e,t&&(this._updates=t.updates,this.mappings=t.mappings)}function p(e,t){this.dashboard=e,this.id=t.id,this.label=t.label,this.title=t.title||t.id,this.type=t.type,this.properties=t.properties||t.source.properties||{},this.source=new c(this,t.source),this.onSelect=new h(this,t.onSelect);var i=this;switch(this.type){case"CHORO":this.loadWidget(this.source.mappings.contains("county")?"src/map/ChoroplethCounties":"src/map/ChoroplethStates",function(e){e.id(t.id)});break;case"2DCHART":case"PIE":case"BUBBLE":case"BAR":case"WORD_CLOUD":this.loadWidget("src/chart/MultiChart",function(e){e.id(t.id).chart_type(i.properties.charttype||i.type)});break;case"LINE":this.loadWidget("src/chart/MultiChart",function(e){e.id(t.id).chart_type(i.properties.charttype||i.type)});break;case"TABLE":this.loadWidget("src/other/Table",function(e){e.id(t.id).columns(i.label)});break;case"SLIDER":this.loadWidget("src/other/Slider",function(e){e.id(t.id);if(t.range){var n="";for(var r in t.onSelect.mappings){n=r;break}e.low(+t.range[0]).high(+t.range[1]).step(+t.range[2]).selectionLabel(n)}});break;case"GRAPH":this.loadWidgets(["src/graph/Graph","src/graph/Vertex","src/graph/Edge"],function(e,i){n=i[1],r=i[2],e.id(t.id).layout("ForceDirected2").shrinkToFitOnLayout(!0)});break;default:this.loadWidget("src/common/TextBox",function(e){e.id(t.id).text(i.id+"\n"+"TODO:  "+i.type)})}}function d(e,t){this.dataSource=e,this.id=t.id,this.from=t.from,this.request={},this.notify=t.notify||[],this.filter=t.filter||[]}function v(t,n,r){this.dashboard=t,this.id=n.id,this.filter=n.filter||[],this.WUID=n.WUID,this.URL=n.URL,this.databomb=n.databomb,this.request={};var i=this;this.outputs={};var s=[];n.outputs.forEach(function(e){i.outputs[e.id]=new d(i,e),s.push({id:e.id,from:e.from,filter:e.filter||this.filter})},this),this.WUID?this.comms=(new e.HIPIEWorkunit).url(t.marshaller.espUrl._url).proxyMappings(r).hipieResults(s):this.databomb?this.comms=(new e.HIPIEDatabomb).hipieResults(s):this.comms=(new e.HIPIERoxie).url(n.URL).proxyMappings(r)}function m(e,t,n){this.marshaller=e,this.id=t.id,this.title=t.title;var r=this;this.datasources={},this.datasourceTotal=0,t.datasources.forEach(function(e){r.datasources[e.id]=new v(r,e,n),++r.datasourceTotal}),this.visualizations={},this.visualizationsArray=[],t.visualizations.forEach(function(e){var t=new p(r,e);r.visualizations[e.id]=t,r.visualizationsArray.push(t)}),this.visualizationTotal=this.visualizationsArray.length;var i={};this.visualizationsTree=[];var s=function(e,t){if(e&&!i[e.id]){i[e.id]=!0;var n={visualization:e,children:[]};t.push(n);var r=e.onSelect.getUpdatesVisualizations();r.forEach(function(e){s(e,n.children)})}};this.visualizationsArray.forEach(function(e){s(e,this.visualizationsTree)},this)}function g(){this._proxyMappings={}}var n=null,r=null,i=function(e,t){var n=e.split("."),r=t;for(var i=0;i<n.length;++i){var s=n[i];if(!r||r[s]===undefined)return!1;r=r[s]}return!0};return s.prototype.init=function(){for(var e in this.mappings)this.reverseMappings[this.mappings[e]]=e,this.columnsIdx[e]===undefined&&(this.columns.push(e),this.columnsIdx[e]=this.columns.length-1),this.columnsRHS[this.columnsIdx[e]]=this.mappings[e],this.columnsRHSIdx[this.mappings[e]]=this.columnsIdx[e],this.hasMappings=!0},s.prototype.contains=function(e){return this.mappings[e]!==undefined},s.prototype.doMap=function(e){var t=[];try{for(var n in this.mappings){var r=this.mappings[n],i=e[r];i===undefined&&(i=e[r.toLowerCase()]),t[this.columnsIdx[n]]=i}}catch(s){console.log("Invalid Mappings")}return t},s.prototype.doMapAll=function(e){var t=this;return e.map(function(e){return t.doMap(e)})},s.prototype.getMap=function(e){return this.mappings[e]},s.prototype.getReverseMap=function(e){return this.reverseMappings[e]},o.prototype=Object.create(s.prototype),u.prototype=Object.create(s.prototype),a.prototype=Object.create(s.prototype),f.prototype=Object.create(s.prototype),l.prototype=Object.create(s.prototype),l.prototype.doMapAll=function(e){function o(e){var t="uid_"+e[0],r=i[t];return r||(r=(new n).faChar("ï„¨").text(e[1]),r.__hpcc_uid=e[0],i[t]=r,s.push(r)),r}var t=this,i={},s=[],u=[];return e.forEach(function(e){var n=t.doMap(e),i=o(n);if(e[t.link.childfile]&&e[t.link.childfile].Row){var s=e[t.link.childfile].Row;s.forEach(function(e,n){var s=t.doMap(e),a=o(s);if(i.id()!==a.id()){var f=(new r).sourceVertex(i).targetVertex(a).sourceMarker("circleFoot").targetMarker("arrowHead");u.push(f)}})}}),{vertices:s,edges:u,merge:!1}},c.prototype.getQualifiedID=function(){return this.visualization.getQualifiedID()+"."+this.id},c.prototype.exists=function(){return this._id},c.prototype.getDatasource=function(){return this.visualization.dashboard.datasources[this._id]},c.prototype.getOutput=function(){var e=this.getDatasource();return e&&e.outputs?e.outputs[this._output]:null},c.prototype.hasData=function(){return this.getOutput().data?!0:!1},c.prototype.getColumns=function(){return this.mappings.columns},c.prototype.getData=function(){var e=this,t=this.getOutput().data;if(this.sort){var e=this;t.sort(function(t,n){for(var r=0;r<e.sort.length;++r){var i=e.sort[r],s=!1;i.indexOf("-")===0&&(i=i.substring(1),s=!0);var o=t[i];o===undefined&&(o=t[i.toLowerCase()]);var u=n[i];u===undefined&&(u=n[i.toLowerCase()]);if(o!==u)return s?u-o:o-u}return 0})}return this.reverse&&t.reverse(),this.first&&t.length>this.first&&(t.length=this.first),this.mappings.doMapAll(t)},h.prototype.exists=function(){return this._updates!==undefined},h.prototype.getUpdatesDatasources=function(){var e={},t=[];return i("_updates",this)&&this._updates instanceof Array?this._updates.forEach(function(n,r){var i=this.visualization.dashboard.datasources[n.datasource];e[i.id]||(e[i.id]=!0,t.push(i))},this):i("_updates.datasource",this)&&t.push(this.visualization.dashboard.datasources[this._updates.datasource]),t},h.prototype.getUpdatesVisualizations=function(){var e={},t=[];return i("_updates",this)&&this._updates instanceof Array?this._updates.forEach(function(n,r){var i=this.visualization.dashboard.visualizations[n.visualization];e[i.id]||(e[i.id]=!0,t.push(i))},this):i("_updates.visualization",this)&&t.push(this.visualization.dashboard.visualizations[this._updates.visualization]),t},p.prototype.getQualifiedID=function(){return this.dashboard.getQualifiedID()+"."+this.id},p.prototype.isLoading=function(e,t){return this.widget===null},p.prototype.isLoaded=function(e,n){return this.widget instanceof t},p.prototype.loadWidget=function(e,t){this.loadWidgets([e],t)},p.prototype.loadWidgets=function(e,t){this.widget=null;var n=this;require(e,function(e){n.setWidget(new e),t&&t(n.widget,arguments)})},p.prototype.setWidget=function(e,t){this.widget=e;var n=this;this.widget.vertex_dblclick?this.widget.vertex_dblclick=function(e){n.click({uid:e.__hpcc_uid})}:this.widget.click&&(this.widget.click=function(e){n.click(e)});if(!t)for(var r in this.properties)if(this.widget[r])try{this.widget[r](this.properties[r])}catch(i){console.log("Invalid Property:"+this.id+".properties."+r)}return this.widget},p.prototype.accept=function(e){e.visit(this)},p.prototype.notify=function(){var e=this;if(this.source.hasData()&&this.widget){var t=this.source.getColumns();this.widget.columns(t);var n=this.source.getData();this.dashboard.marshaller.updateViz(this,n),this.widget.data(n);var r=this.source.getOutput().getParams();i("widget.title",this)?(this.widget.title(this.title+(r?" ("+r+")":"")),this.widget.render()):i("widgetSurface.title",this)?(this.widgetSurface.title(this.title+(r?" ("+r+")":"")),this.widgetSurface.render()):this.widget.render()}},p.prototype.click=function(e){if(this.onSelect.exists()){var t={};for(var n in this.onSelect.mappings){var r=this.source.mappings.hasMappings?this.source.mappings.getReverseMap(n):n;t[this.onSelect.mappings[n]]=e[r]}var i=this.onSelect.getUpdatesDatasources();i.forEach(function(e){e.fetchData(t)})}},d.prototype.getQualifiedID=function(){return this.dataSource.getQualifiedID()+"."+this.id},d.prototype.getParams=function(){var e="";for(var t in this.request)e.length&&(e+=", "),e+=this.request[t];return e},d.prototype.accept=function(e){e.visit(this)},d.prototype.setData=function(e,t){var n=this;this.request=t,this.data=e,this.notify.forEach(function(e){var t=n.dataSource.dashboard.visualizations[e];t.notify()})},v.prototype.getQualifiedID=function(){return this.dashboard.getQualifiedID()+"."+this.id},v.prototype.accept=function(e){e.visit(this);for(var t in this.outputs)this.outputs[t].accept(e)},v.prototype.fetchData=function(e,t){var n=this;this.request.refresh=t?!0:!1,this.filter.forEach(function(e){n.request[e+"_changed"]=!1});for(var r in e)this.request[r]=e[r],this.request[r+"_changed"]=!0;this.comms.call(this.request,function(t){n.processResponse(t,e)})},v.prototype.processResponse=function(e,t){var n={};for(var r in e)n[r.toLowerCase()]=e[r];for(var r in this.outputs){var s=this.outputs[r].from;s||(s=this.outputs[r].id.toLowerCase()),i(s,e)&&(!i(s+"_changed",e)||i(s+"_changed",e)&&e[s+"_changed"].length&&e[s+"_changed"][0][s+"_changed"])?this.outputs[r].setData(e[s],t):i(s,n)&&(console.log("DDL 'DataSource.From' case is Incorrect"),this.outputs[r].setData(n[s],t))}},m.prototype.getQualifiedID=function(){return this.id},m.prototype.accept=function(e){e.visit(this);for(var t in this.datasources)this.datasources[t].accept(e);this.visualizationsArray.forEach(function(t){t.accept(e)},this)},m.prototype.allVisualizationsLoaded=function(){var e=this.visualizationsArray.filter(function(e){return!e.isLoaded()});return e.length===0},g.prototype.accept=function(e){e.visit(this),this.dashboardTotal=0;for(var t in this.dashboards)this.dashboards[t].accept(e),++this.dashboardTotal},g.prototype.url=function(t,n){this.espUrl=(new e.ESPUrl).url(t);var r=null,s="HIPIE_DDL";this.espUrl.isWorkunitResult()?(s=this.espUrl._params.ResultName,r=(new e.HIPIEWorkunit).url(t).proxyMappings(this._proxyMappings)):r=(new e.HIPIERoxie).url(t).proxyMappings(this._proxyMappings);var o={refresh:!1},u=this;r.call(o,function(e){i(s,e)&&r.fetchResult(s,function(r){var i=r[0][s],o=i.split("<RoxieBase>\\");if(o.length>1){var a=o[1].indexOf('"');o[1]=o[1].substring(a),i=o.join(t)}u.parse(i,function(){n(e)})})})},g.prototype.proxyMappings=function(e){return arguments.length?(this._proxyMappings=e,this):this._proxyMappings},g.prototype.parse=function(e,t){var n=this;return this._json=e,this._jsonParsed=JSON.parse(this._json),this.dashboards={},this.dashboardArray=[],this._jsonParsed.forEach(function(e){var t=new m(n,e,n._proxyMappings);n.dashboards[e.id]=t,n.dashboardArray.push(t)}),this.ready(t),this},g.prototype.allDashboardsLoaded=function(){return this.dashboardArray.filter(function(e){return!e.allVisualizationsLoaded()}).length===0},g.prototype.ready=function(e){function n(e){t.allDashboardsLoaded()?e():setTimeout(n,100,e)}if(!e)return;var t=this;n(e)},g.prototype.updateViz=function(e,t){},{exists:i,Marshaller:g,Dashboard:m,DataSource:v,Output:d,Visualization:p}}),function(e,t){typeof define=="function"&&define.amd?define("marshaller/Graph.js",["d3/d3","../common/SVGWidget","../common/TextBox","../common/Surface","../common/ResizeSurface","../chart/MultiChartSurface","../common/Palette","../graph/Graph","../graph/Vertex","../graph/Edge","./HipieDDL"],t):e.marshaller_Graph=t(e.d3,e.common_SVGWidget,e.common_TextBox,e.common_Surface,e.common_ResizeSurface,e.chart_MultiChartSurface,e.common_Palette,e.graph_Graph,e.graph_Vertex,e.graph_Edge,e.marshaller_HipieDDL)}(this,function(e,t,n,r,i,s,o,u,a,f,l){function c(e,t,s){function h(e,t,n,r,i,s){r=r||"",i=i||"",s=s||"",t&&n&&e.vertexMap[t]&&e.vertexMap[n]?e.edges.push((new f).sourceVertex(e.vertexMap[t]).targetVertex(e.vertexMap[n]).sourceMarker(r).targetMarker(i).text(s)):(e.vertexMap[t]||console.log("Unknown Vertex:  "+t),e.vertexMap[n]||console.log("Unknown Vertex:  "+n))}t instanceof Object||t&&(t=JSON.parse(t));var u=null,c={};return e.accept({_visualizeRoxie:s,visit:function(e){if(e instanceof l.Dashboard)u={dashboard:e,vertexMap:{},edges:[]},c[e.getQualifiedID()]=u;else if(e instanceof l.DataSource){e.databomb&&t[e.id]&&e.comms.databomb(t[e.id]);if(this._visualizeRoxie){var s="";e.filter.forEach(function(e){s.length>0&&(s+=", "),s+=e}),s=" ("+s+")",u.vertexMap[e.getQualifiedID()]=(new a).class("vertexLabel").faChar("ï‡€").text(e.id+s)}}else if(e instanceof l.Output)this._visualizeRoxie&&(u.vertexMap[e.getQualifiedID()]=(new a).class("vertexLabel").faChar("ïƒŽ").text(e.id+"\n["+e.from+"]"));else if(e instanceof l.Visualization&&e.widget){var f=null;if(e.widget instanceof r)f=e.widget.size({width:210,height:210});else if(e.widget instanceof n)f=e.widget;else{var h=280,p=210;e.type==="GRAPH"&&(h=800,p=600),f=(new i).size({width:h,height:p}).title(e.title).content(e.widget)}if(f){e.widgetSurface=f,u.vertexMap[e.getQualifiedID()]=f;switch(e.type){case"2DCHART":case"PIE":case"BUBBLE":case"BAR":case"WORD_CLOUD":f.menu(e.widget._2dChartTypes.concat(e.widget._anyChartTypes).map(function(e){return e.display}).sort()),f._menu.click=function(t){e.widget.chart_type(t).render()};break;case"LINE":f.menu(e.widget._multiChartTypes.concat(e.widget._anyChartTypes).map(function(e){return e.display}).sort()),f._menu.click=function(t){e.widget.chart_type(t).render()};break;case"CHORO":f._menu.data(o.rainbow()),f._menu.click=function(e){f._content.paletteID(e).render(e)};break;case"GRAPH":f._menu.data(["Circle","ForceDirected","ForceDirected2","Hierarchy"]),f._menu.click=function(e){f._content.layout(e)}}}}}}),u=null,e.accept({_visualizeRoxie:s,visit:function(e){e instanceof l.Dashboard?u=c[e.getQualifiedID()]:e instanceof l.DataSource||(e instanceof l.Output?this._visualizeRoxie&&h(u,e.dataSource.getQualifiedID(),e.getQualifiedID(),"circleFoot","circleHead"):e instanceof l.Visualization&&(this._visualizeRoxie&&(e.source.getDatasource()&&h(u,e.getQualifiedID(),e.source.getDatasource().getQualifiedID(),"","arrowHead","update"),e.source.getOutput()&&h(u,e.source.getOutput().getQualifiedID(),e.getQualifiedID(),"","arrowHead","notify")),e.onSelect.getUpdatesVisualizations().forEach(function(t){h(u,e.getQualifiedID(),t.getQualifiedID(),undefined,"arrowHead","on Select")})))}}),c}function p(){u.call(this),this._class="marshaller_Graph",this._design_mode=!1,this._dashboards=[],this.graphAttributes=["snapToGrid","showEdges"],this.widgetAttributes=["layout","chartType","palette","title","columns","data"]}var h=2;return p.prototype=Object.create(u.prototype),p.prototype.publish("ddl_url","","string","DDL URL"),p.prototype.publish("databomb","","string","Data Bomb"),p.prototype.publish("proxy_mappings",[],"array","Proxy Mappings"),p.prototype.publish("visualize_roxie",!1,"boolean","Show Roxie Data Sources"),p.prototype.publish(),p.prototype.testData=function(){return this.ddl_url("http://10.173.147.1:8002/WsEcl/submit/query/roxie/drealeed_testaddressclean.ins002_service/json"),this},p.prototype.design_mode=function(e){return arguments.length?(this._design_mode=e,this.showEdges(this._designMode).snapToGrid(this._designMode?12:0).allowDragging(this._designMode),this._data.vertices&&this._data.vertices.forEach(function(e){e.show_title(this._design_mode).render()},this),this):this._design_mode},p.prototype.dashboards=function(e){return arguments.length?(this._dashboards=e,this):this._dashboards},p.prototype.title=function(){var e="";return this._dashboards.forEach(function(t){e&&(e+=", "),e+=t.dashboard.title}),e},p.prototype.renderDashboards=function(e){this.data({vertices:[],edges:[]});var t=this,n=[],r=[];for(var i in this._dashboards){for(var s in this._dashboards[i].vertexMap)n.push(this._dashboards[i].vertexMap[s]);r=r.concat(this._dashboards[i].edges)}this.data({vertices:n,edges:r});var o=e?this.load():{changed:!1,dataChanged:!1};return o.changed&&this.layout(""),o.dataChanged||this.fetchData(),this},p.prototype.fetchData=function(){for(var e in this._dashboards){var t=this._dashboards[e].dashboard;for(var e in t.datasources)t.datasources[e].fetchData({},!0)}return this},p.prototype.checksum=function(e){var t=0,n=e.length,r,i;if(n===0)return t;for(r=0;r<n;r++)i=e.charCodeAt(r),t=(t<<5)-t+i,t&=t;return t},p.prototype.calcHash=function(){var e=this,t=h;for(var n in this._dashboards){var r=this._dashboards[n].dashboard;r.accept({visit:function(n){n instanceof l.Visualization&&(t+=e.checksum(n.getQualifiedID()))}})}return t},p.prototype.clear=function(){localStorage.setItem("Graph_"+this.calcHash(),"")},p.prototype.serialize=function(e,t){e=e||[],t=t||[];var n={};n.zoom={translation:this.zoom.translate(),scale:this.zoom.scale()},e.forEach(function(e){this[e]&&(n[e]=this[e]())},this);for(var r in this._dashboards){var i=this._dashboards[r].dashboard,s=i.getQualifiedID();n[s]={},i.accept({visit:function(e){if(e instanceof l.Visualization&&e.widgetSurface){var r={pos:e.widgetSurface.pos(),size:e.widgetSurface.size()};t.forEach(function(t){e.widget[t]?r[t]=e.widget[t]():e.widgetSurface[t]&&(r[t]=e.widgetSurface[t]())}),n[s][e.getQualifiedID()]=r}}})}return JSON.stringify(n)},p.prototype.save=function(){localStorage.setItem("Graph_"+this.calcHash(),this.serialize(this.graphAttributes,this.widgetAttributes))},p.prototype.deserialize=function(e,t,n){t=t||[],n=n||[];var r=!1,i=!1;t.forEach(function(t){this[t]&&e[t]!==undefined&&this[t](e[t])},this),e.zoom&&(this.setZoom(e.zoom.translation,e.zoom.scale),r=!0);for(var s in this._dashboards){var o=this._dashboards[s].dashboard,u=o.getQualifiedID();o.accept({visit:function(t){if(t instanceof l.Visualization&&e[u]&&e[u][t.getQualifiedID()]){var s=e[u][t.getQualifiedID()];t.widgetSurface.pos(s.pos).size(s.size),r=!0,n.forEach(function(e){t.widget[e]&&s[e]!==undefined?(t.widget[e](s[e]),e==="data"&&(i=!0)):t.widgetSurface[e]&&s[e]&&t.widgetSurface[e](s[e])})}}})}return{changed:r,dataChanged:i}},p.prototype.load=function(){var e={changed:!1,dataChanged:!1},t=localStorage.getItem("Graph_"+this.calcHash());return t&&(e=this.deserialize(JSON.parse(t),this.graphAttributes,this.widgetAttributes)),e},p.prototype.enter=function(e,t){u.prototype.enter.apply(this,arguments),t.classed("graph_Graph",!0)},p.prototype.update=function(e,t){u.prototype.update.apply(this,arguments)},p.prototype.render=function(e){function i(){var r=c(t,n._databomb,n._visualize_roxie);n.dashboards(r),n.shrinkToFitOnLayout(!0).layout("Hierarchy").renderDashboards(!0),u.prototype.render.call(n,function(t){e&&e(t)})}if(this._ddl_url===""||this._ddl_url===this._prev_ddl_url)return u.prototype.render.apply(this,arguments);this._prev_ddl_url=this._ddl_url;var t=(new l.Marshaller).proxyMappings(this._proxy_mappings),n=this,r=arguments;return this._ddl_url[0]==="["||this._ddl_url[0]==="{"?t.parse(this._ddl_url,function(){i()}):t.url(this._ddl_url,function(){i()}),this},p}),function(e,t){typeof define=="function"&&define.amd?define("marshaller/HTML.js",["d3/d3","../layout/Grid","./HipieDDL","../layout/Surface","../layout/Cell"],t):e.marshaller_HTML=t(e.d3,e.layout_Grid,e.marshaller_HipieDDL,e.layout_Surface,e.layout_Cell)}(this,function(e,t,n,r,i){function s(){t.call(this),this._class="marshaller_HTML"}function o(e,t){t instanceof Object||t&&(t=JSON.parse(t));var r=null,i={};return e.accept({visit:function(e){e instanceof n.Dashboard?(r={dashboard:e,visualizations:[]},i[e.getQualifiedID()]=r):e instanceof n.DataSource?e.databomb&&t[e.id]&&e.comms.databomb(t[e.id]):e instanceof n.Output||e instanceof n.Visualization&&e.widget&&r.visualizations.push(e)}}),i}return s.prototype=Object.create(t.prototype),s.prototype.publish("ddl_url","","string","DDL URL"),s.prototype.publish("proxy_mappings",[],"array","Proxy Mappings"),s.prototype.publish("databomb","","string","Data Bomb"),s.prototype.testData=function(){return this},s.prototype.content=function(){return t.prototype.content.apply(this,arguments)},s.prototype.setContent=function(e,n,r,i,s,o){return t.prototype.setContent.apply(this,arguments)},s.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments)},s.prototype.render=function(e){function u(){var n=o(r,i._databomb),s=0;for(var u in n){var a=0,f=0,l=Math.floor(Math.sqrt(n[u].visualizations.length));n[u].visualizations.forEach(function(e,t){t&&t%l===0&&(a++,f=0),e.widget.size({width:0,height:0});var n=i.getContent(e.widget._id);if(n)e.setWidget(n,!0);else{var r=0;i.setContent(a,f,e.widget,e.title)}f++});for(var c in n[u].dashboard.datasources)n[u].dashboard.datasources[c].fetchData({},!0)}t.prototype.render.call(i,function(t){e&&e(t)})}if(this._ddl_url===""||this._ddl_url===this._prev_ddl_url)return t.prototype.render.apply(this,arguments);this._prev_ddl_url=this._ddl_url;var r=(new n.Marshaller).proxyMappings(this._proxy_mappings),i=this,s=arguments;return this._ddl_url[0]==="["||this._ddl_url[0]==="{"?r.parse(this._ddl_url,function(){u()}):r.url(this._ddl_url,function(){u()}),this},s});