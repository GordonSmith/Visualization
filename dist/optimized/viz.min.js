(function(e,t){typeof define=="function"&&define.amd?define("common/Widget.js",["d3/d3","require"],t):e.common_Widget=t(e.d3)})(this,function(e,t){function s(){this._id="_w"+r++,this._class="",this._columns=[],this._data=[],this._pos={x:0,y:0},this._size={width:0,height:0},this._scale=1,this._target=null,this._parentElement=null,this._parentWidget=null,this._element=e.select(),this._watchArr=[],this._renderCount=0}var n=this,r=0,i={};return s.prototype.ieVersion=function(){var e=navigator.userAgent,t,n=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?(t=/\brv[ :]+(\d+)/g.exec(e)||[],parseFloat(t[1])):/msie/i.test(n[1])?parseFloat(n[2]):null}(),s.prototype.isIE=s.prototype.ieVersion!==null,s.prototype.svgMarkerGlitch=s.prototype.isIE&&s.prototype.ieVersion<=12,s.prototype.MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver||function(e){this.callback=e,this.listeners=[];var t=function(e,t,n){this.callback=e,this.domNode=t,this.type=n};t.prototype={handleEvent:function(e){var t={type:this.type,target:this.domNode,addedNodes:[],removedNodes:[],previousSibling:e.target.previousSibling,nextSibling:e.target.nextSibling,attributeName:null,attributeNamespace:null,oldValue:null};this.callback([t])}},this.observe=function(e,n){if(n.attributes){var r=new t(this.callback,e,"attributes");this.listeners.push(r),e.addEventListener("DOMAttrModified",r,!0)}if(n.characterData){var r=new t(this.callback,e,"characterData");this.listeners.push(r),e.addEventListener("DOMCharacterDataModified",r,!0)}if(n.childList){var r=new t(this.callback,e,"childList");this.listeners.push(r),e.addEventListener("DOMNodeInserted",r,!0),e.addEventListener("DOMNodeRemoved",r,!0)}},this.disconnect=function(){this.listeners.forEach(function(e){switch(e.type){case"attributes":e.domNode.removeEventListener("DOMAttrModified",e,!0);break;case"characterData":e.domNode.removeEventListener("DOMCharacterDataModified",e,!0);break;case"childList":e.domNode.removeEventListener("DOMNodeRemoved",e,!0),e.domNode.removeEventListener("DOMNodeInserted",e,!0)}}),this.listeners=[]}},window.MutationObserver||(window.MutationObserver=s.prototype.MutationObserver),s.prototype.implements=function(e){for(var t in e)this[t]===undefined&&e.hasOwnProperty(t)&&(this[t]=e[t])},s.prototype.require=t||function(e,t){typeof e=="function"&&(t=e,e=[]);var r=e.map(function(e){var t=e.substring("../".length).split("/").join("_");return n[t]});t.apply(null,r)},s.prototype.publish=function(e,t,n,r,i,s){if(this["__meta_"+e]!==undefined)throw e+" is already published.";this["__meta_"+e]={id:e,type:n,defaultValue:t,description:r,set:i,ext:s||{}},this[e]=function(t){if(!arguments.length)return this["_"+e];switch(n){case"set":(!i||i.indexOf(t)<0)&&console.log("Invalid value for '"+e+"':  "+t);break;case"html-color":var r="red",s=document.createElement("div");s.style.color=r,s.style.color=t,t!==r&&(s.style.color===r||s.style.color==="")&&console.log("Invalid value for '"+e+"':  "+t);break;case"boolean":t=Boolean(t);break;case"number":t=Number(t);break;case"string":t=String(t);break;case"array":t instanceof Array||console.log("Invalid value for '"+e)}return this.broadcast(e,t,this["_"+e]),this["_"+e]=t,this},this[e+"_modified"]=function(){return this["_"+e]!==t},this[e+"_reset"]=function(){this["_"+e]=t},this["_"+e]=t},s.prototype.publishWidget=function(e,t,n){for(var r in t.prototype)if(r.indexOf("__meta")===0){var i=t.prototype[r];this.publishProxy(e+"_"+i.id,n,i.method||i.id)}},s.prototype.publishProxy=function(e,t,n,r){n=n||e;if(this["__meta_"+e]!==undefined)throw e+" is already published.";this["__meta_"+e]={id:e,type:"proxy",proxy:t,method:n,defaultValue:r},this[e]=function(i){return arguments.length?(r&&i===r?this[t][n+"_reset"]():this[t][n](i),this):!r||this[e+"_modified"]()?this[t][n]():r},this[e+"_modified"]=function(e){return this[t][n+"_modified"]()&&(!r||this[t][n]()!==r)},this[e+"_reset"]=function(){this[t][n+"_reset"]()}},s.prototype.watch=function(e){var t=this,n=this._watchArr.push(e)-1;return{remove:function(){delete t._watchArr[n]}}},s.prototype.broadcast=function(e,t,n){this._watchArr.forEach(function(r){r&&setTimeout(function(){r(e,t,n)},0)})},s.prototype.id=function(e){return arguments.length?(this._id=e,this):this._id},s.prototype.class=function(e){return arguments.length?(this._class=e,this):this._class},s.prototype.columns=function(e){return arguments.length?(this._columns=e,this):this._columns},s.prototype.data=function(e){return arguments.length?(this._data=e,this):this._data},s.prototype.cloneData=function(){return this._data.map(function(e){return e.slice(0)})},s.prototype.rowToObj=function(e){var t={};if(e.length!==this._columns.length)throw"Columns and row do not match";return this._columns.forEach(function(n,r){t[n]=e[r]}),t},s.prototype.pos=function(e){return arguments.length?(this._pos=e,this._overlayElement&&this._overlayElement.attr("transform","translate("+e.x+","+e.y+")scale("+this._scale+")"),this):this._pos},s.prototype.x=function(e){return arguments.length?(this.pos({x:e,y:this._pos.y}),this):this._pos.x},s.prototype.y=function(e){return arguments.length?(this.pos({x:this._pos.x,y:e}),this):this._pos.y},s.prototype.size=function(e){return arguments.length?(this._size=e,this._overlayElement&&this._overlayElement.attr("width",e.width).attr("height",e.height),this):this._size},s.prototype.width=function(e){return arguments.length?(this.size({width:e,height:this._size.height}),this):this._size.width},s.prototype.height=function(e){return arguments.length?(this.size({width:this._size.width,height:e}),this):this._size.height},s.prototype.resize=function(e,t){t=t||{width:0,height:0};var n,r;if(e&&e.width&&e.height)n=e.width,r=e.height;else{var i=window.getComputedStyle(this._target,null);n=parseFloat(i.getPropertyValue("width"))-t.width,r=parseFloat(i.getPropertyValue("height"))-t.height}return this.size({width:n,height:r}),this},s.prototype._scrollBarWidth=null,s.prototype.getScrollbarWidth=function(){if(s.prototype._scrollBarWidth===null){var e=document.createElement("div");e.style.visibility="hidden",e.style.width="100px",e.style.msOverflowStyle="scrollbar",document.body.appendChild(e);var t=e.offsetWidth;e.style.overflow="scroll";var n=document.createElement("div");n.style.width="100%",e.appendChild(n);var r=n.offsetWidth;e.parentNode.removeChild(e),s.prototype._scrollBarWidth=t-r}return s.prototype._scrollBarWidth},s.prototype.scale=function(e){return arguments.length?(this._scale=e,this._overlayElement&&this._overlayElement.attr("transform","translate("+e.x+","+e.y+")scale("+this._scale+")"),this):this._scale},s.prototype.visible=function(e){return arguments.length?(this._visible=e,this._parentElement&&this._parentElement.style("visibility",this._visible?null:"hidden"),this):this._visible},s.prototype.display=function(e){return arguments.length?(this._display=e,this._element&&this._element.style("display",this._display?null:"none"),this):this._display},s.prototype.calcSnap=function(e){function t(e,t){function n(e,t){var n=e%t;return Math.abs(n)>t-Math.abs(n)&&(n=(t-Math.abs(n))*(n<0?1:-1)),n}return e-n(e,t)}var n=t(this._pos.x-this._size.width/2,e),r=t(this._pos.y-this._size.height/2,e),i=t(this._pos.x+this._size.width/2,e),s=t(this._pos.y+this._size.height/2,e),o=i-n,u=s-r;return[{x:n+o/2,y:r+u/2},{width:o,height:u}]},s.prototype.toWidget=function(t){if(!t)return null;var n=e.select(t);if(n){var r=n.datum();if(r)return r}return null},s.prototype.locateParentWidget=function(e){if(!e)return null;var t=this.toWidget(e);return t?t:this.locateParentWidget(e.parentNode)},s.prototype.locateSVGNode=function(e){return e?e.tagName==="svg"?e:this.locateSVGNode(e.parentNode):null},s.prototype.locateOverlayNode=function(){var e=this.locateParentWidget(this._target);while(e){if(e._parentOverlay)return e._parentOverlay;e=this.locateParentWidget(e._target.parentNode)}return null},s.prototype.getAbsolutePos=function(e,t,n){var r=this.locateSVGNode(e);if(!r)return null;var i=r.createSVGPoint(),s=e.getCTM();i=i.matrixTransform(s);var o={x:i.x,y:i.y};if(t!==undefined&&n!==undefined){var u=r.createSVGPoint();u.x=t,u.y=n,u=u.matrixTransform(s),o.width=u.x-i.x,o.height=u.y-i.y}return o},s.prototype.hasOverlay=function(){return this._overlayElement},s.prototype.syncOverlay=function(){if(this._size.width&&this._size.height){var e=this.getAbsolutePos(this._overlayElement.node(),this._size.width,this._size.height);if(e&&(this.oldPos===null||this.oldPos===undefined||e.x!==this.oldPos.x||e.y!==this.oldPos.y||e.width!==this.oldPos.width||e.height!==this.oldPos.height)){var t=e.width/this._size.width,n=e.height/this._size.height;this._parentElement.style({left:e.x-e.width/t/2+"px",top:e.y-e.height/n/2+"px",width:e.width/t+"px",height:e.height/n+"px"});var r="scale("+t+","+n+")";this._parentElement.style("transform",r).style("-moz-transform",r).style("-ms-transform",r).style("-webkit-transform",r).style("-o-transform",r)}this.oldPos=e}},s.prototype.element=function(){return this._element},s.prototype.node=function(){return this._element.node()},s.prototype.render=function(t){if(!this._parentElement)return this;if(!this._tag)throw"No DOM tag specified";var n=this._parentElement.selectAll("#"+this._id).data([this],function(e){return e._id});return n.enter().append(this._tag).classed(this._class,!0).attr("id",this._id).each(function(t){t._element=e.select(this),t.enter(this,t._element)}),n.each(function(e){e.update(this,e._element),e._element.attr("transform",function(t){return"translate("+e._pos.x+","+e._pos.y+")scale("+e._scale+")"})}),n.exit().each(function(t){t.exit(this,t._element)}).remove(),this._renderCount++,t&&t(this),this},s.prototype.enter=function(e,t,n){},s.prototype.update=function(e,t,n){},s.prototype.exit=function(e,t,n){},s.prototype.debounce=function(e,t,n){return function(){function o(){n||e.apply(i,s),i.timeout=null}var i=this,s=arguments;i.timeout?clearTimeout(i.timeout):n&&e.apply(i,s),i.timeout=setTimeout(o,t||100)}},s}),function(e,t){typeof define=="function"&&define.amd?define("common/Transition.js",[],t):e.common_Transition=t()}(this,function(){function e(e){this._widget=e,this._duration=250,this._delay=0,this._ease="cubic-in-out"}return e.prototype.duration=function(e){return arguments.length?(this._duration=e,this._widget):this._duration},e.prototype.delay=function(e){return arguments.length?(this._delay=e,this._widget):this._delay},e.prototype.ease=function(e){return arguments.length?(this._ease=e,this._widget):this._ease},e.prototype.apply=function(e){return this._duration||this._delay?e.transition().duration(this._duration).delay(this._delay).ease(this._ease):e},e}),function(e,t){typeof define=="function"&&define.amd?define("common/HTMLWidget.js",["./Widget","./Transition","d3/d3"],t):e.common_HTMLWidget=t(e.common_Widget,e.common_Transition,e.d3)}(this,function(e,t,n){function r(){e.call(this)}return r.prototype=Object.create(e.prototype),r.prototype.calcFrameWidth=function(e){var t=parseFloat(e.style("padding-left"))+parseFloat(e.style("padding-right"))+parseFloat(e.style("margin-left"))+parseFloat(e.style("margin-right"))+parseFloat(e.style("border-left-width"))+parseFloat(e.style("border-right-width"));return t},r.prototype.calcWidth=function(e){return parseFloat(e.style("width"))-this.calcFrameWidth(e)},r.prototype.calcFrameHeight=function(e){var t=parseFloat(e.style("padding-top"))+parseFloat(e.style("padding-bottom"))+parseFloat(e.style("margin-top"))+parseFloat(e.style("margin-bottom"))+parseFloat(e.style("border-top-width"))+parseFloat(e.style("border-bottom-width"));return t},r.prototype.calcHeight=function(e){return parseFloat(e.style("height"))+this.calcFrameHeight(e)},r.prototype.clientWidth=function(){return this._size.width-this.calcFrameWidth(this._element)},r.prototype.clientHeight=function(){return this._size.height-this.calcFrameHeight(this._element)},r.prototype.resize=function(t){var n=e.prototype.resize.apply(this,arguments);return this._parentElement.style("width",this._size.width+"px").style("height",this._size.height+"px"),n},r.prototype.target=function(e){if(!arguments.length)return this._target;if(this._target&&e)throw"Target can only be assigned once.";this._target=e;if(typeof this._target=="string"||this._target instanceof String)this._target=document.getElementById(this._target);if(this._target instanceof SVGElement){var t=this.locateOverlayNode();this._parentElement=t.append("div").style({position:"absolute",top:0,left:0,overflow:"hidden"}),this._overlayElement=n.select(this._target);var r=this;this.oldPos=null,this.observer=new this.MutationObserver(function(e){r.syncOverlay()});var i=this._overlayElement.node();while(i)this.observer.observe(i,{attributes:!0}),i=i.parentNode}else if(this._target){this._parentElement=n.select(this._target);if(!this._size.width&&!this._size.height){var s=parseFloat(this._parentElement.style("width")),o=parseFloat(this._parentElement.style("height"));this.size({width:s,height:o})}this._parentElement=n.select(this._target).append("div")}else this.exit();return this},r.prototype.exit=function(t,n,r){this.observer&&this.observer.disconnect(),this.oldPos=null,this._parentElement&&this._parentElement.remove(),e.prototype.exit.apply(this,arguments)},r}),function(){if(typeof define=="function"&&define.amd){var e={load:function(e,t,n){n()}};define("async",["module"],function(){return e})}}(),function(e,t){typeof define=="function"&&define.amd?define("c3/Common.js",["d3/d3","c3/c3","../common/HTMLWidget","css!c3/c3"],t):e.c3_Common=t(e.d3,e.c3,e.common_HTMLWidget)}(this,function(e,t,n){function r(e){n.call(this),this._tag="div",this._class="c3_Common",this._type="unknown";var t=this;this._config={axis:{},legend:{position:"bottom",show:!0},data:{columns:[],rows:[]}}}return r.prototype=Object.create(n.prototype),r.prototype.publish("legendPosition","right","set","Legend Position",["bottom","right"]),r.prototype.type=function(e){return arguments.length?(this._type=e,this):this._type},r.prototype.c3_eries=function(){return this._columns.filter(function(e,t){return t>0})},r.prototype.getC3Rows=function(){var e=[this._columns.filter(function(e,t){return t>0})].concat(this._data.map(function(e){return e.filter(function(e,t){return t>0})}));return e},r.prototype.getC3Categories=function(){var e=this._data.map(function(e,t){return e[0]});return e},r.prototype.getC3Column=function(e){var t=[this._columns[e]].concat(this._data.map(function(t,n){return t[e]}));return t},r.prototype.getC3Columns=function(e){if(!this._data.length)return[];e=e||this._columns.length;var t=[];for(var n=1;n<e;++n)t.push(this.getC3Column(n));return t},r.prototype.enter=function(e,r){n.prototype.enter.apply(this,arguments),r.style("overflow","hidden"),this._config.size={width:this.width(),height:this.height()},this._config.data.type=this._type,this._config.legend={position:this._legendPosition},this._config.bindto=r.append("div").datum(null),this.c3Chart=t.generate(this._config)},r.prototype.update=function(e,t){n.prototype.update.apply(this,arguments),this.c3Chart.resize({width:this.width(),height:this.height()})},r}),function(e,t){typeof define=="function"&&define.amd?define("common/Palette.js",["d3/d3","colorbrewer/colorbrewer"],t):e.common_Palette=t(e.d3)}(this,function(e){function s(e,t){if(!e)return o();var n=i[e];return n||(n=o(e,t),i[e]=n),n}function o(u,a){function h(e){return f(e)}if(!u)return["default"].concat(t.concat(n).concat(r));var u=u,f=null,a=a;if(a)f=e.scale.ordinal().range(a);else{if(t.indexOf(u)>=0)f=new e.scale[u];else if(r.indexOf(u)>=0){var l=[];switch(u){case"hpcc10":var a=o("default").colors();l=a.filter(function(e,t){return t%2?!0:!1});break;case"hpcc20":l=o("category10").colors().concat(o("hpcc10").colors())}f=e.scale.ordinal().range(l)}else if(n.indexOf(u)>0){var c=12;while(c>0){if(colorbrewer[u][c]){f=e.scale.ordinal().range(colorbrewer[u][c]);break}--c}}f||(f=e.scale.category20()),a=f.range()}return h.id=function(e){return arguments.length?(u=e,h):u},h.colors=function(e){return arguments.length?(a=e,h):a},h.clone=function(e){return i[e]=o(e,this.colors()),i[e]},h.switch=function(e,t){return u===e?this:arguments.length?s(e,t):s()},h}function a(e,t,n){if(!e)return f();var r=u[e];return r||(r=f(e,t),u[e]=r),r}function f(t,r,i){function d(e,t,n){return l.domain([t,n])(e)}if(!arguments.length){var s=["default"];for(var o in colorbrewer)n.indexOf(o)===-1&&s.push(o);return s}var t=t,l=null,c=r,h=function(t,n){n=n||32;var r=Math.ceil(n/(t.length-1)),i=[],s=null;return t.forEach(function(t){if(s){var n=e.scale.linear().domain([0,r]).range([s,t]).interpolate(e.interpolateLab);for(var o=0;o<r;++o)i.push(n(o))}s=t}),l=e.scale.quantize().domain([0,100]).range(i),l};if(r)l=h(r,i);else{if(colorbrewer[t]){var p=12;while(p>0){if(colorbrewer[t][p]){l=h(colorbrewer[t][p]);break}--p}}l||(l=h(colorbrewer.RdYlGn[11])),c=l.range()}return d.id=function(e){return arguments.length?(t=e,d):t},d.colors=function(e){return arguments.length?(c=e,d):c},d.clone=function(e){return u[e]=f(e,this.color()),u[e]},d.switch=function(e,n){return t===e?this:arguments.length?a(e,n):a()},d}var t=["category10","category20","category20b","category20c"],n=["Accent","Dark2","Paired","Pastel1","Pastel2","Set1","Set2","Set3"],r=["hpcc10","hpcc20"],i={},u={},l=function(t,n,r,i,s){e.select(t).selectAll(".palette").data(o(),function(e){return e}).enter().append("span").attr("class","palette").attr("title",function(e){return e}).on("click",function(t){console.log(e.values(t.value).map(JSON.stringify).join("\n"))}).selectAll(".swatch").data(function(e){return o(e).colors()}).enter().append("span").attr("class","swatch").style("background-color",function(e){return e}),e.select(n).selectAll(".palette").data(f(),function(e){return e}).enter().append("span").attr("class","palette").attr("title",function(e){return e}).on("click",function(t){console.log(e.values(t.value).map(JSON.stringify).join("\n"))}).selectAll(".swatch2").data(function(e){return f(e).colors()}).enter().append("span").attr("class","swatch2").style("height","8px").style("background-color",function(e){return e});var u={id:i.join("_")+s,scale:f("custom",i,s)};e.select(r).selectAll(".palette").data([u],function(e){return e.id}).enter().append("span").attr("class","palette").attr("title",function(e){return"aaa"}).on("click",function(t){console.log(e.values(t.value).map(JSON.stringify).join("\n"))}).selectAll(".swatch2").data(function(e){var t=[];for(var n=0;n<=255;++n)t.push(u.scale(n,0,255));return t}).enter().append("span").attr("class","swatch2").style("background-color",function(e){return e})};return{ordinal:s,rainbow:a,test:l}}),function(e,t){typeof define=="function"&&define.amd?define("chart/INDChart.js",["../common/Palette"],t):e.chart_INDChart=t(e.common_Palette)}(this,function(e){function t(){}return t.prototype._palette=e.ordinal("default"),t.prototype.testData=function(){return this.columns(["Subject","Year 1","Year 2","Year 3"]),this.data([["Geography",75,68,65],["English",45,55,52],["Math",98,92,90],["Science",66,60,66]]),this},t.prototype.click=function(e,t){console.log("Click:  "+JSON.stringify(e)+", "+t)},t}),function(e,t){typeof define=="function"&&define.amd?define("c3/CommonND.js",["./Common","../chart/INDChart"],t):e.c3_CommonND=t(e.c3_Common,e.chart_INDChart)}(this,function(e,t){function n(n){e.call(this),t.call(this),this._class="c3_CommonND";var r=this;this._config.color={pattern:this._palette.colors()},this._config.data.onclick=function(e,t){r.click(r.rowToObj(r._data[e.index]),e.id)},this._config.data.color=function(e,t){return r._palette(t.id?t.id:t)},this._prevColumns=[]}return n.prototype=Object.create(e.prototype),n.prototype.implements(t.prototype),n.prototype.publish("paletteID","default","set","Palette ID",n.prototype._palette.switch()),n.prototype.publish("xaxis_type","category","set","X-Axis Type",["category","timeseries","indexed"]),n.prototype.publish("subchart",!1,"boolean","Show SubChart"),n.prototype.getDiffC3Columns=function(){return this._prevColumns.filter(function(e){return this._columns.indexOf(e)<0},this)},n.prototype.render=function(){var t=e.prototype.render.apply(this,arguments);return this._prevColumns=this._columns,t},n.prototype.enter=function(t,n){this._subchart&&(this._config.subchart={show:!0,size:{height:20}}),this._config.axis.x={type:this._xaxis_type};switch(this._xaxis_type){case"category":this._config.axis.tick={centered:!0,multiline:!1};break;case"timeseries":this._config.data.x=this._columns[0],this._config.axis.tick={format:"%d %b %Y"}}e.prototype.enter.apply(this,arguments)},n.prototype.update=function(t,n){e.prototype.update.apply(this,arguments),this._palette=this._palette.switch(this._paletteID);switch(this._xaxis_type){case"category":this.c3Chart.load({categories:this.getC3Categories(),columns:this.getC3Columns(),unload:this.getDiffC3Columns()});break;case"indexed":case"timeseries":this.c3Chart.load({columns:this.getC3Columns(),unload:this.getDiffC3Columns()})}},n}),function(e,t){typeof define=="function"&&define.amd?define("c3/Area.js",["./CommonND"],t):e.c3_Area=t(e.c3_CommonND)}(this,function(e){function t(t){e.call(this),this._class="c3_Area",this._type="area"}return t.prototype=Object.create(e.prototype),t}),function(e,t){typeof define=="function"&&define.amd?define("c3/Column.js",["./CommonND"],t):e.c3_Column=t(e.c3_CommonND)}(this,function(e){function t(t){e.call(this),this._class="c3_Column",this._type="bar"}return t.prototype=Object.create(e.prototype),t}),function(e,t){typeof define=="function"&&define.amd?define("c3/Bar.js",["./Column"],t):e.c3_Bar=t(e.c3_Column)}(this,function(e){function t(t){e.call(this),this._class="c3_Bar",this._config.axis.rotated=!0}return t.prototype=Object.create(e.prototype),t}),function(e,t){typeof define=="function"&&define.amd?define("chart/I1DChart.js",["../common/Palette"],t):e.chart_I1DChart=t(e.common_Palette)}(this,function(e){function t(){}return t.prototype._palette=e.rainbow("default"),t.prototype.testData=function(){return this.columns("Result"),this.data(66),this},t.prototype.click=function(e,t){console.log("Click:  "+JSON.stringify(e)+", "+t)},t}),function(e,t){typeof define=="function"&&define.amd?define("c3/Common1D",["./Common","../chart/I1DChart"],t):e.c3_Common1D=t(e.c3_Common,e.chart_I1DChart)}(this,function(e,t){function n(n){e.call(this),t.call(this),this._class="c3_Common1D";var r=this;this._config.color={pattern:this._palette.colors()},this._config.data.onclick=function(e,t){r.click(r.rowToObj(r._data[e.i1Dex]),e.id)},this._config.data.color=function(e,t){return r._palette(t.id?t.id:t)}}return n.prototype=Object.create(e.prototype),n.prototype.implements(t.prototype),n.prototype.publish("paletteID","default","set","Palette ID",n.prototype._palette.switch()),n.prototype.update=function(t,n){e.prototype.update.apply(this,arguments),this._palette=this._palette.switch(this._paletteID)},n}),function(e,t){typeof define=="function"&&define.amd?define("chart/I2DChart.js",["../common/Palette"],t):e.chart_I2DChart=t(e.common_Palette)}(this,function(e){function t(){}return t.prototype._palette=e.ordinal("default"),t.prototype.testData=function(){return this.columns(["Subject","2nd Year"]),this.data([["Geography",75],["English",45],["Math",98],["Science",66]]),this},t.prototype.click=function(e,t){console.log("Click:  "+JSON.stringify(e)+", "+t)},t}),function(e,t){typeof define=="function"&&define.amd?define("c3/Common2D",["./Common","../chart/I2DChart"],t):e.c3_Common2D=t(e.c3_Common,e.chart_I2DChart)}(this,function(e,t){function n(n){e.call(this),t.call(this),this._class="c3_Common2D";var r=this;this._config.color={pattern:this._palette.colors()},this._config.data.onclick=function(e,t){r.click(r.rowToObj(r._data[e.index]),r._columns[1])},this._config.data.color=function(e,t){return r._palette(t.id?t.id:t)}}return n.prototype=Object.create(e.prototype),n.prototype.implements(t.prototype),n.prototype.publish("paletteID","default","set","Palette ID",n.prototype._palette.switch()),n.prototype.update=function(t,n){e.prototype.update.apply(this,arguments),this._palette=this._palette.switch(this._paletteID)},n}),function(e,t){typeof define=="function"&&define.amd?define("c3/Donut.js",["./Common2D"],t):e.c3_Donut=t(e.c3_Common2D)}(this,function(e){function t(t){e.call(this),this._class="c3_Donut",this._type="donut"}return t.prototype=Object.create(e.prototype),t.prototype.publish("label_show",!0,"boolean","Show Label"),t.prototype.publish("arc_width",45,"number","Arc Width"),t.prototype.publish("expand",!0,"boolean","Arc Explode"),t.prototype.publish("title","xxx","string","Label"),t.prototype.enter=function(t,n){this._config.donut={label_show:this.label_show(),width:this.arc_width(),expand:this.expand(),title:this.title()},e.prototype.enter.apply(this,arguments)},t.prototype.update=function(t,n){e.prototype.update.apply(this,arguments),this.c3Chart.internal.config.donut_label_show=this.label_show(),this.c3Chart.internal.config.donut_width=this.arc_width(),this.c3Chart.internal.config.donut_expand=this.expand(),this.c3Chart.internal.config.donut_title=this.title();var r=this._data.map(function(e,t){return[e[0],e[1]]},this);this.c3Chart.load({columns:r})},t}),function(e,t){typeof define=="function"&&define.amd?define("c3/Gauge.js",["./Common1D"],t):e.c3_Gauge=t(e.c3_Common1D)}(this,function(e){function t(t){e.call(this),this._class="c3_Gauge",this._type="gauge";var n=this;this._config.data.onclick=function(e,t){var r={};r[e.id]=e.value,n.click(r,e.id)},this._config.data.color=function(e,t){return n._palette(n._data,n._low,n._high)}}return t.prototype=Object.create(e.prototype),t.prototype.publish("low",0,"number","Gauge lower bound"),t.prototype.publish("high",100,"number","Gauge higher bound"),t.prototype.publish("value_format","Percent","set","Value Display Format",["Percent","Value"]),t.prototype.publish("arc_width",50,"number","Gauge width of arc"),t.prototype.publish("show_labels",!0,"boolean","Show Labels"),t.prototype.publish("show_value_label",!0,"boolean","Show Value Label"),t.prototype.update=function(t,n){e.prototype.update.apply(this,arguments),this.c3Chart.internal.config.gauge_min=this.low(),this.c3Chart.internal.config.gauge_max=this.high(),this.c3Chart.internal.config.gauge_units=this.show_value_label()?this.columns():"",this.c3Chart.internal.config.gauge_width=this.arc_width(),this.c3Chart.internal.config.gauge_label_format=this.value_format()==="Percent"?null:function(e,t){return e},this.c3Chart.internal.config.gauge_label_show=this.show_labels(),this.c3Chart.load({columns:[[this._columns,this._data]]})},t}),function(e,t){typeof define=="function"&&define.amd?define("c3/Line",["./CommonND"],t):e.c3_Line=t(e.c3_CommonND)}(this,function(e){function t(t){e.call(this),this._class="c3_Line",this._type="line"}return t.prototype=Object.create(e.prototype),t}),function(e,t){typeof define=="function"&&define.amd?define("c3/Pie.js",["./Common2D"],t):e.c3_Pie=t(e.c3_Common2D)}(this,function(e){function t(t){e.call(this),this._class="c3_Pie",this._type="pie"}return t.prototype=Object.create(e.prototype),t.prototype.update=function(t,n){e.prototype.update.apply(this,arguments);var r=this._data.map(function(e,t){return[e[0],e[1]]},this);this.c3Chart.load({columns:r})},t}),function(e,t){typeof define=="function"&&define.amd?define("c3/Scatter.js",["./CommonND"],t):e.c3_Scatter=t(e.c3_CommonND)}(this,function(e){function t(t){e.call(this),this._class="c3_Scatter",this._type="scatter"}return t.prototype=Object.create(e.prototype),t}),function(e,t){typeof define=="function"&&define.amd?define("c3/Step.js",["./CommonND"],t):e.c3_Step=t(e.c3_CommonND)}(this,function(e){function t(t){e.call(this),this._class="c3_Step",this._type="step"}return t.prototype=Object.create(e.prototype),t}),function(e,t){typeof define=="function"&&define.amd?define("common/SVGWidget.js",["./Widget","./Transition","d3/d3"],t):e.common_SVGWidget=t(e.common_Widget,e.common_Transition,e.d3)}(this,function(e,t,n){function r(){e.call(this),this._tag="g",this._boundingBox=null,this.transition=new t(this)}r.prototype=Object.create(e.prototype),r.prototype.move=function(e,t){var n=this.pos.apply(this,arguments);return arguments.length&&(t?this._element.transition().duration(t):this._element).attr("transform","translate("+e.x+" "+e.y+")"),n},r.prototype.size=function(t){var n=e.prototype.size.apply(this,arguments);return arguments.length&&(this._boundingBox=null),n},r.prototype.resize=function(t){var n=e.prototype.resize.apply(this,arguments);return this._parentRelativeDiv.style({width:this._size.width+"px",height:this._size.height+"px"}),this._parentElement.attr("width",this._size.width).attr("height",this._size.height),this.pos({x:this._size.width/2,y:this._size.height/2}),n},r.prototype.target=function(e){if(!arguments.length)return this._target;if(this._target&&e&&this._target.__data__.id!==e.__data__.id)throw"Target can only be assigned once.";this._target=e;if(typeof this._target=="string"||this._target instanceof String)this._target=document.getElementById(this._target);if(this._target instanceof SVGElement){this._parentElement=n.select(this._target),this._parentWidget=this._parentElement.datum();if(!this._parentWidget||this._parentWidget._id===this._id)this._parentWidget=this.locateParentWidget(this._target.parentNode)}else this._target?(this._parentRelativeDiv=n.select(this._target).append("div").style({position:"relative"}),this._parentElement=this._parentRelativeDiv.append("svg").style({position:"absolute",top:0,left:0}),this._parentOverlay=this._parentRelativeDiv.append("div").style({position:"absolute",top:0,left:0}),this.resize(this._size)):this.exit();return this},r.prototype.enter=function(t,n,r){e.prototype.enter.apply(this,arguments)},r.prototype.update=function(t,n,r){e.prototype.update.apply(this,arguments),n.attr("transform","translate("+this._pos.x+" "+this._pos.y+")")},r.prototype.exit=function(t,n,r){this._parentRelativeDiv&&(this._parentOverlay.remove(),this._parentElement.remove(),this._parentRelativeDiv.remove()),e.prototype.exit.apply(this,arguments)},r.prototype.getOffsetPos=function(){var e={x:0,y:0};return this._parentWidget?(e=this._parentWidget.getOffsetPos(),e.x+=this._pos.x,e.y+=this._pos.y,e):e},r.prototype.getBBox=function(e,t){if(e||this._boundingBox===null){var n=this._element.node();n instanceof SVGElement&&(this._boundingBox=n.getBBox())}return this._boundingBox===null?{x:0,y:0,width:0,height:0}:{x:(t?Math.round(this._boundingBox.x):this._boundingBox.x)*this._scale,y:(t?Math.round(this._boundingBox.y):this._boundingBox.y)*this._scale,width:(t?Math.round(this._boundingBox.width):this._boundingBox.width)*this._scale,height:(t?Math.round(this._boundingBox.height):this._boundingBox.height)*this._scale}},r.prototype.intersection=function(e,t){return this.intersectRect(e,t)};var i=function(e,t,n){return{x:e.x+(t.x-e.x)*n,y:e.y+(t.y-e.y)*n}},s=function(e,t,n,r){var i={type:"",points:[]},s=(r.x-n.x)*(e.y-n.y)-(r.y-n.y)*(e.x-n.x),o=(t.x-e.x)*(e.y-n.y)-(t.y-e.y)*(e.x-n.x),u=(r.y-n.y)*(t.x-e.x)-(r.x-n.x)*(t.y-e.y);if(u!=0){var a=s/u,f=o/u;0<=a&&a<=1&&0<=f&&f<=1?(i.type="Intersection",i.points.push({x:e.x+a*(t.x-e.x),y:e.y+a*(t.y-e.y)})):i.type="No Intersection"}else s==0||o==0?i.type="Coincident":i.type="Parallel";return i};r.prototype.intersectRect=function(e,t){var n=this.getOffsetPos(),r=this.getBBox();if(e.x===t.x&&e.y===t.y)return e;var i={x:n.x-r.width/2,y:n.y-r.height/2},o={x:n.x+r.width/2,y:n.y-r.height/2},u={x:n.x+r.width/2,y:n.y+r.height/2},a={x:n.x-r.width/2,y:n.y+r.height/2},f=s(i,o,e,t);return f.points.length?{x:f.points[0].x,y:f.points[0].y}:(f=s(o,u,e,t),f.points.length?{x:f.points[0].x,y:f.points[0].y}:(f=s(u,a,e,t),f.points.length?{x:f.points[0].x,y:f.points[0].y}:(f=s(a,i,e,t),f.points.length?{x:f.points[0].x,y:f.points[0].y}:null)))};var o=function(e,t,n,r){var s={type:"",points:[]},o=(r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y),u=2*((r.x-n.x)*(n.x-e.x)+(r.y-n.y)*(n.y-e.y)),a=e.x*e.x+e.y*e.y+n.x*n.x+n.y*n.y-2*(e.x*n.x+e.y*n.y)-t*t,f=u*u-4*o*a;if(f<0)s.type="Outside";else if(f==0)s.type="Tangent";else{var l=Math.sqrt(f),c=(-u+l)/(2*o),h=(-u-l)/(2*o);(c<0||c>1)&&(h<0||h>1)?c<0&&h<0||c>1&&h>1?s.type="Outside":s.type="Inside":(s.type="Intersection",0<=c&&c<=1&&s.points.push(i(n,r,c)),0<=h&&h<=1&&s.points.push(i(n,r,h)))}return s};return r.prototype.intersectCircle=function(e,t){var n=this.getOffsetPos(),r=this.radius(),i=o(n,r,e,t);return i.points.length?{x:i.points[0].x,y:i.points[0].y}:null},r.prototype.distance=function(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))},r.prototype._pushMarkers=function(e,t){this.svgMarkerGlitch&&(e=e||this._element,e.selectAll("path[marker-start],path[marker-end]").attr("fixme-start",function(e){return this.getAttribute("marker-start")}).attr("fixme-end",function(e){return this.getAttribute("marker-end")}).attr("marker-start",null).attr("marker-end",null))},r.prototype._popMarkers=function(e,t){this.svgMarkerGlitch&&(e=e||this._element,e.selectAll("path[fixme-start],path[fixme-end]").attr("marker-start",function(e){return this.getAttribute("fixme-start")}).attr("marker-end",function(e){return this.getAttribute("fixme-end")}).attr("fixme-start",null).attr("fixme-end",null))},r.prototype._popMarkersDebounced=e.prototype.debounce(function(e,t){this.svgMarkerGlitch&&this._popMarkers(e,t)},250),r.prototype._fixIEMarkers=function(e,t){this.svgMarkerGlitch&&(this._pushMarkers(e,t),this._popMarkersDebounced(e,t))},r}),function(e,t){typeof define=="function"&&define.amd?define("common/Text.js",["./SVGWidget","css!./Text"],t):e.common_Text=t(e.common_SVGWidget)}(this,function(e){function t(){e.call(this),this._class="common_Text"}return t.prototype=Object.create(e.prototype),t.prototype.publish("text","","string","Display Text"),t.prototype.publish("font_family","","string","Font Family"),t.prototype.publish("font_size",null,"number","Font Size (px)"),t.prototype.publish("anchor","middle","set","Anchor Position",["start","middle","end"]),t.prototype.publish("color_fill",null,"html-color","Fill Color"),t.prototype.testData=function(){return this.text("Hello\nand\nWelcome!"),this},t.prototype.enter=function(t,n){e.prototype.enter.apply(this,arguments),this._textElement=n.append("text")},t.prototype.update=function(t,n){e.prototype.update.apply(this,arguments),this._textElement.attr("font-family",this.__meta_font_family.defaultValue!==this._font_family?this._font_family:null).attr("font-size",this.__meta_font_size.defaultValue!==this._font_size?this._font_size:null);var r=this._text.split("\n"),i=this._textElement.selectAll("tspan").data(r,function(e){return e});i.enter().append("tspan").attr("class",function(e,t){return"tspan_"+t}).attr("dy","1em").attr("x","0"),i.style("fill",this.__meta_color_fill.defaultValue!==this._color_fill?this._color_fill:null).text(function(e){return e}),i.exit().remove();var s={width:0,height:0};try{s=this._textElement.node().getBBox()}catch(o){}var u=0;switch(this._anchor){case"start":u=-s.width/2;break;case"end":u=s.width/2}var a=-(s.y+s.height/2);this._textElement.style("text-anchor",this._anchor).attr("transform",function(e){return"translate("+u+","+a+")"})},t}),function(e,t){typeof define=="function"&&define.amd?define("common/FAChar.js",["./SVGWidget","./Text","css!font-awesome/css/font-awesome","css!./FAChar"],t):e.common_FAChar=t(e.common_SVGWidget,e.common_Text)}(this,function(e,t){function n(){e.call(this),this._class="common_FAChar",this._text=(new t).font_family("FontAwesome")}return n.prototype=Object.create(e.prototype),n.prototype.publish("char","","string","Font Awesome Item"),n.prototype.publish("font_size",null,"number","Font Size"),n.prototype.publishProxy("color_fill","_text"),n.prototype.testData=function(){return this.char(""),this},n.prototype.enter=function(t,n){e.prototype.enter.apply(this,arguments),this._text.target(t)},n.prototype.update=function(t,n){e.prototype.update.apply(this,arguments),this._text.text(this._char).scale((this.font_size()||14)/14).render()},n}),function(e,t){typeof define=="function"&&define.amd?define("chart/Bubble.js",["d3/d3","../common/SVGWidget","./I2DChart","../common/Text","../common/FAChar","css!./Bubble"],t):e.chart_Bubble=t(e.d3,e.common_SVGWidget,e.chart_I2DChart,e.common_Text,e.common_FAChar)}(this,function(e,t,n,r,i){function s(r){t.call(this),n.call(this),this._class="chart_Bubble",this.labelWidgets={},this.d3Pack=e.layout.pack().sort(function(e,t){return e<t?-1:e>t?1:0}).size([this.width(),this.height()]).value(function(e){return e[1]})}return s.prototype=Object.create(t.prototype),s.prototype.implements(n.prototype),s.prototype.publish("paletteID","default","set","Palette ID",s.prototype._palette.switch()),s.prototype.size=function(e){var n=t.prototype.size.apply(this,arguments);return arguments.length&&this.d3Pack.size([this.width(),this.height()]),n},s.prototype.update=function(t,n){var s=this;this._palette=this._palette.switch(this._paletteID);var o=n.selectAll(".node").data(this._data.length?this.d3Pack.nodes({children:this.cloneData()}).filter(function(e){return!e.children}):[],function(e){return e[0]});o.enter().append("g").attr("class","node").attr("opacity",0).on("click",function(e){s.click(s.rowToObj(e),s._columns[1])}).each(function(t){var n=e.select(this);n.append("circle").attr("r",function(e){return e.r}).append("title"),t.__viz_faChar?s.labelWidgets[t[0]]=(new i).char(t.__viz_faChar).target(this).render():s.labelWidgets[t[0]]=(new r).text(t[0]).target(this).render()}),o.transition().attr("opacity",1).each(function(t){var n=e.select(this),r={x:t.x-s._size.width/2,y:t.y-s._size.height/2};n.select("circle").transition().attr("transform",function(e){return"translate("+r.x+","+r.y+")"}).style("fill",function(e){return s._palette(e[0])}).attr("r",function(e){return e.r}).select("title").text(function(e){return e[0]+" ("+e[1]+")"});if(t.__viz_faChar)s.labelWidgets[t[0]].pos(r).render();else{var i=t[0],o=s.labelWidgets[t[0]].getBBox().width;t.r*2<16?i="":t.r*2<o&&(i=i[0]+"..."),s.labelWidgets[t[0]].pos(r).text(i).render()}}),o.exit().transition().style("opacity",0).remove()},s}),function(e,t){typeof define=="function"&&define.amd?define("chart/XYAxis.js",["d3/d3","../common/SVGWidget"],t):e.chart_XYAxis=t(e.d3,e.common_SVGWidget)}(this,function(e,t){function n(n){t.call(this),this._xScale="",this.parseDate=e.time.format("%Y-%m-%d").parse}return n.prototype=Object.create(t.prototype),n.prototype.xScale=function(e){return arguments.length?(this._xScale=e,this):this._xScale},n.prototype.enter=function(t,n){var r=this;this.x=null;switch(this._xScale){case"DATE":this.x=e.time.scale();break;default:this.x=e.scale.ordinal()}this.y=e.scale.linear(),this.xAxis=e.svg.axis().orient("bottom").scale(this.x),this.yAxis=e.svg.axis().orient("left").scale(this.y).tickFormat(e.format(".2s")).ticks(10),this.recenterG=n.append("g"),this.svg=this.recenterG.append("g"),this.svgData=this.svg.append("g"),this.svgXAxis=this.svg.append("g").attr("class","x axis"),this.svgYAxis=this.svg.append("g").attr("class","y axis")},n.prototype.calcMargin=function(e,t){var n=this,r={top:8,right:0,bottom:24,left:40},i=this.width()-r.left-r.right,s=this.height()-r.top-r.bottom,o=t.append("g"),u=o.append("g").attr("class","x axis").attr("transform","translate(0,"+s+")").call(this.xAxis),a=o.append("g").attr("class","y axis").call(this.yAxis),f=u.node().getBBox(),l=a.node().getBBox();return r.bottom=f.height,r.left=l.width,o.remove(),r},n.prototype.update=function(t,n){var r=this;switch(this._xScale){case"DATE":var i=e.min(this._data,function(t){return e.min(t,function(e){return r.parseDate(e[0])})}),s=e.max(this._data,function(t){return e.max(t,function(e){return r.parseDate(e[0])})});this.x.domain([i,s]);break;default:this.x.domain(this._data.map(function(e){return e[0]}))}var i=e.min(this._data,function(t){return e.min(t.filter(function(e,t){return t>0&&r._columns[t]&&r._columns[t].indexOf("__")!==0}),function(e){return e})}),s=e.max(this._data,function(t){return e.max(t.filter(function(e,t){return t>0&&r._columns[t]&&r._columns[t].indexOf("__")!==0}),function(e){return e})}),o=i-(s-i)/10;i>=0&&o<0&&(o=0),this.y.domain([o,s]),this.x.rangeRoundBands?this.x.rangeRoundBands([0,this.width()],.1):this.x.rangeRound&&this.x.range([0,this.width()]),this.y.range([this.height(),0]);var u=this.calcMargin(t,n),a=this.width()-u.left-u.right,f=this.height()-u.top-u.bottom;this.x.rangeRoundBands?this.x.rangeRoundBands([0,a],.1):this.x.rangeRound&&this.x.range([0,a]),this.y.range([f,0]),this.svg.transition().attr("transform","translate("+u.left+","+u.top+")"),this.svgXAxis.transition().attr("transform","translate(0,"+f+")").call(this.xAxis),this.svgYAxis.transition().call(this.yAxis),this.updateChart(t,n,u,a,f),this.recenterG.transition().attr("transform","translate("+ -this.width()/2+","+ -this.height()/2+")")},n.prototype.updateChart=function(e,t,n,r,i){},n}),function(e,t){typeof define=="function"&&define.amd?define("chart/Column.js",["d3/d3","./XYAxis","./I2DChart","css!./Column"],t):e.chart_Column=t(e.d3,e.chart_XYAxis,e.chart_I2DChart)}(this,function(e,t,n){function r(e){t.call(this),n.call(this),this._class="chart_Column"}return r.prototype=Object.create(t.prototype),r.prototype.implements(n.prototype),r.prototype.publish("paletteID","default","set","Palette ID",r.prototype._palette.switch()),r.prototype.updateChart=function(e,t,n,r,i){var s=this;this._palette=this._palette.switch(this._paletteID);var o=this.svgData.selectAll(".columnRect").data(this._data),u=o.enter().append("rect").attr("class","columnRect").on("click",function(e){s.click(s.rowToObj(e),s._columns[1])}).append("title");o.transition().attr("class","columnRect").attr("x",function(e){return s.x(e[0])}).attr("width",this.x.rangeBand()).attr("y",function(e){return s.y(e[1])}).attr("height",function(e){return i-s.y(e[1])}).style("fill",function(e){return s._palette(e[0])}),u.text(function(e){return e[0]+" ("+e[1]+")"}),o.exit().transition().remove()},r}),function(e,t){typeof define=="function"&&define.amd?define("chart/Line.js",["d3/d3","./XYAxis","./INDChart","css!./Line"],t):e.chart_Line=t(e.d3,e.chart_XYAxis,e.chart_INDChart)}(this,function(e,t,n){function r(e){t.call(this),n.call(this),this._class="chart_Line"}return r.prototype=Object.create(t.prototype),r.prototype.implements(n.prototype),r.prototype.publish("paletteID","default","set","Palette ID",r.prototype._palette.switch()),r.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments);var r=this},r.prototype.updateChart=function(t,n,r,i,s){var o=this;this._palette=this._palette.switch(this._paletteID);var u=e.svg.line().x(function(e){switch(o._xScale){case"DATE":return o.x(o.parseDate(e[0]))}return o.x(e[0])+(o.x.rangeBand?o.x.rangeBand()/2:0)}).y(function(e){return o.y(e[1])}),a=this.svgData.selectAll(".dataLine").data(this._columns.filter(function(e,t){return t>0}));a.enter().append("path").attr("class","dataLine"),a.style("stroke",function(e,t){return o._palette(o._columns[t+1])}).append("title").text(function(e){return e}),a.datum(function(e,t){return o._data.map(function(e,n){return[e[0],e[t+1]]})}).attr("d",u),a.exit().remove()},r}),function(e,t){typeof define=="function"&&define.amd?define("other/Persist.js",["require"],t):e.other_Persist=t(e.common_Widget.prototype.require)}(this,function(e){return{discover:function(e,t){var n=[];for(var r in e)if(r.indexOf("__meta_")>=0){var i=e,s=i[r];if(s.type||t){while(s.type==="proxy")i=i[s.proxy],s=i["__meta_"+s.method];s.id!==e[r].id&&(s=JSON.parse(JSON.stringify(s)),s.id=e[r].id),n.push(s)}}return n},serializeToObject:function(e,t,n){var r={__version:3,__class:e._class,__id:e._id,__properties:{}};t&&t.length?t.forEach.forEach(function(t){e[t.id+"_modified"]()&&(r.__properties[t]=e[t]())}):this.discover(e,!0).forEach(function(t){if(e[t.id+"_modified"]())switch(t.type){case"widget":r.__properties[t.id]=this.serializeToObject(e[t.id](),null,n);break;case"widgetArray":r.__properties[t.id]=[];var i=e[t.id]();i.forEach(function(e,i){r.__properties[t.id].push(this.serializeToObject(e,null,n))},this);break;default:r.__properties[t.id]=e[t.id]()}},this);if(e._class==="marshaller_Graph"){var i=e.data().vertices;i&&(this.__vertices=i.map(function(e){return this.serializeToObject(e,null,n)},this))}return n&&(r.__data={},r.__data.columns=e.columns(),r.__data.data=e.data()),r},serialize:function(e,t,n){return JSON.stringify(this.serializeToObject(e,t,n))},deserialize:function(t,n){var r=this,i="../"+t.__class.split("_").join("/");e([i],function(e){var i=new e;t instanceof String&&(t=JSON.parse(t)),t.__id.indexOf("_w")!==0&&(i._id=t.__id);var s=[],o=0;for(var u in t.__properties)if(i["__meta_"+u])switch(i["__meta_"+u].type){case"widget":++o,r.deserialize(t.__properties[u],function(e){i[u](e),--o});break;case"widgetArray":++o;var a=t.__properties[u],f=[];f.length=a.length;var l=0;a.forEach(function(e,t){++l,r.deserialize(e,function(e){f[t]=e,--l});var n=setInterval(function(){l<=0&&(clearInterval(n),l=undefined,i[u](f),--o)},20)});break;default:i[u](t.__properties[u])}else var c=0;var h=setInterval(function(){if(o<=0){clearInterval(h),o=undefined;if(t.__data)for(var e in t.__data)i[e](t.__data[e]);n(i)}},20)})},create:function(e,t){typeof e=="string"&&(e=JSON.parse(e)),this.deserialize(e,t)},clone:function(e,t){this.create(this.serializeToObject(e,[],!0),t)}}}),function(e,t){typeof define=="function"&&define.amd?define("chart/MultiChart",["d3/d3","../common/SVGWidget","./INDChart","../other/Persist","require"],t):e.chart_MultiChart=t(e.d3,e.common_SVGWidget,e.chart_INDChart,e.other_Persist,e.require)}(this,function(e,t,n,r,i){function f(){t.call(this),n.call(this),this._class="chart_MultiChart",this._chart=null,this._2dChartTypes=s,this._multiChartTypes=o,this._anyChartTypes=u,this._allChartTypes=a,this._allCharts={},this._allChartTypes.forEach(function(e){var t=JSON.parse(JSON.stringify(e));t.widget=null,this._allCharts[e.id]=t,this._allCharts[e.display]=t,this._allCharts[e.widgetClass]=t},this),this._allCharts.BAR=this._allCharts.COLUMN}var s=[{id:"BUBBLE",display:"Bubble",widgetClass:"chart_Bubble"},{id:"COLUMN",display:"Column",widgetClass:"chart_Column"},{id:"PIE",display:"Pie",widgetClass:"chart_Pie"},{id:"GOOGLE_PIE",display:"Pie (Google)",widgetClass:"google_Pie"},{id:"C3_PIE",display:"Pie (C3)",widgetClass:"c3_Pie"},{id:"C3_DONUT",display:"Donut (C3)",widgetClass:"c3_Donut"},{id:"WORD_CLOUD",display:"Word Cloud",widgetClass:"other_WordCloud"}],o=[{id:"GOOGLE_BAR",display:"Bar (Google)",widgetClass:"google_Bar"},{id:"GOOGLE_COLUMN",display:"Column (Google)",widgetClass:"google_Column"},{id:"LINE",display:"Line",widgetClass:"chart_Line"},{id:"GOOGLE_LINE",display:"Line (Google)",widgetClass:"google_Line"},{id:"C3_LINE",display:"Line (C3)",widgetClass:"c3_Line"},{id:"C3_BAR",display:"Bar (C3)",widgetClass:"c3_Bar"},{id:"C3_COLUMN",display:"Column (C3)",widgetClass:"c3_Column"},{id:"C3_STEP",display:"Step (C3)",widgetClass:"c3_Step"},{id:"C3_AREA",display:"Area (C3)",widgetClass:"c3_Area"},{id:"C3_SCATTER",display:"Scatter (C3)",widgetClass:"c3_Scatter"}],u=[{id:"TABLE",display:"Table",widgetClass:"other_Table"}],a=s.concat(o.concat(u));return f.prototype=Object.create(t.prototype),f.prototype.implements(n.prototype),f.prototype.publish("chart_type","BUBBLE","set","Chart Type",a.map(function(e){return e.id})),f.prototype.publish("chart",null,"widget","Chart"),f.prototype.columns=function(e){var n=t.prototype.columns.apply(this,arguments);return arguments.length&&this._chart&&this._chart.columns(e),n},f.prototype.data=function(e){var n=t.prototype.data.apply(this,arguments);return arguments.length&&this._chart&&this._chart.data(e),n},f.prototype.hasOverlay=function(){return this._chart&&this._chart.hasOverlay()},f.prototype.visible=function(e){return arguments.length?(this._chart&&this._chart.visible(e),this):this._chart.visible()},f.prototype.requireContent=function(e,t){var n=this._allCharts[e].widget;if(n){t(n);return}var r=this,s="../"+this._allCharts[e].widgetClass.split("_").join("/");i([s],function(i){n=new i,r._allCharts[e].widget=n,t(n)})},f.prototype.switchChart=function(e){var t=this._chart,n=this;this.requireContent(this._chart_type,function(r){if(r!==t){var i=n.size();n._chart=r.columns(n._columns).data(n._data).size(i),r.click=function(e,t){n.click(e,t)},t&&t.data([]).size({width:1,height:1}).render()}e&&e(this)})},f.prototype.update=function(e,n){t.prototype.update.apply(this,arguments);var r=n.selectAll(".multiChart").data(this._chart?[this._chart]:[],function(e){return e._id});r.enter().append("g").attr("class","multiChart").each(function(e){e.target(this)});var i=this.size();r.each(function(e){e.size(i).render()}),r.exit().transition().each(function(e){e.target(null)}).remove()},f.prototype.exit=function(e,n){this._chart&&this._chart.target(null),t.prototype.exit.apply(this,arguments)},f.prototype.render=function(e){if(this._chart_type&&(!this._chart||this._chart._class!==this._allCharts[this._chart_type].widgetClass)){var n=this,r=arguments;return this.switchChart(function(){t.prototype.render.apply(n,r)}),this}return t.prototype.render.apply(this,arguments)},f}),function(e,t){typeof define=="function"&&define.amd?define("common/Shape.js",["./SVGWidget","css!./Shape"],t):e.common_Shape=t(e.common_SVGWidget)}(this,function(e){function t(){e.call(this),this._class="common_Shape"}return t.prototype=Object.create(e.prototype),t.prototype.publish("shape","circle","set","Shape Type",["circle","square","rect","ellipse"]),t.prototype.publish("width",24,"number","Width"),t.prototype.publish("height",24,"number","Height"),t.prototype.publish("color_stroke",null,"html-color","Stroke Color",null),t.prototype.publish("color_fill",null,"html-color","Fill Color",null),t.prototype.radius=function(e){return arguments.length?(this._width=e,this._height=e,this):Math.max(this._width,this._height)/2},t.prototype.testData=function(){return this},t.prototype.intersection=function(t,n){switch(this._shape){case"circle":return this.intersectCircle(t,n)}return e.prototype.intersection.apply(this,arguments)},t.prototype.update=function(e,t){var n=t.selectAll("rect,circle,ellipse").data([this._shape],function(e){return e});n.enter().append(this._shape==="square"?"rect":this._shape).attr("class","common_Shape");var r=this;n.each(function(e){var t=d3.select(this);t.style({fill:r._color_fill!==r.__meta_color_fill.defaultValue?r._color_fill:null,stroke:r._color_stroke!==r.__meta_color_stroke.defaultValue?r._color_stroke:null});switch(r._shape){case"circle":var n=r.radius();t.attr("r",n);break;case"square":var i=Math.max(r._width,r._height);t.attr("x",-i/2).attr("y",-i/2).attr("width",i).attr("height",i);break;case"rect":t.attr("x",-r._width/2).attr("y",-r._height/2).attr("width",r._width).attr("height",r._height);break;case"ellipse":t.attr("rx",r._width/2).attr("ry",r._height/2)}}),n.exit().remove()},t}),function(e,t){typeof define=="function"&&define.amd?define("common/Icon.js",["./SVGWidget","./Shape","./FAChar","css!./Icon"],t):e.common_Icon=t(e.common_SVGWidget,e.common_Shape,e.common_FAChar)}(this,function(e,t,n){function r(){e.call(this),this._class="common_Icon",this._shapeWidget=new t,this._faChar=new n}return r.prototype=Object.create(e.prototype),r.prototype.publish("shape","circle","set","Shape Type",["circle","square"]),r.prototype.publishProxy("faChar","_faChar","char"),r.prototype.publishProxy("image_color_fill","_faChar","color_fill"),r.prototype.publish("tooltip","","string","Tooltip"),r.prototype.publish("diameter",24,"number","Diameter"),r.prototype.publish("padding_percent",45,"number","Padding Percent"),r.prototype.publishProxy("shape_color_fill","_shapeWidget","color_fill"),r.prototype.publishProxy("shape_color_stroke","_shapeWidget","color_stroke"),r.prototype.testData=function(){return this._faChar.testData(),this},r.prototype.intersection=function(e,t){return this._shapeWidget.intersection(e,t)},r.prototype.enter=function(t,n){e.prototype.enter.apply(this,arguments),this._shapeWidget.target(t).render(),this._faChar.target(t).render(),this._tooltipElement=n.append("title")},r.prototype.update=function(t,n){e.prototype.update.apply(this,arguments),this._faChar.font_size(this._diameter*(100-this._padding_percent)/100).render(),this._shapeWidget.shape(this._shape).width(this._diameter).height(this._diameter).render(),this._tooltipElement.text(this._tooltip)},r}),function(e,t){typeof define=="function"&&define.amd?define("common/IMenu.js",[],t):e.common_IMenu=t()}(this,function(){function e(){}return e.prototype.testData=function(){var e=["This","is a","list","of some text."];return this.data(e),this},e.prototype.click=function(e){console.log("Click:  "+e)},e.prototype.preShowMenu=function(){console.log("preShowMenu")},e.prototype.postHideMenu=function(e){console.log("postHideMenu")},e}),function(e,t){typeof define=="function"&&define.amd?define("common/IList.js",[],t):e.common_IList=t()}(this,function(){function e(){}return e.prototype.testData=function(){var e=["This","is a","list","of some text."];return this.data(e),this},e.prototype.click=function(e){console.log("Click:  "+e)},e}),function(e,t){typeof define=="function"&&define.amd?define("common/TextBox.js",["./SVGWidget","./Shape","./Text","css!./TextBox"],t):e.common_TextBox=t(e.common_SVGWidget,e.common_Shape,e.common_Text)}(this,function(e,t,n){function r(){e.call(this),this._class="common_TextBox",this._shape=(new t).shape("rect"),this._text=new n}return r.prototype=Object.create(e.prototype),r.prototype.publishProxy("text","_text"),r.prototype.publishProxy("shape_color_stroke","_shape","color_stroke"),r.prototype.publishProxy("shape_color_fill","_shape","color_fill"),r.prototype.publishProxy("text_color_fill","_text","color_fill"),r.prototype.publish("padding_left",4,"number","Padding:  Left"),r.prototype.publish("padding_right",4,"number","Padding:  Right"),r.prototype.publish("padding_top",4,"number","Padding:  Top"),r.prototype.publish("padding_bottom",4,"number","Padding:  Bottom"),r.prototype.publishProxy("anchor","_text"),r.prototype.publish("fixedSize",null),r.prototype.padding=function(e){return this._padding_left=e,this._padding_right=e,this._padding_top=e,this._padding_bottom=e,this},r.prototype.testData=function(){return this._text.testData(),this},r.prototype.enter=function(t,n){e.prototype.enter.apply(this,arguments),this._shape.target(t).render(),this._text.target(t).render()},r.prototype.update=function(t,n){e.prototype.update.apply(this,arguments),this._text.render();var r=this._text.getBBox(!0),i={width:this._fixedSize?this._fixedSize.width:r.width+this._padding_left+this._padding_right,height:this._fixedSize?this._fixedSize.height:r.height+this._padding_top+this._padding_bottom};this._shape.width(i.width).height(i.height).render();if(this._fixedSize)switch(this.anchor()){case"start":this._text.x(-this._fixedSize.width/2+r.width/2+(this._padding_left+this._padding_right)/2).render();break;case"end":this._text.x(this._fixedSize.width/2-r.width/2-(this._padding_left+this._padding_right)/2).render()}},r}),function(e,t){typeof define=="function"&&define.amd?define("common/List.js",["d3/d3","../common/SVGWidget","./IList","../common/TextBox","css!./List"],t):e.common_List=t(e.d3,e.common_SVGWidget,e.common_IList,e.common_TextBox)}(this,function(e,t,n,r){function i(e){t.call(this),n.call(this),this._class="common_List",this._listWidgets={}}return i.prototype=Object.create(t.prototype),i.prototype.implements(n.prototype),i.prototype.publish("anchor","start","set","Anchor Position",["","start","middle","end"]),i.prototype.update=function(e,n){t.prototype.update.apply(this,arguments);var i=this,s=n.selectAll(".line").data(this._data,function(e){return e});s.enter().append("g").attr("class","line").each(function(e){var t=(new r).target(this).padding_top(0).padding_bottom(0).padding_left(8).padding_right(8).text(e).render();t.element().on("click",function(e){i.click(e.text())}),i._listWidgets[e]=t});var o=0,u=0,a=0;for(var f in this._listWidgets){var l=this._listWidgets[f].getBBox();o+=l.height,u<l.width&&(u=l.width),++a}var c=o/a,h=-u/2,p=-o/2;s.each(function(e){var t=i._listWidgets[e],n=t.getBBox();t.pos({x:0,y:p+n.height/2}).anchor(i._anchor).fixedSize({width:u,height:n.height}).render(),p+=n.height}),s.exit().remove().each(function(e){delete i._listWidgets[e]})},i}),function(e,t){typeof define=="function"&&define.amd?define("common/Menu.js",["./SVGWidget","./IMenu","./Icon","./List","css!./Menu"],t):e.common_Menu=t(e.common_SVGWidget,e.common_IMenu,e.common_Icon,e.common_List)}(this,function(e,t,n,r){function i(){e.call(this),t.call(this),this._class="common_Menu",this._icon=(new n).shape("rect").diameter(14),this._list=new r;var i=this;this._list.click=function(e){d3.event.stopPropagation(),i.hideMenu(),i.click(e)},this._visible=!1}return i.prototype=Object.create(e.prototype),i.prototype.implements(t.prototype),i.prototype.publishProxy("faChar","_icon",null,""),i.prototype.publishProxy("padding_percent","_icon",null,10),i.prototype.toggleMenu=function(){this._visible?this.hideMenu():this.showMenu()},i.prototype.showMenu=function(){this.preShowMenu(),this._visible=!0,this._list.data(this._data).render();var e=this._icon.getBBox(!0),t=this._list.getBBox(!0),n={x:e.width/2-t.width/2,y:e.height/2+t.height/2};this._list.move(n);var r=this;d3.select("body").on("click."+this._id,function(){console.log("click:  body - "+r._id),r._visible&&r.hideMenu()})},i.prototype.hideMenu=function(){d3.select("body").on("click."+this._id,null),this._visible=!1,this._list.data([]).render(),this.postHideMenu()},i.prototype.testData=function(){return this.data(["Menu A","And B","a longer C"]),this},i.prototype.enter=function(t,n){e.prototype.enter.apply(this,arguments),this._icon.target(t).render(),this._list.target(t).render();var r=this;this._icon.element().on("click",function(e){d3.event.stopPropagation(),r.toggleMenu()})},i.prototype.update=function(t,n){e.prototype.update.apply(this,arguments),n.classed("disabled",this._data.length===0),this._icon.faChar(this.faChar()).padding_percent(this.padding_percent()).render()},i}),function(e,t){typeof define=="function"&&define.amd?define("common/Surface.js",["./SVGWidget","./Icon","./Shape","./Text","./FAChar","./Menu","css!./Surface"],t):e.common_Surface=t(e.common_SVGWidget,e.common_Icon,e.common_Shape,e.common_Text,e.common_FAChar,e.common_Menu)}(this,function(e,t,n,r,i,s){function o(){e.call(this),this._class="common_Surface",this._menuPadding=2,this._icon=(new t).faChar("").padding_percent(50),this._container=(new n).class("container").shape("rect"),this._titleRect=(new n).class("title").shape("rect"),this._text=(new r).class("title"),this._menu=(new s).padding_percent(0);var i=this;this._menu.preShowMenu=function(){i._content&&i._content.hasOverlay()&&i._content.visible(!1)},this._menu.postHideMenu=function(){i._content&&i._content.hasOverlay()&&i._content.visible(!0)},this._showContent=!0,this._content=null}return o.prototype=Object.create(e.prototype),o.prototype.publish("show_title",!0,"boolean","Show Title"),o.prototype.publish("title","","string","Title"),o.prototype.publishProxy("title_font_size","_text","font_size"),o.prototype.publish("show_icon",!0,"boolean","Show Title"),o.prototype.publishProxy("icon_faChar","_icon","faChar"),o.prototype.publishProxy("icon_shape","_icon","shape"),o.prototype.publish("content",null,"widget","Content"),o.prototype.menu=function(e){return arguments.length?(this._menu.data(e),this):this._menu.data()},o.prototype.showContent=function(e){return arguments.length?(this._showContent=e,this._content&&this._content.visible(this._showContent),this):this._showContent},o.prototype.content=function(e){if(!arguments.length)return this._content;this._content=e;switch(this._content.class()){case"bar":this.icon_faChar("");break;case"bubble":this.icon_faChar("");break;case"pie":this.icon_faChar("");break;case"table":this.icon_faChar("")}return this},o.prototype.testData=function(){return this.title("Hello and welcome!"),this.menu(["aaa","bbb","ccc"]),this},o.prototype.enter=function(t,n){e.prototype.enter.apply(this,arguments);var r=n.append("g").attr("class","frame"),i=r.node();this._clipRect=r.append("defs").append("clipPath").attr("id",this.id()+"_clip").append("rect").attr("x",0).attr("y",0).attr("width",this._size.width).attr("height",this._size.height),this._titleRect.target(i).render().display(this._show_title&&this._show_icon),this._icon.target(i).render();var s=!1;this._menu.target(t),this._text.target(i),this._container.target(i)},o.prototype.update=function(t,n){e.prototype.update.apply(this,arguments),this._icon.display(this._show_title&&this._show_icon).render(),this._menu.render(),this._text.text(this._title).display(this._show_title).render();var r=this._show_icon?this._icon.getBBox(!0):{width:0,height:0},i=this._text.getBBox(!0),s=this._menu.getBBox(!0),o=Math.max(r.height,i.height,s.height),u=(-this._size.height+o)/2,a=Math.max(i.height,s.height),f=o<=a?0:(o-a)/2,l=f;this._titleRect.pos({x:l,y:u}).width(this._size.width-l*2).height(a).display(this._show_title).render(),this._icon.move({x:-this._size.width/2+r.width/2,y:u}),this._menu.move({x:this._size.width/2-s.width/2-this._menuPadding,y:u}),this._text.move({x:(r.width/2-s.width/2)/2,y:u}),this._show_title?this._container.pos({x:l/2,y:o/2-f/2}).width(this._size.width-l).height(this._size.height-o+f).render():this._container.pos({x:0,y:0}).width(this._size.width).height(this._size.height).render();if(this._showContent){var c=l,h=o-f,p=this,d=n.selectAll(".content").data(this._content?[this._content]:[],function(e){return e._id});d.enter().append("g").attr("class","content").attr("clip-path","url(#"+this.id()+"_clip)").each(function(e){e.target(this)}),d.each(function(e){var t={left:4,top:4,right:4,bottom:4};e.pos({x:c/2,y:h/2}).size({width:p._size.width-c-(t.left+t.right),height:p._size.height-h-(t.top+t.bottom)})}),this._content&&this._clipRect.attr("x",-this._size.width/2+c).attr("y",-this._size.height/2+h).attr("width",this._size.width-c).attr("height",this._size.height-h),d.exit().transition().each(function(e){e.target(null)}).remove()}this._menu.element().node().parentNode.appendChild(this._menu.element().node())},o.prototype.exit=function(t,n){this._content&&this._content.target(null),e.prototype.exit.apply(this,arguments)},o.prototype.render=function(t){this._content||e.prototype.render.apply(this,arguments),e.prototype.render.call(this);var n=this;return this._content&&this._content.render(function(e){t&&t(n)}),this},o.prototype.intersection=function(e,t){var n=[],r=this._icon.intersection(e,t,this._pos);r&&n.push({i:r,d:this.distance(r,t)});var i=this._titleRect.intersection(e,t);i&&n.push({i:i,d:this.distance(i,t)});var s=this._container.intersection(e,t);s&&n.push({i:s,d:this.distance(s,t)});var o=null;return n.forEach(function(e){if(o===null||o.d>e.d)o=e}),o&&o.i?o.i:null},o}),function(e,t){typeof define=="function"&&define.amd?define("common/ResizeSurface.js",["./Surface","css!./ResizeSurface"],t):e.common_ResizeSurface=t(e.common_Surface)}(this,function(e){function t(){e.call(this),this.handleWidth=8,this.handles=[{loc:"NW"},{loc:"N"},{loc:"NE"},{loc:"E"},{loc:"SE"},{loc:"S"},{loc:"SW"},{loc:"W"}],this._allowResize=!0;var t=this;this.dispatch=d3.dispatch("sizestart","size","sizeend"),this.drag=d3.behavior.drag().origin(function(e){return e}).on("dragstart",function(e){t.dispatch.sizestart(t,e.loc),t._allowResize&&(d3.event.sourceEvent.stopPropagation(),t._dragHandlePos={x:e.x,y:e.y},t._dragStartPos=t.pos(),t._dragStartSize=t.size(),t._prevPosSize={x:t._dragStartPos.x,y:t._dragStartPos.y,width:t._dragStartSize.width,height:t._dragStartSize.height},t._textPosSize=t._text.getBBox(!0),t._iconPosSize=t._icon.getBBox(!0),t.showContent(!1))}).on("drag",function(e){if(t._allowResize){d3.event.sourceEvent.stopPropagation();var n=d3.event.x-t._dragHandlePos.x,r=d3.event.y-t._dragHandlePos.y,i={x:0,y:0,w:0,h:0};switch(e.loc){case"NW":i.x=n/2,i.w=-n;case"N":i.y=r/2,i.h=-r;break;case"NE":i.y=r/2,i.h=-r;case"E":i.x=n/2,i.w=n;break;case"SE":i.x=n/2,i.w=n;case"S":i.y=r/2,i.h=r;break;case"SW":i.y=r/2,i.h=r;case"W":i.x=n/2,i.w=-n}var s={x:t._dragStartPos.x+i.x,y:t._dragStartPos.y+i.y,width:t._dragStartSize.width+i.w,height:t._dragStartSize.height+i.h};s.width<t._iconPosSize.width*2+t._textPosSize.width&&(s.x=t._prevPosSize.x,s.width=t._prevPosSize.width),s.height<t._textPosSize.height+48&&(s.y=t._prevPosSize.y,s.height=t._prevPosSize.height),t.pos({x:s.x,y:s.y},!1,!1).size({width:s.width,height:s.height}).render().getBBox(!0),t.dispatch.size(t,e.loc),t._prevPosSize=s}}).on("dragend",function(e){t._allowResize&&(d3.event.sourceEvent.stopPropagation(),t.showContent(!0).render(),t._container.getBBox(!0),t._titleRect.getBBox(!0),t.dispatch.sizeend(t,e.loc))})}return t.prototype=Object.create(e.prototype),t.prototype.allowResize=function(e){return arguments.length?(this._allowResize=e,this):this._allowResize},t.prototype.move=function(t){var n=e.prototype.move.apply(this,arguments);return this.updateHandles(this._domNode,this._element),n},t.prototype.update=function(t,n){e.prototype.update.apply(this,arguments),this.updateHandles(t,n)},t.prototype.updateHandles=function(e,t){var n=this._parentElement.selectAll("rect").data(this.handles,function(e){return e.loc});n.enter().append("rect").attr("class",function(e){return"resize"+e.loc}).call(this.drag);var r=this._pos.x+this._container._pos.x-this._container.width()/2,i=this._pos.y+this._titleRect._pos.y-this._titleRect.height()/2,s=this._pos.x+this._container._pos.x+this._container.width()/2,o=this._pos.y+this._container._pos.y+this._container.height()/2,u=s-r,a=o-i,f=this;n.each(function(e){switch(e.loc){case"NW":e.x=r-f.handleWidth/2,e.y=i-f.handleWidth/2,e.width=f.handleWidth,e.height=f.handleWidth;break;case"N":e.x=r+f.handleWidth/2,e.y=i-f.handleWidth/2,e.width=u-f.handleWidth,e.height=f.handleWidth;break;case"NE":e.x=s-f.handleWidth/2,e.y=i-f.handleWidth/2,e.width=f.handleWidth,e.height=f.handleWidth;break;case"E":e.x=s-f.handleWidth/2,e.y=i+f.handleWidth/2,e.width=f.handleWidth,e.height=a-f.handleWidth;break;case"SE":e.x=s-f.handleWidth/2,e.y=o-f.handleWidth/2,e.width=f.handleWidth,e.height=f.handleWidth;break;case"S":e.x=r+f.handleWidth/2,e.y=o-f.handleWidth/2,e.width=u-f.handleWidth,e.height=f.handleWidth;break;case"SW":e.x=r-f.handleWidth/2,e.y=o-f.handleWidth/2,e.width=f.handleWidth,e.height=f.handleWidth;break;case"W":e.x=r-f.handleWidth/2,e.y=i+f.handleWidth/2,e.width=f.handleWidth,e.height=a-f.handleWidth}d3.select(this).attr("x",e.x).attr("y",e.y).attr("width",e.width).attr("height",e.height)})},t}),function(e,t){typeof define=="function"&&define.amd?define("chart/MultiChartSurface",["d3/d3","../common/ResizeSurface","./MultiChart","./INDChart"],t):e.chart_MultiChartSurface=t(e.d3,e.common_ResizeSurface,e.chart_MultiChart,e.chart_INDChart)}(this,function(e,t,n,r){function i(){t.call(this),r.call(this),this.class="chart_MultiChartSurface",this._title="MultiChartSurface",this._content=new n,this._content.click=function(t,n){e.click(t,n)};var e=this;this._menu.click=function(t){e._content.chart_type(t).render()},this.mode("all")}return i.prototype=Object.create(t.prototype),i.prototype.implements(r.prototype),i.prototype.testData=r.prototype.testData,i.prototype.publishProxy("chart_type","_content"),i.prototype.columns=function(e){return arguments.length?(this._content.columns(e),this):this._content.columns()},i.prototype.data=function(e){return arguments.length?(this._content.data(e),this):this._content.data()},i.prototype.mode=function(e){if(!arguments.length)return this._mode;this._mode=e;switch(this._mode){case"2d":this.menu(this._content._2dChartTypes.concat(this._content._anyChartTypes).map(function(e){return e.display}).sort());break;case"multi":this.menu(this._content._multiChartTypes.concat(this._content._anyChartTypes).map(function(e){return e.display}).sort());break;case"all":default:this.menu(this._content._allChartTypes.map(function(e){return e.display}).sort())}return this},i}),function(e,t){typeof define=="function"&&define.amd?define("chart/Pie",["d3/d3","../common/SVGWidget","./I2DChart","../common/Text","../common/FAChar","css!./Pie"],t):e.chart_Pie=t(e.d3,e.common_SVGWidget,e.chart_I2DChart,e.common_Text,e.common_FAChar)}(this,function(e,t,n,r,i){function s(r){t.call(this),n.call(this),this._class="chart_Pie",this._outerText=!1,this._radius=100,this._innerRadius=0,this.labelWidgets={},this.d3Pie=e.layout.pie().sort(function(e,t){return e<t?-1:e>t?1:0}).value(function(e){return e[1]}),this.d3Arc=e.svg.arc().outerRadius(this._radius).innerRadius(this._innerRadius)}return s.prototype=Object.create(t.prototype),s.prototype.implements(n.prototype),s.prototype.publish("paletteID","default","set","Palette ID",s.prototype._palette.switch()),s.prototype.size=function(e){var n=t.prototype.size.apply(this,arguments);return arguments.length&&this.radius(Math.min(this._size.width,this._size.height)/2),n},s.prototype.radius=function(e){return arguments.length?(this.d3Arc.outerRadius(e),this._radius=e,this):this._radius},s.prototype.innerRadius=function(e){return arguments.length?(this.d3Arc.innerRadius(e),this._innerRadius=e,this):this._innerRadius},s.prototype.outerText=function(e){return arguments.length?(this._outerText=e,this):this._outerText},s.prototype.intersection=function(e,t){return this.intersectCircle(e,t)},s.prototype.update=function(t,n){var s=this;this._palette=this._palette.switch(this._paletteID);var o=n.selectAll(".arc").data(this.d3Pie(this._data),function(e){return e.data[0]});o.enter().append("g").attr("class","arc").attr("opacity",0).on("click",function(e){s.click(s.rowToObj(e.data),s._columns[1])}).each(function(t){var n=e.select(this);n.append("path").attr("d",s.d3Arc).append("title"),t.data.__viz_faChar?s.labelWidgets[t.data[0]]=(new i).char(t.data.__viz_faChar).target(this).render():s.labelWidgets[t.data[0]]=(new r).text(t.data[0]).target(this).render()}),o.transition().attr("opacity",1).each(function(t){var n={x:0,y:1};if(s._outerText){var r=Math.cos((t.startAngle+t.endAngle-Math.PI)/2),i=Math.sin((t.startAngle+t.endAngle-Math.PI)/2),o=s.labelWidgets[t.data[0]].getBBox(),u=Math.abs(r)>Math.abs(i)?o.width:o.height;n.x=r*(s._radius+u),n.y=i*(s._radius+u)}else{var a=s.d3Arc.centroid(t);n={x:a[0],y:a[1]}}var f=e.select(this);f.select("path").transition().attr("d",s.d3Arc).style("fill",function(e){return s._palette(e.data[0])}).select("title").text(function(e){return e.data[0]+" ("+e.data[1]+")"}),s.labelWidgets[t.data[0]].pos(n).render().element().classed("innerLabel",!s._outerText).classed("outerLabel",s._outerText)}),o.exit().transition().style("opacity",0).remove();if(s._outerText){var u=n.selectAll("line").data(this.d3Pie(this._data),function(e){return e.data[0]}),a=this.radius();u.enter().append("line").attr("x1",0).attr("x2",0).attr("y1",-this._radius-3).attr("y2",-this._radius-8).attr("stroke","gray").attr("transform",function(e){return"rotate("+(e.startAngle+e.endAngle)/2*(180/Math.PI)+")"}),u.transition().attr("transform",function(e){return"rotate("+(e.startAngle+e.endAngle)/2*(180/Math.PI)+")"}),u.exit().remove()}},s}),function(e,t){typeof define=="function"&&define.amd?define("google/Common.js",["d3/d3","../common/HTMLWidget","goog!visualization,1,packages:[corechart]"],t):e.google_Common=t(e.d3,e.common_HTMLWidget)}(this,function(e,t){function n(e){t.call(this),this._class="google_Common",this._tag="div",this.columns([]),this.data([]),this._data_google=[],this._chart=null}return n.prototype=Object.create(t.prototype),n.prototype.publish("chartAreaWidth","80%","string","Chart Area Width"),n.prototype.publish("chartAreaHeight","80%","string","Chart Area Height"),n.prototype.publish("fontSize",null,"number","Font Size"),n.prototype.publish("fontName",null,"string","Font Name"),n.prototype.publish("legendShow",!0,"boolean","Show Legend"),n.prototype.publish("legendAlignment","center","set","Legend Alignment",["","start","center","end"]),n.prototype.publish("legendPosition","right","set","Legend Position",["","bottom","labeled","left","right","top"]),n.prototype.publish("legendFontColor","#000","html-color","Legend Font Color"),n.prototype.publish("legendFontName",null,"string","Legend Font Name"),n.prototype.publish("legendFontSize",null,"number","Legend Font Size"),n.prototype.publish("legendFontBold",!1,"boolean","Legend Font Bold"),n.prototype.publish("legendFontItalic",!1,"boolean","Legend Font Italic"),n.prototype.publish("animationDuration",0,"number","Animation Duration"),n.prototype.publish("animationOnStartup",!0,"boolean","Animate On Startup"),n.prototype.publish("animationEasing","linear","set","Animation Easing",["","linear","in","out","inAndOut"]),n.prototype.data=function(e){var n=t.prototype.data.apply(this,arguments);if(arguments.length){var r=null;this._data.length?r=[this._columns].concat(this._data):r=[["",{role:"annotation"}],["",""]],this._data_google=google.visualization.arrayToDataTable(r)}return n},n.prototype.getChartOptions=function(){var e=this._columns.filter(function(e,t){return t>0}).map(function(e){return this._palette(e)},this);return{backgroundColor:"none",width:this.width(),height:this.height(),colors:e,fontSize:this._fontSize,fontName:this._fontName,chartArea:{width:this._chartAreaWidth,height:this._chartAreaHeight},animation:{duration:this._animationDuration,startup:this._animationOnStartup,easing:this._animationEasing},legend:{alignment:this._legendAlignment,position:this._legendShow?this._legendPosition:"none",maxLines:2,textStyle:{color:this._legendFontColor,fontName:this._legendFontName,fontSize:this._legendFontSize,bold:this._legendFontBold,italic:this._legendFontItalic}}}},n.prototype.enter=function(e,t){t.style("overflow","hidden"),this._chart=new google.visualization[this._chartType](e);var n=this;google.visualization.events.addListener(this._chart,"select",function(){var e=n._chart.getSelection()[0];e&&n.click(n.rowToObj(n._data[e.row]),n._columns[e.column])})},n.prototype.update=function(e,n){t.prototype.update.apply(this,arguments),this._chart.draw(this._data_google,this.getChartOptions())},n}),function(e,t){typeof define=="function"&&define.amd?define("google/CommonND.js",["d3/d3","../google/Common","../chart/INDChart","goog!visualization,1,packages:[corechart]"],t):e.google_CommonND=t(e.d3,e.google_Common,e.chart_INDChart)}(this,function(e,t,n){function r(){t.call(this),n.call(this),this._class="google_CommonND"}return r.prototype=Object.create(t.prototype),r.prototype.implements(n.prototype),r.prototype.publish("paletteID","default","set","Palette ID",r.prototype._palette.switch()),r.prototype.update=function(e,n){this._palette=this._palette.switch(this._paletteID),t.prototype.update.apply(this,arguments)},r}),function(e,t){typeof define=="function"&&define.amd?define("google/Bar.js",["d3/d3","./CommonND"],t):e.google_Bar=t(e.d3,e.google_CommonND)}(this,function(e,t){function n(){t.call(this),this._class="google_Bar",this._chartType="BarChart"}return n.prototype=Object.create(t.prototype),n.prototype.getChartOptions=function(){var e=t.prototype.getChartOptions.apply(this,arguments);return e},n.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments)},n.prototype.update=function(e,n){t.prototype.update.apply(this,arguments)},n}),function(e,t){typeof define=="function"&&define.amd?define("google/Column.js",["d3/d3","./CommonND"],t):e.google_Column=t(e.d3,e.google_CommonND)}(this,function(e,t){function n(){t.call(this),this._class="google_Column",this._chartType="ColumnChart"}return n.prototype=Object.create(t.prototype),n.prototype.getChartOptions=function(){var e=t.prototype.getChartOptions.apply(this,arguments);return e},n.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments)},n.prototype.update=function(e,n){t.prototype.update.apply(this,arguments)},n}),function(e,t){typeof define=="function"&&define.amd?define("google/Common2D",["d3/d3","../google/Common","../chart/I2DChart","goog!visualization,1,packages:[corechart]"],t):e.google_Common2D=t(e.d3,e.google_Common,e.chart_I2DChart)}(this,function(e,t,n){function r(){t.call(this),n.call(this),this._class="google_Common2D"}return r.prototype=Object.create(t.prototype),r.prototype.implements(n.prototype),r.prototype.publish("paletteID","default","set","Palette ID",r.prototype._palette.switch()),r.prototype.update=function(e,n){this._palette=this._palette.switch(this._paletteID),t.prototype.update.apply(this,arguments)},r}),function(e,t){typeof define=="function"&&define.amd?define("google/Line.js",["d3/d3","./CommonND"],t):e.google_Line=t(e.d3,e.google_CommonND)}(this,function(e,t){function n(){t.call(this),this._class="google_Line",this._chartType="LineChart"}return n.prototype=Object.create(t.prototype),n.prototype.getChartOptions=function(){var e=t.prototype.getChartOptions.apply(this,arguments);return e},n.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments)},n.prototype.update=function(e,n){t.prototype.update.apply(this,arguments)},n}),function(e,t){typeof define=="function"&&define.amd?define("google/Pie.js",["d3/d3","./Common2D"],t):e.google_Pie=t(e.d3,e.google_Common2D)}(this,function(e,t){function n(){t.call(this),this._class="google_Pie",this._chartType="PieChart"}return n.prototype=Object.create(t.prototype),n.prototype.publish("is3D",!0,"boolean","Enable 3D"),n.prototype.publish("pieHole",0,"number","Pie Hole Size"),n.prototype.publish("pieStartAngle",0,"number","Pie Start Angle"),n.prototype.getChartOptions=function(){var e=t.prototype.getChartOptions.apply(this,arguments);return e.colors=this._data.map(function(e){return this._palette(e[0])},this),e.is3D=this._is3D,e.pieHole=this._pieHole,e.pieStartAngle=this._pieStartAngle,e},n.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments)},n.prototype.update=function(e,n){t.prototype.update.apply(this,arguments)},n}),function(e,t){typeof define=="function"&&define.amd?define("layout/Surface.js",["../common/HTMLWidget","../chart/MultiChart","../c3/Column","../c3/Line","css!./Surface"],t):e.layout_Surface=t(e.common_HTMLWidget,e.chart_MultiChart,e.c3_Column,e.c3_Line)}(this,function(e,t,n,r){function i(){e.call(this),this._class="layout_Surface",this._tag="div"}return i.prototype=Object.create(e.prototype),i.prototype.publish("title","","string","Title"),i.prototype.publish("widget",null,"widget","Widget"),i.prototype.testData=function(){return this.title("ABC"),this.widget((new i).widget((new t).testData())),this},i.prototype.enter=function(t,n){e.prototype.enter.apply(this,arguments)},i.prototype.update=function(t,n){e.prototype.update.apply(this,arguments);var r=n.selectAll(".surfaceTitle").data(this._title?[this._title]:[]);r.enter().insert("h3","div").attr("class","surfaceTitle"),r.text(function(e){return e}),r.exit().remove();var i=n.selectAll("#"+this._id+" > .surfaceWidget").data(this._widget?[this._widget]:[],function(e){return e._id}),s=this;i.enter().append("div").attr("class","surfaceWidget").each(function(e){e.target(this)}),i.each(function(e){var t=s.clientWidth(),r=s.clientHeight();s._title&&(r-=s.calcHeight(n.select("h3")));var i=d3.select(this);r-=s.calcFrameHeight(i),t-=s.calcFrameWidth(i),e.resize({width:t,height:r})}),i.exit().each(function(e){e.target(null)}).remove()},i.prototype.exit=function(t,n){this._widget&&(this._widget=null,this.render()),e.prototype.exit.apply(this,arguments)},i.prototype.render=function(t){var n=this;e.prototype.render.call(this,function(e){n._widget?n._widget.render(function(e){t&&t(e)}):t&&t(e)})},i}),function(e,t){typeof define=="function"&&define.amd?define("layout/Cell",["./Surface","../chart/Pie","../c3/Column","../c3/Line","css!./Cell"],t):e.layout_Cell=t(e.layout_Surface,e.chart_Pie,e.c3_Column,e.c3_Line)}(this,function(e,t,n,r){function i(){e.call(this),this._class="layout_Cell"}return i.prototype=Object.create(e.prototype),i.prototype.publish("gridRow",0,"number","Grid Row Position"),i.prototype.publish("gridCol",0,"number","Grid Column Position"),i.prototype.publish("gridRowSpan",1,"number","Grid Row Span"),i.prototype.publish("gridColSpan",1,"number","Grid Column Span"),i.prototype.enter=function(t,n){e.prototype.enter.apply(this,arguments),n.classed("layout_Surface",!0)},i}),function(e,t){typeof define=="function"&&define.amd?define("layout/Grid",["../common/HTMLWidget","./Cell","../common/Text","../chart/Pie","../chart/MultiChart","../c3/Column","../c3/Line","css!./Grid"],t):e.layout_Grid=t(e.common_HTMLWidget,e.layout_Cell,e.common_Text,e.chart_Pie,e.chart_MultiChart,e.c3_Column,e.c3_Line)}(this,function(e,t,n,r,i,s,o){function u(){e.call(this),this._class="layout_Grid",this._tag="div",this._content=[]}return u.prototype=Object.create(e.prototype),u.prototype.publish("gutter",4,"number","Gap Between Widgets"),u.prototype.publish("fitTo","all","set","Sizing Strategy",["all","width"]),u.prototype.publish("content",[],"widgetArray","widgets"),u.prototype.testData=function(){return this.setContent(0,0,(new r).testData()),this.setContent(0,1,(new r).testData()),this.setContent(1,0,(new r).testData()),this.setContent(1,1,(new r).testData()),this.setContent(0,2,(new i).testData(),"Title AAA",2,2),this.setContent(2,0,(new o).testData(),"Title BBB",2,4),this},u.prototype.getDimensions=function(){var e={width:0,height:0};return this._content.forEach(function(t){e.width<t.gridCol()+t.gridColSpan()&&(e.width=t.gridCol()+t.gridColSpan()),e.height<t.gridRow()+t.gridRowSpan()&&(e.height=t.gridRow()+t.gridRowSpan())},this),e},u.prototype.clearContent=function(){this._content=this._content.filter(function(e){return e.target(null),!1})},u.prototype.setContent=function(e,n,r,i,s,o){s=s||1,o=o||1,i=i||"",this._content=this._content.filter(function(t){return t._gridRow===e&&t._gridCol===n?(t.target(null),!1):!0});if(r){var u=(new t).gridRow(e).gridCol(n).widget(r).title(i).gridRowSpan(s).gridColSpan(o);this._content.push(u)}return this},u.prototype.getContent=function(e){var t=null;return this._content.some(function(n){return n._widget._id===e?(t=n._widget,!0):!1}),t},u.prototype.childMoved=u.prototype.debounce(function(e,t){this.render()},250),u.prototype.enter=function(t,n){e.prototype.enter.apply(this,arguments),n.style("position","relative"),this._scrollBarWidth=this.getScrollbarWidth()},u.prototype.update=function(t,n){e.prototype.update.apply(this,arguments),this._parentElement.style("overflow-x",this._fitTo==="width"?"hidden":null),this._parentElement.style("overflow-y",this._fitTo==="width"?"scroll":null);var r=this.getDimensions(),i=(this.width()-(this._fitTo==="width"?this._scrollBarWidth:0))/r.width,s=this._fitTo==="all"?this.height()/r.height:i,o=this,u=n.selectAll(".cell_"+this._id).data(this._content,function(e){return e._id});u.enter().append("div").attr("class","cell_"+this._id).style("position","absolute").each(function(e){e.target(this),e.__grid_watch=e.watch(function(e,t,n){o._renderCount&&e.indexOf("grid")===0&&t!==n&&o.childMoved()})}),u.style("left",function(e){return e.gridCol()*i+o._gutter/2+"px"}).style("top",function(e){return e.gridRow()*s+o._gutter/2+"px"}).style("width",function(e){return e.gridColSpan()*i-o._gutter+"px"}).style("height",function(e){return e.gridRowSpan()*s-o._gutter+"px"}).each(function(e){e.resize()}),u.exit().each(function(e){e.target(null),e.__grid_watch&&e.__grid_watch.remove()}).remove()},u.prototype.exit=function(t,n){e.prototype.exit.apply(this,arguments)},u.prototype.render=function(t){var n=this;return e.prototype.render.call(this,function(e){if(n._content.length){var r=n._content.length;n._content.forEach(function(n,i){setTimeout(function(){n.render(function(){--r===0&&t&&t(e)})},0)})}else t&&t(e)}),this},u}),function(e,t){typeof define=="function"&&define.amd?define("graph/Edge",["d3/d3","../common/SVGWidget","../common/TextBox","css!./Edge"],t):e.graph_Edge=t(e.d3,e.common_SVGWidget,e.common_TextBox)}(this,function(e,t,n){function r(){t.call(this),this._class="graph_Edge",this._points=[],this._weight=100,this._strokeDasharray=null,this._hidden=!1,this._textBox=(new n).padding(0)}return r.prototype=Object.create(t.prototype),r.prototype.sourceVertex=function(e){return arguments.length?(this._sourceVertex=e,this):this._sourceVertex},r.prototype.targetVertex=function(e){return arguments.length?(this._targetVertex=e,this):this._targetVertex},r.prototype.sourceMarker=function(e){return arguments.length?(this._sourceMarker=e,this):this._sourceMarker},r.prototype.targetMarker=function(e){return arguments.length?(this._targetMarker=e,this):this._targetMarker},r.prototype.weight=function(e){return arguments.length?(this._weight=e,this):this._weight},r.prototype.strokeDasharray=function(e){return arguments.length?(this._strokeDasharray=e,this):this._strokeDasharray},r.prototype.points=function(e,t,n){return arguments.length?(this._points=e,this._elementPath&&this.update(null,this._element,t,n),this):this._points},r.prototype.hidden=function(e){return arguments.length?(this._hidden=e,this):this._hidden},r.prototype.text=function(e){return arguments.length?(this._textBox.text(e),this):this._textBox.text()},r.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments),this._elementPath=n.append("path"),this._sourceMarker&&this._elementPath.attr("marker-start","url(#"+this._sourceMarker+")"),this._targetMarker&&this._elementPath.attr("marker-end","url(#"+this._targetMarker+")"),this._textBox.text()&&this._textBox.target(e).render()},r.prototype.update=function(n,r,i,s){t.prototype.update.apply(this,arguments);var o=this,u=this._elementPath;this.svgMarkerGlitch&&!s&&r.transition().duration((i?i:0)+100).each("start",function(e){o._pushMarkers(r,e)}).each("end",function(e){o._popMarkers(r,e)});var a=o._calculateEdgePoints(this._sourceVertex,this._targetVertex,this._points),f="";if(this._points.length||i||!0)f=e.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("bundle").tension(.75)(a);else{var l=a[2].x-a[0].x,c=a[2].y-a[0].y,h=Math.sqrt(l*l+c*c)*2;f="M"+a[0].x+","+a[0].y+"A"+h+","+h+" 0 0,1 "+a[2].x+","+a[2].y}i&&(u=u.transition().duration(i)),u.attr("opacity",this._hidden?0:1).attr("stroke-dasharray",this._strokeDasharray).attr("d",f),this._textBox.text()&&this._textBox.move(this._findMidPoint(a),i)},r.prototype._findMidPoint=function(e){var t=e.length/2;if(e.length%2)return e[Math.floor(t)];if(e.length){var n=e[t-1],r=e[t];return{x:(n.x+r.x)/2,y:(n.y+r.y)/2}}return{x:0,y:0}},r.prototype._calculateEdgePoints=function(e,t,n){var r=n?n.slice():[],i=r.length===0?t.pos():r[0],s=r.length===0?e.pos():r[r.length-1];r.unshift(e.intersection(e._pos,i)),r.push(t.intersection(t._pos,s)),r[0]||(r[0]=e._pos),r[r.length-1]||(r[r.length-1]=t._pos);if(r.length===2&&r[0]&&r[1]){var o=r[0].x-r[1].x,u=r[0].y-r[1].y,a=Math.sqrt(o*o+u*u);if(a){o/=a,u/=a;var f=(r[0].x+r[1].x)/2-a*u/8,l=(r[0].y+r[1].y)/2+a*o/8;r=[{x:r[0].x,y:r[0].y},{x:f,y:l},{x:r[1].x,y:r[1].y}]}}return r},r}),function(e,t){typeof define=="function"&&define.amd?define("graph/IGraph.js",[],t):e.graph_IGraph=t()}(this,function(){function e(){}return e.prototype.vertex_click=function(e){console.log("Vertex Click: "+e.id())},e.prototype.edge_click=function(e){console.log("Edge Click: "+e.id())},e}),function(e,t){typeof define=="function"&&define.amd?define("graph/Vertex.js",["d3/d3","../common/SVGWidget","../common/Icon","../common/TextBox","css!./Vertex"],t):e.graph_Vertex=t(e.d3,e.common_SVGWidget,e.common_Icon,e.common_TextBox)}(this,function(e,t,n,r){function i(){t.call(this),this._class="graph_Vertex",this._icon=new n,this._textBox=new r,this._annotationWidgets={}}return i.prototype=Object.create(t.prototype),i.prototype.publishProxy("faChar","_icon"),i.prototype.publishProxy("icon_shape_color_fill","_icon","shape_color_fill"),i.prototype.publishProxy("icon_shape_color_stroke","_icon","shape_color_stroke"),i.prototype.publishProxy("icon_image_color_fill","_icon","image_color_fill"),i.prototype.publishProxy("text","_textBox"),i.prototype.publishProxy("anchor","_textBox"),i.prototype.publishProxy("textbox_shape_color_stroke","_textBox","shape_color_stroke"),i.prototype.publishProxy("textbox_shape_color_fill","_textBox","shape_color_fill"),i.prototype.publishProxy("textbox_text_color_fill","_textBox","text_color_fill"),i.prototype.publish("annotation_diameter",14,"number","Annotation Diameter"),i.prototype.publish("annotation_spacing",3,"number","Annotation Spacing"),i.prototype.publish("annotation_icons",[],"array","Annotations"),i.prototype.testData=function(e){return this._icon.testData(),this._textBox.testData(),this.annotation_icons([{faChar:"",tooltip:"Test A",shape_color_fill:"white",image_color_fill:"Red"},{faChar:"",tooltip:"Test B",shape_color_fill:"green",shape_color_stroke:"green",image_color_fill:"white"},{faChar:"",tooltip:"Test C",shape_color_fill:"navy",shape_color_stroke:"navy",image_color_fill:"white"}]),this},i.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments),this._icon.target(e).render(),this._textBox.target(e).render()},i.prototype.update=function(r,i){t.prototype.update.apply(this,arguments),this._icon.render();var s=this._icon.getBBox(!0);this._textBox.render();var o=this._textBox.getBBox(!0);this._icon.move({x:-(o.width/2)+s.width/3,y:-(o.height/2)-s.height/3});var u=this,a=i.selectAll(".annotation").data(this._annotation_icons);a.enter().append("g").attr("class","annotation").each(function(e,t){u._annotationWidgets[t]=(new n).target(this).shape("square")});var f=o.width/2,l=o.height/2;a.each(function(e,t){var n=u._annotationWidgets[t],r=u.textbox_shape_color_stroke();n.diameter(u._annotation_diameter).shape_color_fill(u.textbox_shape_color_fill()).shape_color_stroke(u.textbox_shape_color_stroke());for(var i in e)n[i]&&n[i](e[i]);n.render();var s=n.getBBox(!0);n.move({x:f-s.width/4,y:l+s.height/4}),f-=s.width+u._annotation_spacing}),a.exit().each(function(t,n){var r=e.select(this);delete u._annotationWidgets[n],r.remove()})},i.prototype.intersection=function(e,t){var n=this._icon.intersection(e,t,this._pos);if(n)return n;var r=this._textBox.intersection(e,t,this._pos);return r?r:null},i}),function(e,t){typeof define=="function"&&define.amd?define("graph/GraphData.js",["dagre/dagre"],t):e.graph_GraphData=t(e.dagre)}(this,function(e){function t(){e.graphlib.Graph.call(this,{multigraph:!0,compound:!0}),this.setGraph({}),this.setDefaultNodeLabel(function(){return{}}),this.setDefaultEdgeLabel(function(){return{}})}return t.prototype=Object.create(e.graphlib.Graph.prototype),t.prototype.setData=function(e,t,n,r){var i=this,s={addedVertices:[],addedEdges:[]};for(var o=0;o<e.length;++o){var u=e[o];if(!r||!this.hasNode(u._id))this.setNode(u._id,u),s.addedVertices.push(u)}for(var o=0;o<t.length;++o){var a=t[o];if(!r||!this.hasEdge(a._id))this.setEdge(a._sourceVertex._id,a._targetVertex._id,a),s.addedEdges.push(a)}if(n)for(var o=0;o<n.length;++o)this.setParent(n[o].child._id,n[o].parent._id);if(r){var f=t.map(function(e){return e._id});this.filterEdges(function(e){return f.indexOf(e.v+"_"+e.w)<0}).forEach(function(e){try{}catch(t){var n=0}});var l=e.map(function(e){return e._id});this.filterNodes(function(e){return l.indexOf(e)<0}).forEach(function(e){try{i.delNode(e)}catch(t){var n=0}})}return s},t.prototype.filterEdges=function(e){var t=[];return this.eachEdge(function(n){e(n)&&t.push(n)}),t},t.prototype.filterNodes=function(e){var t=[];return this.eachNode(function(n){e(n)&&t.push(n)}),t},t.prototype.nodeValues=function(){var e=[];return this.nodes().forEach(function(t,n){e.push(this.node(t))},this),e},t.prototype.eachNode=function(e){this.nodes().forEach(function(t,n){e(t,this.node(t))},this)},t.prototype.edgeValues=function(){var e=[],t=this;return this.edges().forEach(function(t,n){e.push(this.edge(t))},this),e},t.prototype.eachEdge=function(e){this.edges().forEach(function(t,n){e(t,t.v,t.w,this.edge(t))},this)},t.prototype.getJSON=function(){var t=e.graphlib.json.write(this);return JSON.stringify(t,function(e,t){return e==="value"?t._text&&t._text._text?t._text._text:t._id:t},"  ")},t}),function(e,t){typeof define=="function"&&define.amd?define("graph/GraphLayouts.js",["dagre/dagre"],t):e.graph_GraphLayouts=t(e.dagre)}(this,function(e){function t(e,t,n,r){var i=this;this.pos={};var s=0;r=r||(t<n?t-s:n-s)/2;var o=e.nodeCount(),u=-Math.PI/2,a=2*Math.PI/o;e.eachNode(function(e,t){var n=t.getBBox(!0),s=Math.max(n.width,n.height);i.pos[e]={x:t.fixed?t.x:Math.cos(u)*(r-s),y:t.fixed?t.y:Math.sin(u)*(r-s),width:n.width,height:n.height},u+=a})}function n(e,t,n,r){var i=this;this.pos={},e.eachNode(function(e,t){i.pos[e]={x:t.x,y:t.y,width:t.width,height:t.height}})}function r(e,t,n,r){var i=this;this.pos={},this.vertices=[],this.vertexMap={},e.eachNode(function(t){var n=e.node(t),r=n.getBBox(!0),s={id:t,x:n.pos().x,y:n.pos().y,width:r.width,height:r.height,value:n};i.vertices.push(s),i.vertexMap[t]=s}),this.edges=[],e.eachEdge(function(t,n,r){var s=e.edge(t);i.edges.push({source:i.vertexMap[n],target:i.vertexMap[r]})}),this.force=d3.layout.force().charge(function(e){var t=e.value.getBBox();return-25*Math.max(t.width,t.height)}).linkDistance(300).nodes(this.vertices).links(this.edges);if(r){this.force.start();var s=e.nodeCount();s=Math.min(s*s,500);for(var o=0;o<s;++o)this.force.tick();this.force.stop()}}function i(t,n,r,i){var s=(new e.graphlib.Graph({multigraph:!0,compound:!0})).setGraph(i).setDefaultNodeLabel(function(){return{}}).setDefaultEdgeLabel(function(){return{}});t.eachNode(function(e){var n=t.node(e),r=n.getBBox();s.setNode(e,{width:r.width,height:r.height})}),t.eachEdge(function(e,n,r){var i=t.edge(e);s.setEdge(n,r,{weight:i.weight()})}),t.eachNode(function(e){s.setParent(e,t.parent(e))}),this.dagreLayout=e.layout(s);var o=-s.graph().width/2,u=-s.graph().height/2;s.nodes().forEach(function(e){var t=s.node(e);t.x+=o,t.y+=u}),s.edges().forEach(function(e){var t=s.edge(e);for(var n=0;n<t.points.length;++n)t.points[n].x+=o,t.points[n].y+=u}),this.digraph=s}t.prototype.nodePos=function(e){return this.pos[e]},t.prototype.edgePoints=function(e){return[]},n.prototype.nodePos=function(e){return this.pos[e]},n.prototype.edgePoints=function(e){return[]},r.prototype.nodePos=function(e){return this.vertexMap[e]},r.prototype.edgePoints=function(e){return[]},i.prototype.nodePos=function(e){return this.digraph.node(e)},i.prototype.edgePoints=function(e){return this.digraph.edge(e).points};var s={None:n,Circle:t,ForceDirected:r,Hierarchy:i};return s}),function(e,t){typeof define=="function"&&define.amd?define("other/Bag.js",[],t):e.other_Bag=t()}(this,function(){function e(){this.items={}}return e.prototype={clear:function(){for(var e in this.items)this.items[e].element().classed("selected",!1);this.items={}},isEmpty:function(){for(var e in this.items)return!1;return!0},append:function(e){this.items[e._id]=e,e.element().classed("selected",!0)},remove:function(e){this.items[e._id].element().classed("selected",!1),delete this.items[e._id]},isSelected:function(e){return this.items[e._id]},get:function(){var e=[];for(var t in this.items)e.push(this.items[t]);return e},set:function(e){this.clear(),e.forEach(function(e,t){this.append(e)},this)},click:function(e,t){t.ctrlKey?this.items[e._id]?this.remove(e):this.append(e):(this.clear(),this.append(e))}},{Selection:e,Navigation:null}}),function(e,t){typeof define=="function"&&define.amd?define("graph/Graph",["d3/d3","../common/SVGWidget","./IGraph","./Vertex","./GraphData","./GraphLayouts","../other/Bag","css!./Graph"],t):e.graph_Graph=t(e.d3,e.common_SVGWidget,e.graph_IGraph,e.graph_Vertex,e.graph_GraphData,e.graph_GraphLayouts,e.other_Bag)}(this,function(e,t,n,r,i,s,o){function u(){t.call(this),n.call(this),this._class="graph_Graph",this.graphData=new i,this._transitionDuration=250,this.highlight={zoom:1.1,opacity:.33,edge:"1.25px",transition:this._transitionDuration},this._showEdges=!0,this._highlightOnMouseOverVertex=!1,this._highlightOnMouseOverEdge=!1,this._shrinkToFitOnLayout=!1,this._layout="",this._hierarchyOptions={},this._snapToGrid=0,this._allowDragging=!0,this._selection=new o.Selection}return u.prototype=Object.create(t.prototype),u.prototype.implements(n.prototype),u.prototype.getOffsetPos=function(){return{x:0,y:0}},u.prototype.size=function(e){var n=t.prototype.size.apply(this,arguments);return arguments.length&&this._svgZoom&&this._svgZoom.attr("x",-this._size.width/2).attr("y",-this._size.height/2).attr("width",this._size.width).attr("height",this._size.height),n},u.prototype.clear=function(){this.data({vertices:[],edges:[],hierarchy:[],merge:!1})},u.prototype.data=function(e){var n=t.prototype.data.apply(this,arguments);if(arguments.length){this._data.merge||(this.graphData=new i,this._renderCount=0);var r=this.graphData.setData(this._data.vertices,this._data.edges,this._data.hierarchy,this._data.merge),s=this;r.addedVertices.forEach(function(e){e.pos({x:+Math.random()*10/2-5,y:+Math.random()*10/2-5})}),r.addedEdges.forEach(function(e){e._sourceMarker&&(e._sourceMarker=s._id+"_"+e._sourceMarker),e._targetMarker&&(e._targetMarker=s._id+"_"+e._targetMarker)})}return n},u.prototype.showEdges=function(e){return arguments.length?(this._showEdges=e,this):this._showEdges},u.prototype.highlightOnMouseOverVertex=function(e){return arguments.length?(this._highlightOnMouseOverVertex=e,this):this._highlightOnMouseOverVertex},u.prototype.highlightOnMouseOverEdge=function(e){return arguments.length?(this._highlightOnMouseOverEdge=e,this):this._highlightOnMouseOverEdge},u.prototype.shrinkToFitOnLayout=function(e){return arguments.length?(this._shrinkToFitOnLayout=e,this):this._shrinkToFitOnLayout},u.prototype.hierarchyOptions=function(e){return arguments.length?(this._hierarchyOptions=e,this):this._hierarchyOptions},u.prototype.snapToGrid=function(e){return arguments.length?(this._snapToGrid=e,this):this._snapToGrid},u.prototype.allowDragging=function(e){return arguments.length?(this._allowDragging=e,this):this._allowDragging},u.prototype.selection=function(e){return arguments.length?(this._selection.set(e),this):this._selection.get()},u.prototype.setZoom=function(e,t,n){this.zoom&&(this.zoom.translate(e),this.zoom.scale(t),this.applyZoom(n))},u.prototype.applyZoom=function(t){e.event&&e.event.sourceEvent&&!e.event.sourceEvent.ctrlKey&&(e.event.sourceEvent.type==="wheel"||e.event.sourceEvent.type==="mousewheel"||e.event.sourceEvent.type==="DOMMouseScroll")&&e.event.sourceEvent.wheelDelta&&(this.zoom.translate([this.prevTranslate[0],this.prevTranslate[1]+e.event.sourceEvent.wheelDelta]),this.zoom.scale(this.prevScale)),(t?this.svg.transition().duration(t):this.svg).attr("transform","translate("+this.zoom.translate()+")scale("+this.zoom.scale()+")"),this.prevTranslate=this.zoom.translate(),this.prevScale!==this.zoom.scale()&&(this._fixIEMarkers(),this.prevScale=this.zoom.scale()),this.brush.x(e.scale.identity().domain([(-this.prevTranslate[0]-this._size.width/2)*1/this.zoom.scale(),(-this.prevTranslate[0]+this._size.width/2)*1/this.zoom.scale()])),this.brush.y(e.scale.identity().domain([(-this.prevTranslate[1]-this._size.height/2)*1/this.zoom.scale(),(-this.prevTranslate[1]+this._size.height/2)*1/this.zoom.scale()]))},u.prototype.enter=function(n,r,i){function o(t){if(s._allowDragging){e.event.sourceEvent.stopPropagation(),s._dragging=!0;if(s.forceLayout){var n=s.forceLayout.vertexMap[t.id()];n.fixed=!0}s.svgMarkerGlitch&&s.graphData.nodeEdges(t.id()).forEach(function(e){var t=s.graphData.edge(e);s._pushMarkers(t.element(),t)})}}function u(t){if(s._allowDragging){e.event.sourceEvent.stopPropagation(),t.move({x:e.event.x,y:e.event.y});if(s.forceLayout){var n=s.forceLayout.vertexMap[t.id()];n.fixed=!0,n.x=n.px=e.event.x,n.y=n.py=e.event.y}s.refreshIncidentEdges(t,!0)}}function a(t){if(s._allowDragging){e.event.sourceEvent.stopPropagation(),s._dragging=!1;if(s._snapToGrid){var n=t.calcSnap(s._snapToGrid);t.move(n[0]),s.refreshIncidentEdges(t,!0)}if(s.forceLayout){var r=s.forceLayout.vertexMap[t.id()];r.fixed=!1}s.svgMarkerGlitch&&s.graphData.nodeEdges(t.id()).forEach(function(e){var t=s.graphData.edge(e);s._popMarkers(t.element(),t)})}}t.prototype.enter.apply(this,arguments);var s=this;this.prevTranslate=[0,0],this.prevScale=1,this.zoom=e.behavior.zoom().scaleExtent([.01,4]).on("zoomstart",function(t){s.prevTranslate=s.zoom.translate(),s.prevScale=s.zoom.scale(),e.event.sourceEvent&&e.event.sourceEvent.shiftKey&&e.event.sourceEvent.ctrlKey?s._zoomMode="selection":e.event.sourceEvent&&e.event.sourceEvent.shiftKey?(s._zoomMode="selection",s._selection.clear()):s._zoomMode="zoom";switch(s._zoomMode){case"selection":r.select(".extent").style("visibility",null);break;default:r.select(".extent").style("visibility","hidden")}}).on("zoomend",function(e){switch(s._zoomMode){case"selection":s.zoom.translate(s.prevTranslate),s.zoom.scale(s.prevScale);break;default:}s._svgBrush.call(s.brush.clear())}).on("zoom",function(e){switch(s._zoomMode){case"selection":break;default:s.applyZoom()}}),this.brush=e.svg.brush().x(e.scale.identity().domain([-s._size.width/2,s._size.width/2])).y(e.scale.identity().domain([-s._size.height/2,s._size.height/2])).on("brushstart",function(e){switch(s._zoomMode){case"selection":break;default:}}).on("brushend",function(t){switch(s._zoomMode){case"selection":var n=e.event.target.extent();s.svgV.selectAll(".graphVertex").select("*").each(function(e){n[0][0]<=e.x()&&e.x()<n[1][0]&&n[0][1]<=e.y()&&e.y()<n[1][1]&&s._selection.append(e)});break;default:}}).on("brush",function(){switch(s._zoomMode){case"selection":var t=s.zoom.translate();console.log(t[0]);var n=e.event.target.extent();s.svgV.selectAll(".graphVertex").select("*").classed("selected",function(e){return s._selection.isSelected(e)||n[0][0]<=e.x()&&e.x()<n[1][0]&&n[0][1]<=e.y()&&e.y()<n[1][1]});break;default:}}),this.drag=e.behavior.drag().origin(function(e){return e.pos()}).on("dragstart",o).on("dragend",a).on("drag",u),this._svgZoom=r.append("rect").attr("class","zoom").attr("x",-this._size.width/2).attr("y",-this._size.height/2).attr("width",this._size.width).attr("height",this._size.height),this.defs=r.append("defs"),this.addMarkers(),r.call(this.zoom),this.svg=r.append("g"),this._svgBrush=this.svg.append("g").attr("class","selectionBrush").call(this.brush),this._svgBrush.select(".background").style("cursor",null),s._svgBrush.call(s.brush.clear()),this.svgC=this.svg.append("g").attr("id",this._id+"C"),this.svgE=this.svg.append("g").attr("id",this._id+"E"),this.svgV=this.svg.append("g").attr("id",this._id+"V")},u.prototype.getBounds=function(e,t){var n=[[null,null],[null,null]];return e.forEach(function(e){var r=t?t.nodePos(e._id):{x:e.x(),y:e.y(),width:e.width(),height:e.height()},i=r.x-r.width/2,s=r.x+r.width/2,o=r.y-r.height/2,u=r.y+r.height/2;if(n[0][0]===null||n[0][0]>i)n[0][0]=i;if(n[0][1]===null||n[0][1]>o)n[0][1]=o;if(n[1][0]===null||n[1][0]<s)n[1][0]=s;if(n[1][1]===null||n[1][1]<u)n[1][1]=u}),n},u.prototype.getVertexBounds=function(e){return this.getBounds(this.graphData.nodeValues(),e)},u.prototype.getSelectionBounds=function(e){return this.getBounds(this._selection.get(),e)},u.prototype.shrinkToFit=function(e,t){var n=this.width(),r=this.height(),i=e[1][0]-e[0][0],s=e[1][1]-e[0][1],o=(e[0][0]+e[1][0])/2,u=(e[0][1]+e[1][1])/2,a=1/Math.max(i/n,s/r);a>1&&(a=1);var f=[-a*o,-a*u];this.setZoom(f,a,t)},u.prototype.zoomToLevels=["all","width","selection","100%"],u.prototype.zoomTo=function(e,t){switch(e){case"all":this.shrinkToFit(this.getVertexBounds(),t);break;case"width":var n=this.getVertexBounds();n[0][1]=0,n[1][1]=0,this.shrinkToFit(n,t);break;case"selection":this.shrinkToFit(this._selection.isEmpty()?this.getVertexBounds():this.getSelectionBounds(),t);break;case"100%":this.zoom.scale(1),this.applyZoom(t)}},u.prototype.centerOn=function(e,t){var n=(e[0][0]+e[1][0])/2,r=(e[0][1]+e[1][1])/2,i=[n,r];this.setZoom(i,1,t)},u.prototype.layout=function(e,t){if(!arguments.length)return this._layout;this._layout=e;if(this._renderCount){this.forceLayout&&(this.forceLayout.force.stop(),this.forceLayout=null);var n=this,r=this.getLayoutEngine();if(this._layout=="ForceDirected2"){this.forceLayout=r;var n=this;this.forceLayout.force.on("tick",function(e){r.vertices.forEach(function(e){var t=n.graphData.node(e.id);e.fixed?(e.x=e.px,e.y=e.py):(e.px=e.x,e.py=e.y,t.move({x:e.x,y:e.y}))}),n.graphData.edgeValues().forEach(function(e){e.points([],!1,!1)});if(n._shrinkToFitOnLayout){var t=n.getVertexBounds(r);n.shrinkToFit(t)}}),this.forceLayout.force.start()}else if(r){this.forceLayout=null,n._dragging=!0,n.graphData.nodeValues().forEach(function(e){var n=r.nodePos(e._id);e.move({x:n.x,y:n.y},t),n.width&&n.height&&!e.width()&&!e.height()&&e.width(n.width).height(n.height).render()}),n.graphData.edgeValues().forEach(function(e){var n=r.edgePoints({v:e._sourceVertex.id(),w:e._targetVertex.id()});e.points(n,t)});if(n._shrinkToFitOnLayout){var i=n.getVertexBounds(r);n.shrinkToFit(i,t)}this._fixIEMarkers(),setTimeout(function(){n._dragging=!1},t?t+50:50)}}return this},u.prototype.update=function(n,r,i){function u(e){e.target(this).render(),e.element().call(s.drag),e.dispatch&&(e.dispatch.on("sizestart",function(e,t){e.allowResize(s._allowDragging),s._allowDragging&&(s._dragging=!0)}),e.dispatch.on("size",function(e,t){s.refreshIncidentEdges(e,!1)}),e.dispatch.on("sizeend",function(e,t){s._dragging=!1;if(s._snapToGrid){var n=e.calcSnap(s._snapToGrid);e.pos(n[0]).size(n[1]).render(),s.refreshIncidentEdges(e,!1)}}))}function f(e){e.target(this).render()}function l(e){e.render()}function c(e){e.render()}t.prototype.update.apply(this,arguments);var s=this,o=this.svgV.selectAll("#"+this._id+"V > .graphVertex").data(this.graphData.nodeValues(),function(e){return e.id()});o.enter().append("g").attr("class","graphVertex").style("opacity",1e-6).on("click.selectionBag",function(t){s._selection.click(t,e.event)}).on("click",function(t){s.vertex_click(t,e.event)}).on("dblclick",function(t){s.vertex_dblclick(t,e.event)}).on("mouseover",function(t){if(s._dragging)return;s.vertex_mouseover(e.select(this),t)}).on("mouseout",function(t){if(s._dragging)return;s.vertex_mouseout(e.select(this),t)}).each(u).transition().duration(750).style("opacity",1);var a=this.svgE.selectAll("#"+this._id+"E > .edge").data(this._showEdges?this.graphData.edgeValues():[],function(e){return e.id()});a.enter().append("g").attr("class","edge").style("opacity",1e-6).on("click",function(e){s.edge_click(e)}).on("mouseover",function(t){if(s._dragging)return;s.edge_mouseover(e.select(this),t)}).on("mouseout",function(t){if(s._dragging)return;s.edge_mouseout(e.select(this),t)}).each(f).transition().duration(750).style("opacity",1),o.each(l),a.each(c),o.exit().each(function(e){e.target(null)}).remove(),a.exit().each(function(e){e.target(null)}).remove(),this._renderCount++||(this.setZoom([0,0],1),this.layout(this.layout()))},u.prototype.getLayoutEngine=function(){switch(this._layout){case"Circle":return new s.Circle(this.graphData,this._size.width,this._size.height);case"ForceDirected":return new s.ForceDirected(this.graphData,this._size.width,this._size.height,!0);case"ForceDirected2":return new s.ForceDirected(this.graphData,this._size.width,this._size.height);case"Hierarchy":return new s.Hierarchy(this.graphData,this._size.width,this._size.height,this._hierarchyOptions)}return null},u.prototype.getNeighborMap=function(e){var t={},n={};if(e){var n=this.graphData.nodeEdges(e.id());for(var r=0;r<n.length;++r){var i=this.graphData.edge(n[r]);n[i.id()]=i,i._sourceVertex.id()!==e.id()&&(t[i._sourceVertex.id()]=i._sourceVertex),i._targetVertex.id()!==e.id()&&(t[i._targetVertex.id()]=i._targetVertex)}}return{vertices:t,edges:n}},u.prototype.highlightVerticies=function(e){var t=this,n=this.svgV.selectAll(".graphVertex");n.transition().duration(this.highlight.transition).each("end",function(t){e&&e[t.id()]&&t._parentElement.node()&&t._parentElement.node().parentNode&&t._parentElement.node().parentNode.appendChild(t._parentElement.node())}).style("opacity",function(n){return!e||e[n.id()]?1:t.highlight.opacity})},u.prototype.highlightEdges=function(e){var t=this,n=this.svgE.selectAll(".edge");n.style("stroke-width",function(n){return e&&e[n.id()]?t.highlight.edge:"1px"}).transition().duration(this.highlight.transition).style("opacity",function(n){return!e||e[n.id()]?1:t.highlight.opacity})},u.prototype.highlightVertex=function(e,t){if(this._highlightOnMouseOverVertex)if(t){var n=this.getNeighborMap(t);n.vertices[t.id()]=t,this.highlightVerticies(n.vertices),this.highlightEdges(n.edges)}else this.highlightVerticies(null),this.highlightEdges(null)},u.prototype.highlightEdge=function(e,t){if(this._highlightOnMouseOverEdge)if(t){var n={};n[t._sourceVertex.id()]=t._sourceVertex,n[t._targetVertex.id()]=t._targetVertex;var r={};r[t.id()]=t,this.highlightVerticies(n),this.highlightEdges(r)}else this.highlightVerticies(null),this.highlightEdges(null)},u.prototype.refreshIncidentEdges=function(e,t){var n=this;this.graphData.nodeEdges(e.id()).forEach(function(e){var r=n.graphData.edge(e);r.points([],!1,t)})},u.prototype.vertex_click=function(e){e._parentElement.node().parentNode.appendChild(e._parentElement.node()),n.prototype.vertex_click.apply(this,arguments)},u.prototype.vertex_dblclick=function(e){},u.prototype.vertex_mouseover=function(e,t){this.highlightVertex(e,t)},u.prototype.vertex_mouseout=function(e,t){this.highlightVertex(null,null)},u.prototype.edge_mouseover=function(e,t){this.highlightEdge(e,t)},u.prototype.edge_mouseout=function(e,t){this.highlightEdge(null,null)},u.prototype.addMarkers=function(e){e&&(this.defs.select("#"+this._id+"_arrowHead").remove(),this.defs.select("#"+this._id+"_circleFoot").remove(),this.defs.select("#"+this._id+"_circleHead").remove()),this.defs.append("marker").attr("class","marker").attr("id",this._id+"_arrowHead").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",8).attr("markerHeight",8).attr("markerUnits","strokeWidth").attr("orient","auto").append("polyline").attr("points","0,0 10,5 0,10 1,5"),this.defs.append("marker").attr("class","marker").attr("id",this._id+"_circleFoot").attr("viewBox","0 0 10 10").attr("refX",1).attr("refY",5).attr("markerWidth",7).attr("markerHeight",7).attr("markerUnits","strokeWidth").attr("orient","auto").append("circle").attr("cx",5).attr("cy",5).attr("r",4),this.defs.append("marker").attr("class","marker").attr("id",this._id+"_circleHead").attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerWidth",7).attr("markerHeight",7).attr("markerUnits","strokeWidth").attr("orient","auto").append("circle").attr("cx",5).attr("cy",5).attr("r",4)},u}),function(e,t){typeof define=="function"&&define.amd?define("map/IChoropleth.js",["../common/Palette"],t):e.map_IChoropleth=t(e.common_Palette,e.usStates,e.usCounties)}(this,function(e,t,n){function r(){}return r.prototype._palette=e.rainbow("default"),r.prototype.click=function(e,t){console.log("Click:  "+JSON.stringify(e)+", "+t)},r}),function(e,t){typeof define=="function"&&define.amd?define("map/Choropleth.js",["d3/d3","../common/SVGWidget","./IChoropleth","css!./Choropleth"],t):e.map_Choropleth=t(e.d3,e.common_SVGWidget,e.map_IChoropleth)}(this,function(e,t,n){function r(){t.call(this),n.call(this),this._class="map_Choropleth",this._dataMap={},this._dataMinWeight=0,this._dataMaxWeight=0}return r.prototype=Object.create(t.prototype),r.prototype.implements(n.prototype),r.prototype.publish("paletteID","YlOrRd","set","Palette ID",r.prototype._palette.switch()),r.prototype.data=function(e){var n=t.prototype.data.apply(this,arguments);if(arguments.length){this._dataMap={},this._dataMinWeight=null,this._dataMaxWeight=null;var r=this;this._data.forEach(function(e){r._dataMap[e[0]]=e;if(!r._dataMinWeight||e[1]<r._dataMinWeight)r._dataMinWeight=e[1];if(!r._dataMaxWeight||e[1]>r._dataMaxWeight)r._dataMaxWeight=e[1]})}return n},r.prototype.size=function(e){var n=t.prototype.size.apply(this,arguments);return arguments.length&&this._svgZoom&&this._svgZoom.attr("x",-this._size.width/2).attr("y",-this._size.height/2).attr("width",this._size.width).attr("height",this._size.height),n},r.prototype.projection=function(t){if(!arguments.length)return this._projection;this._projection=t;switch(this._projection){case"albersUsaPr":this.d3Projection=this.albersUsaPr();break;case"orthographic":this.d3Projection=e.geo.orthographic().clipAngle(90);break;case"mercator":this.d3Projection=e.geo.mercator()}return this.d3Path=e.geo.path().projection(this.d3Projection),this},r.prototype.render=function(){return t.prototype.render.apply(this,arguments),this._renderCount===1&&this.zoomToFit(),this},r.prototype.enter=function(t,n){var r=this;this._svgZoom=n.append("rect").attr("class","zoom").attr("x",-this._size.width/2).attr("y",-this._size.height/2).attr("width",this._size.width).attr("height",this._size.height).on("dblclick",function(t){e.event.stopPropagation(),r.zoomToFit(null,750)});var i=this._parentElement.insert("defs",":first-child"),s=i.append("pattern").attr("id","hash").attr("patternUnits","userSpaceOnUse").attr("width","10").attr("height","10").attr("x",0).attr("y",0).append("g");s.append("rect").attr("class","noFill").attr("x",0).attr("y",0).attr("width",5).attr("height",5),s.append("rect").attr("class","noFill").attr("x",5).attr("y",5).attr("width",5).attr("height",5),this._svg=n.append("g")},r.prototype.update=function(e,t){this._palette=this._palette.switch(this._paletteID)},r.prototype.albersUsaPr=function(){function h(e){var t=e[0],n=e[1];return o=null,(a(t,n),o)||(f(t,n),o)||(l(t,n),o)||(c(t,n),o),o}var t=1e-6,n=e.geo.albers(),r=e.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),i=e.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),s=e.geo.conicEqualArea().rotate([66,0]).center([0,18]).parallels([8,18]),o,u={point:function(e,t){o=[e,t]}},a,f,l,c;return h.invert=function(e){var t=n.scale(),o=n.translate(),u=(e[0]-o[0])/t,a=(e[1]-o[1])/t;return(a>=.12&&a<.234&&u>=-0.425&&u<-0.214?r:a>=.166&&a<.234&&u>=-0.214&&u<-0.115?i:a>=.204&&a<.234&&u>=.32&&u<.38?s:n).invert(e)},h.stream=function(e){var t=n.stream(e),o=r.stream(e),u=i.stream(e),a=s.stream(e);return{point:function(e,n){t.point(e,n),o.point(e,n),u.point(e,n),a.point(e,n)},sphere:function(){t.sphere(),o.sphere(),u.sphere(),a.sphere()},lineStart:function(){t.lineStart(),o.lineStart(),u.lineStart(),a.lineStart()},lineEnd:function(){t.lineEnd(),o.lineEnd(),u.lineEnd(),a.lineEnd()},polygonStart:function(){t.polygonStart(),o.polygonStart(),u.polygonStart(),a.polygonStart()},polygonEnd:function(){t.polygonEnd(),o.polygonEnd(),u.polygonEnd(),a.polygonEnd()}}},h.precision=function(e){return arguments.length?(n.precision(e),r.precision(e),i.precision(e),s.precision(e),h):n.precision()},h.scale=function(e){return arguments.length?(n.scale(e),r.scale(e*.35),i.scale(e),s.scale(e),h.translate(n.translate())):n.scale()},h.translate=function(e){if(!arguments.length)return n.translate();var o=n.scale(),p=+e[0],d=+e[1];return a=n.translate(e).clipExtent([[p-.455*o,d-.238*o],[p+.455*o,d+.238*o]]).stream(u).point,f=r.translate([p-.307*o,d+.201*o]).clipExtent([[p-.425*o+t,d+.12*o+t],[p-.214*o-t,d+.234*o-t]]).stream(u).point,l=i.translate([p-.205*o,d+.212*o]).clipExtent([[p-.214*o+t,d+.166*o+t],[p-.115*o-t,d+.234*o-t]]).stream(u).point,c=s.translate([p+.35*o,d+.224*o]).clipExtent([[p+.32*o,d+.204*o],[p+.38*o,d+.234*o]]).stream(u).point,h},h.scale(1070)},r.prototype.zoomToFit=function(e,t,n){var n=n||.9,r=e?e.getBBox():this._svg.node().getBBox(),i=r.x+r.width/2,s=r.y+r.height/2,o=n/Math.max(r.width/this.width(),r.height/this.height()),u=[-o*i,-o*s];(t?this._svg.transition().duration(t):this._svg).attr("transform","translate("+u+")scale("+o+")")},r}),function(e,t){typeof define=="function"&&define.amd?define("map/IGMap.js",["../common/Shape","../graph/Edge"],t):e.map_IGMap=t(e.common_Shape,e.graph_Edge)}(this,function(e,t){function n(){}return n.prototype.testData=function(){var n=[{geo_lat:"37.665074",geo_long:"-122.384375",__viz_markerIcon:"green-dot.png"},{geo_lat:"32.690680",geo_long:"-117.178540"},{geo_lat:"39.709455",geo_long:"-104.969859"},{geo_lat:"41.244123",geo_long:"-95.961610"},{geo_lat:"32.688980",geo_long:"-117.192040"},{geo_lat:"45.786490",geo_long:"-108.526600"},{geo_lat:"45.796180",geo_long:"-108.535652"},{geo_lat:"45.774320",geo_long:"-108.494370"},{geo_lat:"45.777062",geo_long:"-108.549835",__viz_markerIcon:"red-dot.png"}],r=[],i=[],s=null;return n.forEach(function(n){var o=(new e).shape("circle").radius(3).data(n);r.push(o),s&&i.push((new t).sourceVertex(s).targetVertex(o).targetMarker("arrowHead")),s=o}),this.data({vertices:r,edges:i}),this},n.prototype.click=function(e){console.log("Click:  "+e.label)},n}),function(e,t){typeof define=="function"&&define.amd?define("map/GMap.js",["d3/d3","../common/SVGWidget","../graph/Graph","./IGMap","async!http://maps.google.com/maps/api/js?sensor=false","css!./GMap"],t):e.map_GMap=t(e.d3,e.common_SVGWidget,e.graph_Graph,e.map_IGMap)}(this,function(e,t,n,r){function i(e){n.call(this),r.call(this),this._class="map_GMap"}return i.prototype=Object.create(n.prototype),i.prototype.implements(r.prototype),i.prototype.enter=function(t,r,i){n.prototype.enter.apply(this,arguments),this._googleMap=new google.maps.Map(e.select(this._target).node(),{zoom:3,center:new google.maps.LatLng(41.850033,-87.6500523),mapTypeId:google.maps.MapTypeId.ROADMAP}),this._gmOverlay=new google.maps.OverlayView;var s=this;this._gmOverlay.onAdd=function(){s.layer=e.select(this.getPanes().overlayLayer).append("div").style("position","absolute").attr("class","gmapLayer"),s.layer.node().appendChild(s._parentElement.node()),s._gmOverlay.draw=function(){var e=s._gmOverlay.getProjection(),t=s._googleMap.getBounds(),n=e.fromLatLngToDivPixel(t.getSouthWest()),r=e.fromLatLngToDivPixel(t.getNorthEast()),i=s.layer.node();i.style.left=n.x+"px",i.style.top=r.y+"px",i.style.width=r.x-n.x+"px",i.style.height=n.y-r.y+"px",s.firstRun?s.calcLatLong(n.x,r.y):(s.firstRun=!0,setTimeout(function(){s.calcLatLong(n.x,r.y),s.zoomToFit()},100))},google.maps.event.addListener(s._googleMap,"center_changed",function(){s._gmOverlay.draw()})},this._gmOverlay.setMap(this._googleMap)},i.prototype.calcLatLong=function(e,t){e+=this.width()/2,t+=this.height()/2;var n=this._gmOverlay.getProjection(),r=this;this.graphData.nodeValues().forEach(function(i){var s=new google.maps.LatLng(i._data.geo_lat,i._data.geo_long);i._data.__viz_markerIcon&&!i._marker&&(i._marker=new google.maps.Marker({position:s,animation:google.maps.Animation.DROP,icon:"http://maps.google.com/mapfiles/ms/icons/"+i._data.__viz_markerIcon,map:r._googleMap})),s=n.fromLatLngToDivPixel(s),s.x-=e,s.y-=t,i.move(s)}),this.graphData.edgeValues().forEach(function(e){e.points([])})},i.prototype.zoomToFit=function(){var e=new google.maps.LatLngBounds;return this.graphData.nodeValues().forEach(function(t){var n=new google.maps.LatLng(t._data.geo_lat,t._data.geo_long);e.extend(n)}),this._googleMap.setCenter(e.getCenter()),this._googleMap.fitBounds(e),this},i}),function(e,t){typeof define=="function"&&define.amd?define("other/Comms.js",[],t):e.other_ESPUrl=t()}(this,function(){function e(){this._protocol="http:",this._hostname="localhost"}function t(e){this._mappings=e,this._reverseMappings={};for(var t in this._mappings){this._reverseMappings[t]={};for(var n in this._mappings[t])this._reverseMappings[t][this._mappings[t][n]]=n}}function n(){e.call(this),this._proxyMappings={},this._mappings=new t({})}function s(){n.call(this),this._port="8002",this._target="",this._query=""}function o(){n.call(this),this._port="8010",this._wuid="",this._jobname="",this._sequence=null,this._resultName=null,this._resultNameCache={},this._resultNameCacheCount=0}function u(){n.call(this),this._port="8010",this._wuid=null}function a(){n.call(this)}function f(){o.call(this),this._hipieResults={}}function l(){f.call(this)}e.prototype.url=function(e){if(!arguments.length)return this._url;this._url=e;var t=document.createElement("a");t.href=this._url;var n={};if(t.search.length){var r=t.search;r[0]==="?"&&(r=r.substring(1)),r=r.split("&"),r.map(function(e){var t=e.split("=");n[decodeURIComponent(t[0])]=decodeURIComponent(t[1])})}this._protocol=t.protocol,this._hostname=t.hostname,this._port=t.port,this._pathname=t.pathname;while(this._pathname.length&&this._pathname[0]==="/")this._pathname=this._pathname.substring(1);return this._search=t.search,this._params=n,this._hash=t.hash,this._host=t.host,this},e.prototype.protocol=function(e){return arguments.length?(this._protocol=e,this):this._protocol},e.prototype.hostname=function(e){return arguments.length?(this._hostname=e,this):this._hostname},e.prototype.port=function(e){return arguments.length?(this._port=e,this):this._port},e.prototype.pathname=function(e){return arguments.length?(this._pathname=e,this):this._pathname},e.prototype.isWsWorkunits=function(){return this._pathname.toLowerCase().indexOf("wsworkunits")>=0||this._params.Wuid},e.prototype.isWorkunitResult=function(){return this.isWsWorkunits()&&(this._params.Sequence||this._params.ResultName)},e.prototype.isWsEcl=function(){return this._pathname.toLowerCase().indexOf("wsecl")>=0||this._params.QuerySetId&&this._params.Id},e.prototype.isWsWorkunits_GetStats=function(){return this._pathname.toLowerCase().indexOf("wsworkunits/wugetstats")>=0&&this._params.WUID},e.prototype.getUrl=function(e){return e=e||{},(e.protocol?e.protocol:this._protocol)+"//"+(e.hostname?e.hostname:this._hostname)+":"+(e.port?e.port:this._port)+"/"+(e.pathname?e.pathname:this._pathname)},t.prototype.contains=function(e,t){return r(e+"."+t,this._mappings)},t.prototype.mapResult=function(e,t){var n=this._mappings[t];n&&(e[t]=e[t].map(function(e){var t=[];if(n.x&&n.x instanceof Array){t=[];for(var r=0;r<n.x.length;++r)t.push(e[n.y[r]])}else for(var i in n)n[i]==="label"?t[0]=e[i]:n[i]==="weight"&&(t[1]=e[i]);return t},this))},t.prototype.mapResponse=function(e){for(var t in e)this.mapResult(e,t)},n.prototype=Object.create(e.prototype);var r=function(e,t){var n=e.split("."),r=t;for(var i=0;i<n.length;++i){var s=n[i];if(r[s]===undefined)return!1;r=r[s]}return!0},i=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")};return n.prototype.jsonp=function(t,n,r){for(var s in this._proxyMappings){var o=t.split(s),u=o[0];if(o.length>1){var a=(new e).url(t);t=u+this._proxyMappings[s],n.IP=a._hostname,n.PORT=a._port,o.length>0&&(n.PATH=o[1]);break}}var f=this,l="jsonp_callback_"+Math.round(Math.random()*999999);window[l]=function(e){delete window[l],document.body.removeChild(c),r(e)};var c=document.createElement("script");c.src=t+(t.indexOf("?")>=0?"&":"?")+"jsonp="+l+"&"+i(n),document.body.appendChild(c)},n.prototype.mappings=function(e){return arguments.length?(this._mappings=new t(e),this):this._mappings},n.prototype.proxyMappings=function(e){return arguments.length?(this._proxyMappings=e,this):this._proxyMappings},s.prototype=Object.create(n.prototype),s.prototype.url=function(e){var t=n.prototype.url.apply(this,arguments);if(arguments.length){this._port=this._port==="8010"?"8002":this._port;for(var r in this._params)switch(r){case"QuerySetId":this.target(this._params[r]);break;case"Id":this.query(this._params[r])}if(!this._target&&!this._query){var i=this._pathname.split("/res/");if(i.length>=2){var s=i[1].split("/");s.length>=3&&(this.target(s[1]),this.query(s[2]))}}}return t},s.prototype.target=function(e){return arguments.length?(this._target=e,this):this._target},s.prototype.query=function(e){return arguments.length?(this._query=e,this):this._query},s.prototype.constructUrl=function(){return n.prototype.getUrl.call(this,{pathname:"WsEcl/submit/query/"+this._target+"/"+this._query+"/json"})},s.prototype.call=function(e,t,n){e=e||{},e.target=e.target||this._target,e.query=e.query||this._query;var r=this,i=this.getUrl({pathname:"WsEcl/submit/query/"+e.target+"/"+e.query+"/json"});this.jsonp(i,t,function(e){for(var t in e){e=e[t].Results;break}for(var t in e)e[t]=e[t].Row;r._mappings.mapResponse(e),n(e)})},s.prototype.send=function(e,t){this.call({target:this._target,query:this._query},e,t)},o.prototype=Object.create(n.prototype),o.prototype.url=function(e){var t=n.prototype.url.apply(this,arguments);if(arguments.length){for(var r in this._params)switch(r){case"Wuid":this.wuid(this._params[r]);break;case"ResultName":this.resultName(this._params[r]);break;case"Sequence":this.sequence(this._params[r])}if(!this._wuid){var i=this._url.split("/res/");if(i.length>=2){var s=i[1].split("/");this.wuid(s[0])}}}return t},o.prototype.wuid=function(e){return arguments.length?(this._wuid=e,this):this._wuid},o.prototype.jobname=function(e){return arguments.length?(this._jobname=e,this):this._jobname},o.prototype.sequence=function(e){return arguments.length?(this._sequence=e,this):this._sequence},o.prototype.resultName=function(e){return arguments.length?(this._resultName=e,this):this._resultName},o.prototype.appendParam=function(e,t,n){return t?(n&&(n+="&"),n+e+"="+t):n},o.prototype.constructUrl=function(){var e=n.prototype.getUrl.call(this,{pathname:"WsWorkunits/res/"+this._wuid+"/"}),t="";return t=this.appendParam("ResultName",this._resultName,t),e+(t?"?"+t:"")},o.prototype._fetchResult=function(e,t,n){e=e||{},e._start=e._start||0,e._count=e._count||-1;var r=this.getUrl({pathname:"WsWorkunits/WUResult.json"}),i={Wuid:e.wuid,ResultName:e.resultname,SuppressXmlSchema:!0,Start:e._start,Count:e._count};this._resultNameCache[e.resultname]={};var s=this;this.jsonp(r,i,function(r){for(var i in r){if(!r[i].Result)throw"No result found.";s._total=r[i].Total,r=r[i].Result;for(var i in r){r=r[i].Row;break}break}s._resultNameCache[e.resultname]=r,n||s._mappings.mapResult(s._resultNameCache,e.resultname),t(s._resultNameCache[e.resultname])})},o.prototype.fetchResult=function(e,t,n){if(e.wuid)this._fetchResult(e,t,n);else if(e.jobname){var r=this;this.WUQuery(e,function(i){e.wuid=i[0].Wuid,r._fetchResult(e,t,n)})}},o.prototype.WUQuery=function(e,t){var n=this.getUrl({pathname:"WsWorkunits/WUQuery.json"}),e={Jobname:e.jobname,Count:1};this._resultNameCache={},this._resultNameCacheCount=0;var i=this;this.jsonp(n,e,function(e){if(!r("WUQueryResponse.Workunits.ECLWorkunit",e))throw"No workunit found.";e=e.WUQueryResponse.Workunits.ECLWorkunit,t(e)})},o.prototype.fetchResultNames=function(e){var t=this.getUrl({pathname:"WsWorkunits/WUInfo.json"}),n={Wuid:this._wuid,TruncateEclTo64k:!0,IncludeExceptions:!1,IncludeGraphs:!1,IncludeSourceFiles:!1,IncludeResults:!0,IncludeResultsViewNames:!1,IncludeVariables:!1,IncludeTimers:!1,IncludeResourceURLs:!1,IncludeDebugValues:!1,IncludeApplicationValues:!1,IncludeWorkflows:!1,IncludeXmlSchemas:!1,SuppressResultSchemas:!0};this._resultNameCache={},this._resultNameCacheCount=0;var i=this;this.jsonp(t,n,function(t){r("WUInfoResponse.Workunit.Results.ECLResult",t)&&(t.WUInfoResponse.Workunit.Results.ECLResult.map(function(e){i._resultNameCache[e.Name]=[],++i._resultNameCacheCount}),e(i._resultNameCache))})},o.prototype.fetchResults=function(e,t){var n=this;this.fetchResultNames(function(r){var i=n._resultNameCacheCount;if(i>0)for(var s in n._resultNameCache){var o=n._resultNameCache[s];n.fetchResult({wuid:n._wuid,resultname:s},function(t){--i<=0&&e(n._resultNameCache)},t)}else e(n._resultNameCache)})},o.prototype.postFilter=function(e,t){var n={};for(var r in t)n[r]=t[r].filter(function(t,n){for(var r in e)if(t[r]!==undefined&&e[r]!==undefined&&t[r]!==e[r])return!1;return!0});return this._mappings.mapResponse(n),n},o.prototype.send=function(e,t){var n=this;this._resultNameCacheCount?t(n.postFilter(e,this._resultNameCache)):this.fetchResults(function(r){t(n.postFilter(e,r))},!0)},u.prototype=Object.create(n.prototype),u.prototype.url=function(e){var t=n.prototype.url.apply(this,arguments);if(arguments.length)for(var r in this._params)switch(r){case"WUID":this.wuid(this._params[r])}return t},u.prototype.wuid=function(e){return arguments.length?(this._wuid=e,this):this._wuid},u.prototype.constructUrl=function(){return n.prototype.getUrl.call(this,{pathname:"WsWorkunits/WUGetStats?WUID="+this._wuid})},u.prototype.send=function(e,t){var n=this,i=this.getUrl({pathname:"WsWorkunits/WUGetStats.json?WUID="+this._wuid});this.jsonp(i,e,function(e){r("WUGetStatsResponse.Statistics.WUStatisticItem",e)?t(e.WUGetStatsResponse.Statistics.WUStatisticItem):t([])})},a.prototype=Object.create(n.prototype),a.prototype.fetchResults=function(e,t){var n=this.getUrl({});this._resultNameCache={},this._resultNameCacheCount=0;var r=this;this.jsonp(n,e,function(e){for(var n in e){e=e[n].Results;break}for(var n in e)r._resultNameCache[n]=e[n].Row,++r._resultNameCacheCount;t(r._resultNameCache)})},a.prototype.fetchResult=function(e,t){t(this._resultNameCache[e])},a.prototype.call=function(e,t){var n=this;this.fetchResults(e,t)},f.prototype=Object.create(o.prototype),f.prototype.hipieResults=function(e){if(!arguments.length)return this._hipieResults;this._hipieResultsLength=0,this._hipieResults={};var t=this;return e.forEach(function(e){t._hipieResultsLength++,t._hipieResults[e.id]=e}),this},f.prototype.fetchResults=function(e){var t=this;return o.prototype.fetchResultNames.call(this,function(n){var r=t._hipieResultsLength;if(r>0)for(var i in t._hipieResults){var s=t._hipieResults[i];t.fetchResult(s.from,function(n){--r<=0&&e(t._resultNameCache)})}else e(t._resultNameCache)})},f.prototype.fetchResult=function(e,t){var n=this;return o.prototype.fetchResult.call(this,{wuid:this._wuid,resultname:e},function(e){t(e)})},f.prototype.call=function(e,t){var n=this;if(e.refresh||!this._resultNameCache||!this._resultNameCacheCount)this.fetchResults(t);else{var r={};for(var i in e)e[i]&&e[i+"_changed"]&&(r[i]=e[i]);var s={};for(var i in this._hipieResults){var o=this._hipieResults[i],u=!0;for(var a in r)if(o.filter.indexOf(a)<0){u=!1;break}u&&(s[o.from]=this._resultNameCache[o.from].filter(function(e){for(var t in r)if(e[t]!==r[t])return!1;return!0}))}t(s)}},l.prototype=Object.create(f.prototype),l.prototype.databomb=function(e){return arguments.length?(this._databomb=e,this):this._databomb},l.prototype.fetchResults=function(e){var t=this;setTimeout(function(){t._resultNameCacheCount=0,t._resultNameCache=t._databomb;for(var n in t._databomb)t._resultNameCacheCount++;e(t._resultNameCache)},0)},{ESPMappings:t,ESPUrl:e,WsECL:s,WsWorkunits:o,HIPIERoxie:a,HIPIEWorkunit:f,HIPIEDatabomb:l,createESPConnection:function(t){t=t||document.URL;var n=(new e).url(t);return n.isWsWorkunits_GetStats()?(new u).url(t):n.isWsWorkunits()?(new o).url(t):n.isWsEcl()?(new s).url(t):null}}}),function(e,t){typeof define=="function"&&define.amd?define("marshaller/HipieDDL.js",["../other/Comms","../common/Widget"],t):e.marshaller_HipieDDL=t(e.other_Comms,e.common_Widget)}(this,function(e,t){function s(e,t){this.visualization=e,this.mappings=t,this.hasMappings=!1,this.reverseMappings={},this.columns=[],this.columnsIdx={},this.columnsRHS=[],this.columnsRHSIdx={}}function o(e,t){s.call(this,e,t),this.columns=["label","weight"],this.columnsIdx={label:0,weight:1},this.init()}function u(e,t){s.call(this,e,t),t.state?(this.columns=["state","weight"],this.columnsIdx={state:0,weight:1}):t.county&&(this.columns=["county","weight"],this.columnsIdx={county:0,weight:1}),this.init()}function a(e,t){var n={label:t.x[0]};t.y.forEach(function(e,t){n[e]=e}),s.call(this,e,n),this.init()}function f(e,t){var n={};for(var r in t)t[r].forEach(function(t,r){n[e.label[r]]=t});s.call(this,e,n),this.init()}function l(e,t,n){s.call(this,e,t),this.columns=["uid","label","weight","flags"],this.columnsIdx={uid:0,label:1,weight:2,flags:3},this.init(),this.link=n}function c(e,t){this.visualization=e,this._id=t.id,this._output=t.output,this.mappings=null;switch(this.visualization.type){case"LINE":this.mappings=new a(this.visualization,t.mappings);break;case"TABLE":this.mappings=new f(this.visualization,t.mappings);break;case"GRAPH":this.mappings=new l(this.visualization,t.mappings,t.link);break;case"CHORO":this.mappings=new u(this.visualization,t.mappings,t.link);break;default:this.mappings=new o(this.visualization,t.mappings)}this.first=t.first,this.reverse=t.reverse,this.sort=t.sort}function h(e,t){this.visualization=e,t&&(this._updates=t.updates,this.mappings=t.mappings)}function p(e,t){this.dashboard=e,this.id=t.id,this.label=t.label,this.title=t.title||t.id,this.type=t.type,this.properties=t.properties||t.source.properties||{},this.source=new c(this,t.source),this.onSelect=new h(this,t.onSelect);var i=this;switch(this.type){case"CHORO":this.loadWidget(this.source.mappings.contains("county")?"src/map/ChoroplethCounties":"src/map/ChoroplethStates",function(e){e.id(t.id)});break;case"2DCHART":case"PIE":case"BUBBLE":case"BAR":case"WORD_CLOUD":this.loadWidget("src/chart/MultiChart",function(e){e.id(t.id).chart_type(i.properties.charttype||i.type)});break;case"LINE":this.loadWidget("src/chart/MultiChart",function(e){e.id(t.id).chart_type(i.properties.charttype||i.type)});break;case"TABLE":this.loadWidget("src/other/Table",function(e){e.id(t.id).columns(i.label)});break;case"SLIDER":this.loadWidget("src/other/Slider",function(e){e.id(t.id);if(t.range){var n="";for(var r in t.onSelect.mappings){n=r;break}e.low(+t.range[0]).high(+t.range[1]).step(+t.range[2]).selectionLabel(n)}});break;case"GRAPH":this.loadWidgets(["src/graph/Graph","src/graph/Vertex","src/graph/Edge"],function(e,i){n=i[1],r=i[2],e.id(t.id).layout("ForceDirected2").shrinkToFitOnLayout(!0)});break;default:this.loadWidget("src/common/TextBox",function(e){e.id(t.id).text(i.id+"\n"+"TODO:  "+i.type)})}}function d(e,t){this.dataSource=e,this.id=t.id,this.from=t.from,this.request={},this.notify=t.notify||[],this.filter=t.filter||[]}function v(t,n,r){this.dashboard=t,this.id=n.id,this.filter=n.filter||[],this.WUID=n.WUID,this.URL=n.URL,this.databomb=n.databomb,this.request={};var i=this;this.outputs={};var s=[];n.outputs.forEach(function(e){i.outputs[e.id]=new d(i,e),s.push({id:e.id,from:e.from,filter:e.filter||this.filter})},this),this.WUID?this.comms=(new e.HIPIEWorkunit).url(t.marshaller.espUrl._url).proxyMappings(r).hipieResults(s):this.databomb?this.comms=(new e.HIPIEDatabomb).hipieResults(s):this.comms=(new e.HIPIERoxie).url(n.URL).proxyMappings(r)}function m(e,t,n){this.marshaller=e,this.id=t.id,this.title=t.title;var r=this;this.datasources={},this.datasourceTotal=0,t.datasources.forEach(function(e){r.datasources[e.id]=new v(r,e,n),++r.datasourceTotal}),this.visualizations={},this.visualizationsArray=[],t.visualizations.forEach(function(e){var t=new p(r,e);r.visualizations[e.id]=t,r.visualizationsArray.push(t)}),this.visualizationTotal=this.visualizationsArray.length;var i={};this.visualizationsTree=[];var s=function(e,t){if(e&&!i[e.id]){i[e.id]=!0;var n={visualization:e,children:[]};t.push(n);var r=e.onSelect.getUpdatesVisualizations();r.forEach(function(e){s(e,n.children)})}};this.visualizationsArray.forEach(function(e){s(e,this.visualizationsTree)},this)}function g(){this._proxyMappings={}}var n=null,r=null,i=function(e,t){var n=e.split("."),r=t;for(var i=0;i<n.length;++i){var s=n[i];if(!r||r[s]===undefined)return!1;r=r[s]}return!0};return s.prototype.init=function(){for(var e in this.mappings)this.reverseMappings[this.mappings[e]]=e,this.columnsIdx[e]===undefined&&(this.columns.push(e),this.columnsIdx[e]=this.columns.length-1),this.columnsRHS[this.columnsIdx[e]]=this.mappings[e],this.columnsRHSIdx[this.mappings[e]]=this.columnsIdx[e],this.hasMappings=!0},s.prototype.contains=function(e){return this.mappings[e]!==undefined},s.prototype.doMap=function(e){var t=[];try{for(var n in this.mappings){var r=this.mappings[n],i=e[r];i===undefined&&(i=e[r.toLowerCase()]),t[this.columnsIdx[n]]=i}}catch(s){console.log("Invalid Mappings")}return t},s.prototype.doMapAll=function(e){var t=this;return e.map(function(e){return t.doMap(e)})},s.prototype.getMap=function(e){return this.mappings[e]},s.prototype.getReverseMap=function(e){return this.reverseMappings[e]},o.prototype=Object.create(s.prototype),u.prototype=Object.create(s.prototype),a.prototype=Object.create(s.prototype),f.prototype=Object.create(s.prototype),l.prototype=Object.create(s.prototype),l.prototype.doMapAll=function(e){function o(e){var t="uid_"+e[0],r=i[t];return r||(r=(new n).faChar("").text(e[1]),r.__hpcc_uid=e[0],i[t]=r,s.push(r)),r}var t=this,i={},s=[],u=[];return e.forEach(function(e){var n=t.doMap(e),i=o(n);if(e[t.link.childfile]&&e[t.link.childfile].Row){var s=e[t.link.childfile].Row;s.forEach(function(e,n){var s=t.doMap(e),a=o(s);if(i.id()!==a.id()){var f=(new r).sourceVertex(i).targetVertex(a).sourceMarker("circleFoot").targetMarker("arrowHead");u.push(f)}})}}),{vertices:s,edges:u,merge:!1}},c.prototype.getQualifiedID=function(){return this.visualization.getQualifiedID()+"."+this.id},c.prototype.exists=function(){return this._id},c.prototype.getDatasource=function(){return this.visualization.dashboard.datasources[this._id]},c.prototype.getOutput=function(){var e=this.getDatasource();return e&&e.outputs?e.outputs[this._output]:null},c.prototype.hasData=function(){return this.getOutput().data?!0:!1},c.prototype.getColumns=function(){return this.mappings.columns},c.prototype.getData=function(){var e=this,t=this.getOutput().data;if(this.sort){var e=this;t.sort(function(t,n){for(var r=0;r<e.sort.length;++r){var i=e.sort[r],s=!1;i.indexOf("-")===0&&(i=i.substring(1),s=!0);var o=t[i];o===undefined&&(o=t[i.toLowerCase()]);var u=n[i];u===undefined&&(u=n[i.toLowerCase()]);if(o!==u)return s?u-o:o-u}return 0})}return this.reverse&&t.reverse(),this.first&&t.length>this.first&&(t.length=this.first),this.mappings.doMapAll(t)},h.prototype.exists=function(){return this._updates!==undefined},h.prototype.getUpdatesDatasources=function(){var e={},t=[];return i("_updates",this)&&this._updates instanceof Array?this._updates.forEach(function(n,r){var i=this.visualization.dashboard.datasources[n.datasource];e[i.id]||(e[i.id]=!0,t.push(i))},this):i("_updates.datasource",this)&&t.push(this.visualization.dashboard.datasources[this._updates.datasource]),t},h.prototype.getUpdatesVisualizations=function(){var e={},t=[];return i("_updates",this)&&this._updates instanceof Array?this._updates.forEach(function(n,r){var i=this.visualization.dashboard.visualizations[n.visualization];e[i.id]||(e[i.id]=!0,t.push(i))},this):i("_updates.visualization",this)&&t.push(this.visualization.dashboard.visualizations[this._updates.visualization]),t},p.prototype.getQualifiedID=function(){return this.dashboard.getQualifiedID()+"."+this.id},p.prototype.isLoading=function(e,t){return this.widget===null},p.prototype.isLoaded=function(e,n){return this.widget instanceof t},p.prototype.loadWidget=function(e,t){this.loadWidgets([e],t)},p.prototype.loadWidgets=function(e,t){this.widget=null;var n=this;require(e,function(e){n.setWidget(new e),t&&t(n.widget,arguments)})},p.prototype.setWidget=function(e,t){this.widget=e;var n=this;this.widget.vertex_dblclick?this.widget.vertex_dblclick=function(e){n.click({uid:e.__hpcc_uid})}:this.widget.click&&(this.widget.click=function(e){n.click(e)});if(!t)for(var r in this.properties)if(this.widget[r])try{this.widget[r](this.properties[r])}catch(i){console.log("Invalid Property:"+this.id+".properties."+r)}return this.widget},p.prototype.accept=function(e){e.visit(this)},p.prototype.notify=function(){var e=this;if(this.source.hasData()&&this.widget){var t=this.source.getColumns();this.widget.columns(t);var n=this.source.getData();this.dashboard.marshaller.updateViz(this,n),this.widget.data(n);var r=this.source.getOutput().getParams();i("widget.title",this)?(this.widget.title(this.title+(r?" ("+r+")":"")),this.widget.render()):i("widgetSurface.title",this)?(this.widgetSurface.title(this.title+(r?" ("+r+")":"")),this.widgetSurface.render()):this.widget.render()}},p.prototype.click=function(e){if(this.onSelect.exists()){var t={};for(var n in this.onSelect.mappings){var r=this.source.mappings.hasMappings?this.source.mappings.getReverseMap(n):n;t[this.onSelect.mappings[n]]=e[r]}var i=this.onSelect.getUpdatesDatasources();i.forEach(function(e){e.fetchData(t)})}},d.prototype.getQualifiedID=function(){return this.dataSource.getQualifiedID()+"."+this.id},d.prototype.getParams=function(){var e="";for(var t in this.request)e.length&&(e+=", "),e+=this.request[t];return e},d.prototype.accept=function(e){e.visit(this)},d.prototype.setData=function(e,t){var n=this;this.request=t,this.data=e,this.notify.forEach(function(e){var t=n.dataSource.dashboard.visualizations[e];t.notify()})},v.prototype.getQualifiedID=function(){return this.dashboard.getQualifiedID()+"."+this.id},v.prototype.accept=function(e){e.visit(this);for(var t in this.outputs)this.outputs[t].accept(e)},v.prototype.fetchData=function(e,t){var n=this;this.request.refresh=t?!0:!1,this.filter.forEach(function(e){n.request[e+"_changed"]=!1});for(var r in e)this.request[r]=e[r],this.request[r+"_changed"]=!0;this.comms.call(this.request,function(t){n.processResponse(t,e)})},v.prototype.processResponse=function(e,t){var n={};for(var r in e)n[r.toLowerCase()]=e[r];for(var r in this.outputs){var s=this.outputs[r].from;s||(s=this.outputs[r].id.toLowerCase()),i(s,e)&&(!i(s+"_changed",e)||i(s+"_changed",e)&&e[s+"_changed"].length&&e[s+"_changed"][0][s+"_changed"])?this.outputs[r].setData(e[s],t):i(s,n)&&(console.log("DDL 'DataSource.From' case is Incorrect"),this.outputs[r].setData(n[s],t))}},m.prototype.getQualifiedID=function(){return this.id},m.prototype.accept=function(e){e.visit(this);for(var t in this.datasources)this.datasources[t].accept(e);this.visualizationsArray.forEach(function(t){t.accept(e)},this)},m.prototype.allVisualizationsLoaded=function(){var e=this.visualizationsArray.filter(function(e){return!e.isLoaded()});return e.length===0},g.prototype.accept=function(e){e.visit(this),this.dashboardTotal=0;for(var t in this.dashboards)this.dashboards[t].accept(e),++this.dashboardTotal},g.prototype.url=function(t,n){this.espUrl=(new e.ESPUrl).url(t);var r=null,s="HIPIE_DDL";this.espUrl.isWorkunitResult()?(s=this.espUrl._params.ResultName,r=(new e.HIPIEWorkunit).url(t).proxyMappings(this._proxyMappings)):r=(new e.HIPIERoxie).url(t).proxyMappings(this._proxyMappings);var o={refresh:!1},u=this;r.call(o,function(e){i(s,e)&&r.fetchResult(s,function(r){var i=r[0][s],o=i.split("<RoxieBase>\\");if(o.length>1){var a=o[1].indexOf('"');o[1]=o[1].substring(a),i=o.join(t)}u.parse(i,function(){n(e)})})})},g.prototype.proxyMappings=function(e){return arguments.length?(this._proxyMappings=e,this):this._proxyMappings},g.prototype.parse=function(e,t){var n=this;return this._json=e,this._jsonParsed=JSON.parse(this._json),this.dashboards={},this.dashboardArray=[],this._jsonParsed.forEach(function(e){var t=new m(n,e,n._proxyMappings);n.dashboards[e.id]=t,n.dashboardArray.push(t)}),this.ready(t),this},g.prototype.allDashboardsLoaded=function(){return this.dashboardArray.filter(function(e){return!e.allVisualizationsLoaded()}).length===0},g.prototype.ready=function(e){function n(e){t.allDashboardsLoaded()?e():setTimeout(n,100,e)}if(!e)return;var t=this;n(e)},g.prototype.updateViz=function(e,t){},{exists:i,Marshaller:g,Dashboard:m,DataSource:v,Output:d,Visualization:p}}),function(e,t){typeof define=="function"&&define.amd?define("marshaller/Graph.js",["d3/d3","../common/SVGWidget","../common/TextBox","../common/Surface","../common/ResizeSurface","../chart/MultiChartSurface","../common/Palette","../graph/Graph","../graph/Vertex","../graph/Edge","./HipieDDL"],t):e.marshaller_Graph=t(e.d3,e.common_SVGWidget,e.common_TextBox,e.common_Surface,e.common_ResizeSurface,e.chart_MultiChartSurface,e.common_Palette,e.graph_Graph,e.graph_Vertex,e.graph_Edge,e.marshaller_HipieDDL)}(this,function(e,t,n,r,i,s,o,u,a,f,l){function c(e,t,s){function h(e,t,n,r,i,s){r=r||"",i=i||"",s=s||"",t&&n&&e.vertexMap[t]&&e.vertexMap[n]?e.edges.push((new f).sourceVertex(e.vertexMap[t]).targetVertex(e.vertexMap[n]).sourceMarker(r).targetMarker(i).text(s)):(e.vertexMap[t]||console.log("Unknown Vertex:  "+t),e.vertexMap[n]||console.log("Unknown Vertex:  "+n))}t instanceof Object||t&&(t=JSON.parse(t));var u=null,c={};return e.accept({_visualizeRoxie:s,visit:function(e){if(e instanceof l.Dashboard)u={dashboard:e,vertexMap:{},edges:[]},c[e.getQualifiedID()]=u;else if(e instanceof l.DataSource){e.databomb&&t[e.id]&&e.comms.databomb(t[e.id]);if(this._visualizeRoxie){var s="";e.filter.forEach(function(e){s.length>0&&(s+=", "),s+=e}),s=" ("+s+")",u.vertexMap[e.getQualifiedID()]=(new a).class("vertexLabel").faChar("").text(e.id+s)}}else if(e instanceof l.Output)this._visualizeRoxie&&(u.vertexMap[e.getQualifiedID()]=(new a).class("vertexLabel").faChar("").text(e.id+"\n["+e.from+"]"));else if(e instanceof l.Visualization&&e.widget){var f=null;if(e.widget instanceof r)f=e.widget.size({width:210,height:210});else if(e.widget instanceof n)f=e.widget;else{var h=280,p=210;e.type==="GRAPH"&&(h=800,p=600),f=(new i).size({width:h,height:p}).title(e.title).content(e.widget)}if(f){e.widgetSurface=f,u.vertexMap[e.getQualifiedID()]=f;switch(e.type){case"2DCHART":case"PIE":case"BUBBLE":case"BAR":case"WORD_CLOUD":f.menu(e.widget._2dChartTypes.concat(e.widget._anyChartTypes).map(function(e){return e.display}).sort()),f._menu.click=function(t){e.widget.chart_type(t).render()};break;case"LINE":f.menu(e.widget._multiChartTypes.concat(e.widget._anyChartTypes).map(function(e){return e.display}).sort()),f._menu.click=function(t){e.widget.chart_type(t).render()};break;case"CHORO":f._menu.data(o.rainbow()),f._menu.click=function(e){f._content.paletteID(e).render(e)};break;case"GRAPH":f._menu.data(["Circle","ForceDirected","ForceDirected2","Hierarchy"]),f._menu.click=function(e){f._content.layout(e)}}}}}}),u=null,e.accept({_visualizeRoxie:s,visit:function(e){e instanceof l.Dashboard?u=c[e.getQualifiedID()]:e instanceof l.DataSource||(e instanceof l.Output?this._visualizeRoxie&&h(u,e.dataSource.getQualifiedID(),e.getQualifiedID(),"circleFoot","circleHead"):e instanceof l.Visualization&&(this._visualizeRoxie&&(e.source.getDatasource()&&h(u,e.getQualifiedID(),e.source.getDatasource().getQualifiedID(),"","arrowHead","update"),e.source.getOutput()&&h(u,e.source.getOutput().getQualifiedID(),e.getQualifiedID(),"","arrowHead","notify")),e.onSelect.getUpdatesVisualizations().forEach(function(t){h(u,e.getQualifiedID(),t.getQualifiedID(),undefined,"arrowHead","on Select")})))}}),c}function p(){u.call(this),this._class="marshaller_Graph",this._design_mode=!1,this._dashboards=[],this.graphAttributes=["snapToGrid","showEdges"],this.widgetAttributes=["layout","chartType","palette","title","columns","data"]}var h=2;return p.prototype=Object.create(u.prototype),p.prototype.publish("ddl_url","","string","DDL URL"),p.prototype.publish("databomb","","string","Data Bomb"),p.prototype.publish("proxy_mappings",[],"array","Proxy Mappings"),p.prototype.publish("visualize_roxie",!1,"boolean","Show Roxie Data Sources"),p.prototype.publish(),p.prototype.testData=function(){return this.ddl_url("http://10.173.147.1:8002/WsEcl/submit/query/roxie/drealeed_testaddressclean.ins002_service/json"),this},p.prototype.design_mode=function(e){return arguments.length?(this._design_mode=e,this.showEdges(this._designMode).snapToGrid(this._designMode?12:0).allowDragging(this._designMode),this._data.vertices&&this._data.vertices.forEach(function(e){e.show_title(this._design_mode).render()},this),this):this._design_mode},p.prototype.dashboards=function(e){return arguments.length?(this._dashboards=e,this):this._dashboards},p.prototype.title=function(){var e="";return this._dashboards.forEach(function(t){e&&(e+=", "),e+=t.dashboard.title}),e},p.prototype.renderDashboards=function(e){this.data({vertices:[],edges:[]});var t=this,n=[],r=[];for(var i in this._dashboards){for(var s in this._dashboards[i].vertexMap)n.push(this._dashboards[i].vertexMap[s]);r=r.concat(this._dashboards[i].edges)}this.data({vertices:n,edges:r});var o=e?this.load():{changed:!1,dataChanged:!1};return o.changed&&this.layout(""),o.dataChanged||this.fetchData(),this},p.prototype.fetchData=function(){for(var e in this._dashboards){var t=this._dashboards[e].dashboard;for(var e in t.datasources)t.datasources[e].fetchData({},!0)}return this},p.prototype.checksum=function(e){var t=0,n=e.length,r,i;if(n===0)return t;for(r=0;r<n;r++)i=e.charCodeAt(r),t=(t<<5)-t+i,t&=t;return t},p.prototype.calcHash=function(){var e=this,t=h;for(var n in this._dashboards){var r=this._dashboards[n].dashboard;r.accept({visit:function(n){n instanceof l.Visualization&&(t+=e.checksum(n.getQualifiedID()))}})}return t},p.prototype.clear=function(){localStorage.setItem("Graph_"+this.calcHash(),"")},p.prototype.serialize=function(e,t){e=e||[],t=t||[];var n={};n.zoom={translation:this.zoom.translate(),scale:this.zoom.scale()},e.forEach(function(e){this[e]&&(n[e]=this[e]())},this);for(var r in this._dashboards){var i=this._dashboards[r].dashboard,s=i.getQualifiedID();n[s]={},i.accept({visit:function(e){if(e instanceof l.Visualization&&e.widgetSurface){var r={pos:e.widgetSurface.pos(),size:e.widgetSurface.size()};t.forEach(function(t){e.widget[t]?r[t]=e.widget[t]():e.widgetSurface[t]&&(r[t]=e.widgetSurface[t]())}),n[s][e.getQualifiedID()]=r}}})}return JSON.stringify(n)},p.prototype.save=function(){localStorage.setItem("Graph_"+this.calcHash(),this.serialize(this.graphAttributes,this.widgetAttributes))},p.prototype.deserialize=function(e,t,n){t=t||[],n=n||[];var r=!1,i=!1;t.forEach(function(t){this[t]&&e[t]!==undefined&&this[t](e[t])},this),e.zoom&&(this.setZoom(e.zoom.translation,e.zoom.scale),r=!0);for(var s in this._dashboards){var o=this._dashboards[s].dashboard,u=o.getQualifiedID();o.accept({visit:function(t){if(t instanceof l.Visualization&&e[u]&&e[u][t.getQualifiedID()]){var s=e[u][t.getQualifiedID()];t.widgetSurface.pos(s.pos).size(s.size),r=!0,n.forEach(function(e){t.widget[e]&&s[e]!==undefined?(t.widget[e](s[e]),e==="data"&&(i=!0)):t.widgetSurface[e]&&s[e]&&t.widgetSurface[e](s[e])})}}})}return{changed:r,dataChanged:i}},p.prototype.load=function(){var e={changed:!1,dataChanged:!1},t=localStorage.getItem("Graph_"+this.calcHash());return t&&(e=this.deserialize(JSON.parse(t),this.graphAttributes,this.widgetAttributes)),e},p.prototype.enter=function(e,t){u.prototype.enter.apply(this,arguments),t.classed("graph_Graph",!0)},p.prototype.update=function(e,t){u.prototype.update.apply(this,arguments)},p.prototype.render=function(e){function i(){var r=c(t,n._databomb,n._visualize_roxie);n.dashboards(r),n.shrinkToFitOnLayout(!0).layout("Hierarchy").renderDashboards(!0),u.prototype.render.call(n,function(t){e&&e(t)})}if(this._ddl_url===""||this._ddl_url===this._prev_ddl_url)return u.prototype.render.apply(this,arguments);this._prev_ddl_url=this._ddl_url;var t=(new l.Marshaller).proxyMappings(this._proxy_mappings),n=this,r=arguments;return this._ddl_url[0]==="["||this._ddl_url[0]==="{"?t.parse(this._ddl_url,function(){i()}):t.url(this._ddl_url,function(){i()}),this},p}),function(e,t){typeof define=="function"&&define.amd?define("marshaller/HTML.js",["d3/d3","../layout/Grid","./HipieDDL","../layout/Surface","../layout/Cell"],t):e.marshaller_HTML=t(e.d3,e.layout_Grid,e.marshaller_HipieDDL,e.layout_Surface,e.layout_Cell)}(this,function(e,t,n,r,i){function s(){t.call(this),this._class="marshaller_HTML"}function o(e,t){t instanceof Object||t&&(t=JSON.parse(t));var r=null,i={};return e.accept({visit:function(e){e instanceof n.Dashboard?(r={dashboard:e,visualizations:[]},i[e.getQualifiedID()]=r):e instanceof n.DataSource?e.databomb&&t[e.id]&&e.comms.databomb(t[e.id]):e instanceof n.Output||e instanceof n.Visualization&&e.widget&&r.visualizations.push(e)}}),i}return s.prototype=Object.create(t.prototype),s.prototype.publish("ddl_url","","string","DDL URL"),s.prototype.publish("proxy_mappings",[],"array","Proxy Mappings"),s.prototype.publish("databomb","","string","Data Bomb"),s.prototype.testData=function(){return this},s.prototype.content=function(){return t.prototype.content.apply(this,arguments)},s.prototype.setContent=function(e,n,r,i,s,o){return t.prototype.setContent.apply(this,arguments)},s.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments)},s.prototype.render=function(e){function u(){var n=o(r,i._databomb),s=0;for(var u in n){var a=0,f=0,l=Math.floor(Math.sqrt(n[u].visualizations.length));n[u].visualizations.forEach(function(e,t){t&&t%l===0&&(a++,f=0),e.widget.size({width:0,height:0});var n=i.getContent(e.widget._id);if(n)e.setWidget(n,!0);else{var r=0;i.setContent(a,f,e.widget,e.title)}f++});for(var c in n[u].dashboard.datasources)n[u].dashboard.datasources[c].fetchData({},!0)}t.prototype.render.call(i,function(t){e&&e(t)})}if(this._ddl_url===""||this._ddl_url===this._prev_ddl_url)return t.prototype.render.apply(this,arguments);this._prev_ddl_url=this._ddl_url;var r=(new n.Marshaller).proxyMappings(this._proxy_mappings),i=this,s=arguments;return this._ddl_url[0]==="["||this._ddl_url[0]==="{"?r.parse(this._ddl_url,function(){u()}):r.url(this._ddl_url,function(){u()}),this},s}),function(e,t){typeof define=="function"&&define.amd?define("other/Audio.js",["../common/HTMLWidget"],t):e.other_Audio=t(e.common_HTMLWidget)}(this,function(e){function t(){e.call(this),this._class="other_Audio",this._tag="audio",this._source=[],this._sections={}}return t.prototype=Object.create(e.prototype),t.prototype.source=function(e){return arguments.length?(this._source=e,this):this._source},t.prototype.section=function(e,t,n,r){return arguments.length?arguments.length===1?this._sections[e]:(this._sections[e]={label:e,offset:t,beatLength:n,beatCount:r,endOffset:t+r*n},this):this._sections},t.prototype.getType=function(e){switch(e){case"mp3":return"audio/mpeg; codecs='mp3'";case"ogg":return"audio/ogg; codecs='vorbis'"}return""},t.prototype.enter=function(e,t){var n=this;t.on("play",function(e){n.onPlay(e)})},t.prototype.update=function(e,t){var n=this,r=t.selectAll("source").data(this._source,function(e){return e});r.enter().append("source").attr("src",function(e){return e})},t.prototype.createTimer=function(e,t,n){var r=this;d3.timer(function(){return r.onTick(e.label,n,e),!0},n*e.beatLength,t+e.offset)},t.prototype.onTick=function(e,t,n){},t.prototype.onPlay=function(e){var t=Date.now();for(var n in this._sections){var r=this._sections[n];for(var i=0;i<r.beatCount;++i)this.createTimer(r,t,i)}},t.prototype.play=function(e){var t=this;this._element.on("canplaythrough",function(e){t.node().play()}),this.node().load()},t}),function(e,t){typeof define=="function"&&define.amd?define("other/ISlider",[],t):e.other_ISlider=t()}(this,function(){function e(){}return e.prototype._range={low:0,high:100},e.prototype._step=1,e.prototype._allowRange=!1,e.prototype.click=function(e){console.log("click:  "+e)},e.prototype.newSelection=function(e,t){console.log("newSelection:  "+e+", "+t)},e}),function(e,t){typeof define=="function"&&define.amd?define("other/IWordCloud",[],t):e.other_IWordCloud=t()}(this,function(){function e(){}return e.prototype.testData=function(){this.columns(["Word","Weight"]);var e=["Myriel","Napoleon","Mlle.Baptistine","Mme.Magloire","CountessdeLo","Geborand","Champtercier","Cravatte","Count","OldMan","Labarre","Valjean","Marguerite","Mme.deR","Isabeau","Gervais","Tholomyes","Listolier","Fameuil","Blacheville","Favourite","Dahlia","Zephine","Fantine","Mme.Thenardier","Thenardier","Cosette","Javert","Fauchelevent","Bamatabois","Perpetue","Simplice","Scaufflaire","Woman1","Judge","Champmathieu","Brevet","Chenildieu","Cochepaille","Pontmercy","Boulatruelle","Eponine","Anzelma","Woman2","MotherInnocent","Gribier","Jondrette","Mme.Burgon","Gavroche","Gillenormand","Magnon","Mlle.Gillenormand","Mme.Pontmercy","Mlle.Vaubois","Lt.Gillenormand","Marius","BaronessT","Mabeuf","Enjolras","Combeferre","Prouvaire","Feuilly","Courfeyrac","Bahorel","Bossuet","Joly","Grantaire","MotherPlutarch","Gueulemer","Babet","Claquesous","Montparnasse","Toussaint","Child1","Child2","Brujon","Mme.Hucheloup"].map(function(e){return[e,10+Math.random()*14]});return this.data(e),this},e.prototype.click=function(e){console.log("Click:  "+e.label)},e}),function(e,t){typeof define=="function"&&define.amd?define("other/MorphText.js",["../common/SVGWidget","css!./MorphText"],t):e.other_MorphText=t(e.common_SVGWidget)}(this,function(e){function t(){e.call(this),this._class="other_MorphText",this._text="",this._anchor="middle",this._reverse=!1}return t.prototype=Object.create(e.prototype),t.prototype.text=function(e){if(!arguments.length)return this._text;this._text=e;var t={},n=this._text.split("");return this.data(n.map(function(e){var n="_"+e;return t[n]===undefined&&(t[n]=0),t[n]++,{text:e,id:e.charCodeAt(0)+1024*t[n]}})),this},t.prototype.anchor=function(e){return arguments.length?(this._anchor=e,this):this._anchor},t.prototype.fontSize=function(e){return arguments.length?(this._fontSize=e,this):this._fontSize},t.prototype.reverse=function(e){return arguments.length?(this._reverse=e,this):this._reverse},t.prototype.enter=function(e,t){if(!this._fontSize){var n=window.getComputedStyle(e,null);this._fontSize=parseInt(n.fontSize)}this._fontWidth=this._fontSize*32/48,this._textElement=t.append("g")},t.prototype.dateTime=function(){var e=new Date,t=e.getSeconds().toString().length==1?"0"+e.getSeconds():e.getSeconds(),n=e.getMinutes().toString().length==1?"0"+e.getMinutes():e.getMinutes(),r=e.getHours().toString().length==1?"0"+e.getHours():e.getHours(),i=e.getHours()>=12?"pm":"am",s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return o[e.getDay()]+" "+s[e.getMonth()]+" "+e.getDate()+" "+e.getFullYear()+" "+r+":"+n+":"+t+i},t.prototype.update=function(e,t){var n=this,r=this._textElement.selectAll("text").data(this.data(),function(e){return e.id});r.attr("class","update"),this.transition.apply(r).attr("x",function(e,t){return(-n._data.length/2+t)*n._fontWidth+n._fontWidth/2});var i=r.enter().append("text").attr("class","enter").attr("font-size",this._fontSize).attr("dy",".35em").attr("y",(this._reverse?1:-1)*this._fontWidth*2).attr("x",function(e,t){return(-n._data.length/2+t)*n._fontWidth+n._fontWidth/2}).style("fill-opacity",1e-6).style("text-anchor",this._anchor).text(function(e){return e.text});this.transition.apply(i).attr("y",0).style("fill-opacity",1),r.exit().attr("class","exit"),this.transition.apply(r.exit()).attr("y",(this._reverse?-1:1)*this._fontWidth*2).style("fill-opacity",1e-6).remove()},t}),function(e,t){typeof define=="function"&&define.amd?define("other/PropertyEditor.js",["../common/Widget","../common/HTMLWidget","./Persist"],t):e.other_PropertyEditor=t(e.Common_Widget,e.common_HTMLWidget,e.other_Persist)}(this,function(e,t,n){function r(){t.call(this),this._class="other_PropertyEditor",this._tag="div",this._columns=["Key","Value"],this._contentEditors=[]}r.prototype=Object.create(t.prototype),r.prototype.publish("show_columns",!1,"boolean","Show Columns"),r.prototype.publish("show_data",!1,"boolean","Show Data");var i=function(e,t,n,r,i){if(!e)return"";var s=e._class.split("_"),o="src/"+s.join("/"),u=s[s.length-1],a=n.split("\n").map(function(e){return e.length?"        "+e:""}).join("\n");return a+=a.length?"\n":"",i+=i.length?"\n":"",'require(["'+o+'"], function('+u+") {\n"+"    var "+t+" = new "+u+"()\n"+'        .target("divID")\n'+a+"        .render("+r.split("\n").join("\n        ")+")\n"+"    ;\n"+i+"});"},s=function(e,t,n){var r=t.split("\n").map(function(e){return e.length?"        "+e:""}).join("\n");return r+=r.length?"\n":"","function(widget) {\n    widget."+e+"\n"+r+"        .render("+n+")\n"+"    ;\n"+"}"},o=function(e,t,r){if(!e)return"";var i=n.discover(e).map(function(t){return e[t.id+"_modified"]()?"."+t.id+"("+JSON.stringify(e[t.id]())+")":""}).filter(function(e){return e!==""}).join("\n");if(t){var s=e.columns();s instanceof Array?s.length&&(i+=i.length?"\n":"",i+=".columns("+JSON.stringify(s)+")"):s&&(i+=i.length?"\n":"",i+=".columns("+JSON.stringify(s)+")")}if(r){var o=e.data();if(o instanceof Array)o.length&&(i+=i.length?"\n":"",i+=".data("+JSON.stringify(o)+")");else if(o){i+=i.length?"\n":"";try{i+=".data("+JSON.stringify(o)+")"}catch(u){i+=".data("+u+")"}}}return i};return r.prototype.getJavaScript=function(e,t,n,r){r=r||"";var u="";return this._data._content&&(u=s("_content",o(this._data._content,t,n),"")),i(this._data,e,o(this._data,t,n),u,r)},r.prototype.getPersistString=function(e){return"var "+e+" = "+JSON.stringify(n.serializeToObject(this._data,null,!1),null,"  ")+";"},r.prototype.onChange=function(e,t){},r.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments),this._parentElement.style("overflow","auto")},r.prototype.update=function(e,i){t.prototype.update.apply(this,arguments);var s=this,o=i.selectAll("#"+this._id+" > table").data(this._data,function(e){return e._id});o.enter().append("table").each(function(e){var t=d3.select(this),n=t.append("thead").append("tr"),r=t.append("tbody"),i=n.selectAll("th").data(s._columns,function(e){return e});i.enter().append("th").text(function(e){return e}),i.exit().remove()}),o.select("tbody").each(function(e){var t=d3.select(this),i=t.selectAll(".tr_"+e._id).data(n.discover(e),function(t){return e._id+"_"+t.id+"_"+t.type}),o=i.enter().append("tr").attr("class","tr_"+e._id).each(function(t){var n=d3.select(this);n.append("td").attr("class","label").text(function(e){return e.id});var i=n.append("td").attr("class","field").each(function(){var n=d3.select(this),i=null;switch(t.type){case"boolean":i=n.append("input").attr("class","input_"+e._id).attr("type","checkbox").on("change",function(){e[t.id](this.checked).render(function(){s.onChange(e,t.id),s.render()})});break;case"number":case"string":i=n.append("input").attr("class","input_"+e._id).on("change",function(){e[t.id](this.value).render(function(e){s.onChange(e,t.id),s.render()})});break;case"html-color":i=n.append("input").attr("class","input_"+e._id).on("change",function(){e[t.id](this.value).render(function(e){s.onChange(e,t.id),s.render()})});if(!s.isIE)try{var o=i,u=n.append("input").attr("type","color").on("change",function(){var e=o.node();e.value=this.value,o.on("change").apply(o.node())});u.node().value=e[t.id]()}catch(a){u.remove()}break;case"set":i=n.append("select").attr("class","input_"+e._id).on("change",function(){e[t.id](this.value).render(function(e){s.onChange(e,t.id),s.render()})}),t.set.forEach(function(e){var t=i.append("option").attr("value",e).text(e)});break;case"array":i=n.append("textarea").attr("class","input_"+e._id).attr("rows","4").attr("cols","25").on("change",function(){e[t.id](JSON.parse(this.value)).render(function(){s.onChange(e,t.id),s.render()})});break;case"widget":case"widgetArray":i=n.append("div").attr("class","input_"+e._id),e["_propertyEditor_"+t.id]=(new r).target(i.node()),e["_propertyEditor_"+t.id].onChange=function(e,t){s.onChange(e,t)};break;default:}})});i.select(".input_"+e._id).each(function(t){var n=d3.select(this);switch(t.type){case"boolean":n.node().checked=e[t.id]();break;case"html-color":n.node().value=e[t.id]();break;case"array":n.node().value=JSON.stringify(e[t.id](),null,"  ");break;case"widget":var r=e[t.id]();e["_propertyEditor_"+t.id].data(r?[r]:[]).render();break;case"widgetArray":e["_propertyEditor_"+t.id].data(e[t.id]()).render();break;case"number":case"string":case"set":default:n.node().value=e[t.id]()}}),i.exit().each(function(e){var t=d3.select(this);console.log("PropertyEditor exit:"+e._class+e._id);switch(e.type){case"widget":e.propertyEditor.target(null);break;case"widgetArray":t.html("")}}).remove();if(this._show_columns){var u=this.tbody.append("tr"),a=u.append("td").text("columns");a=u.append("td");var f=a.append("textarea").attr("rows","4").attr("cols","25").on("change",function(){e.columns(JSON.parse(this.value)).render(function(){s.onChange(e,"columns")})});f.node().value=JSON.stringify(this._data._columns)}if(this._show_columns){var u=this.tbody.append("tr"),a=u.append("td").text("data");a=u.append("td"),f=a.append("textarea").attr("rows","4").attr("cols","25").on("change",function(){e.data(JSON.parse(this.value)).render(function(){s.onChange("data")})});try{f.node().value=JSON.stringify(this._data._data)}catch(l){f.node().value=l}}}),o.exit().each(function(e){}).remove()},r.prototype.exit=function(e,n){t.prototype.exit.apply(this,arguments)},r.prototype.click=function(e){},r}),function(e,t){typeof define=="function"&&define.amd?define("other/Slider.js",["../common/SVGWidget","./ISlider","css!./Slider"],t):e.other_Slider=t(e.common_SVGWidget,e.other_ISlider)}(this,function(e,t){function n(){e.call(this),t.call(this),this._class="other_Slider",this._selectionLabel="",this.xScale=d3.scale.linear().clamp(!0);var n=this;this.brush=d3.svg.brush().x(this.xScale).extent([0,0]).on("brushstart",function(e){n.brushstart(e,this)}).on("brush",function(e){n.brushmove(e,this)}).on("brushend",function(e){n.brushend(e,this)}),this.brush.empty=function(){return!1},this.axis=d3.svg.axis().scale(this.xScale).orient("bottom").tickFormat(function(e){return e}).tickSize(0).tickPadding(12)}return n.prototype=Object.create(e.prototype),n.prototype.implements(t.prototype),n.prototype.publish("allowRange",!1,"boolean","Allow Range Selection"),n.prototype.publish("low",0,"number","Low"),n.prototype.publish("high",100,"number","High"),n.prototype.publish("step",10,"number","Step"),n.prototype.publish("selectionLabel","","string","Selection Label"),n.prototype.testData=function(e){return this.columns("Percent"),this.data(66),this},n.prototype.testData2=function(e){return this.allowRange(!0),this.columns("Percent"),this.data([44,66]),this},n.prototype.data=function(t){var n=e.prototype.data.apply(this,arguments);return arguments.length&&this.brushg&&this.brushg.call(this.brush.extent(this._allowRange?this._data:[this._data,this._data])),n},n.prototype.enter=function(e,t){(this._high-this._low)/this._step<=10&&this.axis.tickValues(d3.merge([d3.range(this._low,this._high,this._step),[this._high]])),this.axisElement=t.append("g").attr("class","x axis"),this.brushg=t.append("g").attr("class","brush").call(this.brush),this.brushg.select(".background").attr("y",-9).attr("height",18),this.brushg.select(".extent").attr("y","-10").attr("height","20"),this.brushg.selectAll(".resize").select("rect").attr("x",function(e){return e==="e"?0:-8}).attr("y","-10").attr("width","8").attr("height","20"),this.handle=this.brushg.selectAll(".resize").append("path").attr("class","handle").attr("transform","translate(0,-27)")},n.prototype.update=function(e,t){var n=this,r=this.width()-50;this.xScale.domain([this._low,this._high]).range([-r/2,r/2]),this.axisElement.call(this.axis);var i=this.xScale.range();this.brushg.select(".background").attr("x",i[0]).attr("width",i[1]-i[0]),this.handle.attr("d",function(e){return n.handlePath(e)});if(this._initHandle===undefined){this._initHandle=!0;var s=[this._low,this._low];if(this._allowRange&&this._data)var s=this._data;else this._data&&(s=[this._data,this._data]);this.brushg.call(this.brush.extent(s))}},n.prototype.brushstart=function(e,t){if(!d3.event||!d3.event.sourceEvent)return;d3.event.sourceEvent.stopPropagation()},n.prototype.brushmove=function(e,t){if(!d3.event||!d3.event.sourceEvent)return;d3.event.sourceEvent.stopPropagation();if(!this._allowRange){var n=this.xScale.invert(d3.mouse(t)[0]);d3.select(t).call(this.brush.extent([n,n]))}},n.prototype.brushend=function(e,t){if(!d3.event||!d3.event.sourceEvent)return;d3.event.sourceEvent.stopPropagation();if(!this._allowRange){var n=this.nearestStep(this.xScale.invert(d3.mouse(t)[0]));d3.select(t).call(this.brush.extent([n,n])),this._data=n;if(this._selectionLabel){var r={};r[this._selectionLabel]=n,this.click(r)}else this.click(n)}else{var i=this.brush.extent();i[0]=this.nearestStep(i[0]),i[1]=this.nearestStep(i[1]),this._data=i,d3.select(t).call(this.brush.extent(i)),this.newSelection(i[0],i[1])}},n.prototype.nearestStep=function(e){return this._low+Math.round((e-this._low)/this._step)*this._step},n.prototype.handlePath=function(e,t){var n=+(e==="e"),r=n?1:-1,i=this._allowRange?.5:0,s=18,o="M"+i*r+","+s+"A6,6 0 0 "+n+" "+6.5*r+","+(s+6)+"V"+(2*s-6)+"A6,6 0 0 "+n+" "+i*r+","+2*s;return this._allowRange?o+="ZM"+2.5*r+","+(s+8)+"V"+(2*s-8)+"M"+4.5*r+","+(s+8)+"V"+(2*s-8):o+="M"+1*r+","+(s+8)+"V"+(2*s-8),o},n}),function(e,t){typeof define=="function"&&define.amd?define("other/Table.js",["../common/HTMLWidget","css!./Table"],t):e.other_Table=t(e.common_HTMLWidget)}(this,function(e){function t(){e.call(this),this._class="other_Table",this._tag="table",this._columns=[]}return t.prototype=Object.create(e.prototype),t.prototype.enter=function(t,n){e.prototype.enter.apply(this,arguments),this._parentElement.style("overflow","auto"),this.thead=n.append("thead").append("tr"),this.tbody=n.append("tbody")},t.prototype.update=function(t,n){e.prototype.update.apply(this,arguments);var r=this,i=this.thead.selectAll("th").data(this._columns,function(e){return e});i.enter().append("th").text(function(e){return e}),i.exit().remove();var s=this.tbody.selectAll("tr").data(this._data);s.enter().append("tr").on("click",function(e){r.click(r.rowToObj(e))}),s.exit().remove();var o=s.selectAll("td").data(function(e,t){return e});o.enter().append("td"),o.text(function(e){return e instanceof String?e.trim():e}),o.exit().remove()},t.prototype.exit=function(e,t){this.thead.remove(),this.tbody.remove()},t.prototype.click=function(e){},t}),function(e,t){typeof define=="function"&&define.amd?define("other/WordCloud.js",["../common/SVGWidget","./IWordCloud","d3/d3","css!./WordCloud"],t):e.other_WordCloud=t(e.common_SVGWidget,e.other_IWordCloud,e.d3)}(this,function(e,t,n){function r(){e.call(this),t.call(this),this._class="other_WordCloud"}return r.prototype=Object.create(e.prototype),r.prototype.implements(t.prototype),r.prototype.publish("padding",1,"number","Padding"),r.prototype.publish("font","Verdana","string","Font Name"),r.prototype.publish("fontSizeFrom",6,"number","Font Size From"),r.prototype.publish("fontSizeTo",24,"number","Font Size To"),r.prototype.publish("angleFrom",-60,"number","Angle From"),r.prototype.publish("angleTo",60,"number","Angle To"),r.prototype.publish("angleCount",5,"number","Angle Count"),r.prototype.data=function(t){var n=e.prototype.data.apply(this,arguments);return arguments.length&&(this._vizData=t.map(function(e){var t={};for(var n in e)t["__viz_"+n]=e[n];return t})),n},r.prototype.enter=function(e,t){this.cloud=n.layout.cloud().font(this._font).padding(this._padding),this.svg=t.append("g")},r.prototype.update=function(e,t){function u(e,t){var i=n.scale.category20(),o=r.svg.selectAll("text").data(e,function(e){return e.__viz_0?e.__viz_0.toLowerCase():""});o.transition().duration(1e3).attr("transform",function(e){return"translate("+[e.x,e.y]+")rotate("+e.rotate+")"}).style("font-size",function(e){return s(e.__viz_1)+"px"}).style("opacity",1),o.enter().append("text").attr("text-anchor","middle").attr("transform",function(e){return"translate("+[e.x,e.y]+")rotate("+e.rotate+")"}).style("font-size",function(e){return s(e.__viz_1)+"px"}).style("font-family",function(e){return e.font}).style("fill",function(e){return i(e.__viz_0?e.__viz_0.toLowerCase():"")}).text(function(e){return e.__viz_0}).on("click",function(e){r.click({label:e.__viz_0,weight:e.__viz_1})}).style("opacity",1e-6).transition().duration(1e3).style("opacity",1),o.exit().transition().duration(1e3).style("opacity",1e-4).remove();if(t){var u=r.width(),a=r.height(),f=t[1].x-t[0].x,l=t[1].y-t[0].y,c=.9/Math.max(f/u,l/a);r.svg.transition().delay(1e3).duration(750).attr("transform","scale("+c+")")}}var r=this,i=n.extent(this._vizData,function(e){return e.__viz_1}),s=n.scale.log().domain(i).range([this._fontSizeFrom,this._fontSizeTo]),o=n.scale.linear().domain([0,r._angleCount-1]).range([r._angleFrom,r._angleTo]);this.cloud.size([this.width(),this.height()]).words(this._vizData).rotate(function(){return o(~~(Math.random()*r._angleCount))}).fontSize(function(e){return s(e.__viz_1)}).on("end",u).start()},r.prototype.render=function(t){var n=this;return require(["d3-cloud/d3.layout.cloud"],function(r){e.prototype.render.call(n,t)}),this},r}),function(e,t){typeof define=="function"&&define.amd?define("tree/ITree.js",["../common/Palette"],t):e.tree_ITree=t(e.common_Palette)}(this,function(e){function t(){}return t.prototype._palette=e.ordinal("default"),t.prototype.testData=function(){var e={label:"root",children:[{label:"A",children:[{label:"AA",children:[{label:"AAA"}]},{label:"AB",children:[{label:"ABA"}]}]},{label:"B",children:[{label:"BA",children:[{label:"BAA"}]},{label:"BB"}]}]};return this.data(e),this},t.prototype.click=function(e){console.log("Click:  "+e.label)},t}),function(e,t){typeof define=="function"&&define.amd?define("tree/CirclePacking.js",["d3/d3","../common/SVGWidget","./ITree","../common/Text","../common/FAChar","css!./CirclePacking"],t):e.tree_CirclePacking=t(e.d3,e.common_SVGWidget,e.tree_ITree,e.common_Text,e.common_FAChar)}(this,function(e,t,n,r,i){function s(e){t.call(this),n.call(this),this._class="tree_CirclePacking"}return s.prototype=Object.create(t.prototype),s.prototype.implements(n.prototype),s.prototype.publish("paletteID","default","set","Palette ID",s.prototype._palette.switch()),s.prototype.enter=function(t,n){var r=this;this.diameter=Math.min(this.width(),this.height()),this.pack=e.layout.pack().size([this.diameter-4,this.diameter-4]).value(function(e){return 1}),this.svg=n.append("g").attr("transform","rotate(30)")},s.prototype.update=function(t,n){var r=this;this._palette=this._palette.switch(this._paletteID),this.svg.selectAll("circle").remove(),this.svg.selectAll("text").remove();var i=this._data,s=i,o=this.pack.nodes(i);this.circle=this.svg.selectAll("circle").data(o).enter().append("circle").attr("class",function(e){return e.parent?e.children?"node":"node leaf":"node root"}).style("fill",function(e){return r._palette(e.label)}).on("click",function(e){r.click(e)}).on("dblclick",function(t){s!==t&&(r.zoom(t),e.event.stopPropagation())}),this.circle.append("title").text(function(e){return e.label});var u=this.svg.selectAll("text").data(o).enter().append("text").attr("class","label").style("fill-opacity",function(e){return e.parent===i?1:0}).style("display",function(e){return e.parent===i?null:"none"}).text(function(e){return e.label});this.node=this.svg.selectAll("circle,text"),this.zoomTo([i.x,i.y,i.r*2])},s.prototype.zoom=function(t){var n=this,r=i,i=t,s=this.svg.selectAll("circle").filter(function(e){return e===i}),o=this.svg.selectAll("text").filter(function(e){return e!==i&&this.style.display==="inline"});o.transition().duration(500).style("opacity",0).each("end",function(t){t!==i&&e.select(this).style("display","none").style("opacity",1)});var u=this.svg.transition().duration(1e3).tween("zoom",function(t){var r=e.interpolateZoom(n.view,[i.x,i.y,i.r*2]);return function(e){n.zoomTo(r(e))}});u.selectAll("text").filter(function(e){return e.parent===i||this.style.display==="inline"}).style("fill-opacity",function(e){return e.parent===i?1:0}).each("start",function(e){e.parent===i&&(this.style.display="inline")}).each("end",function(e){e.parent!==i&&(this.style.display="none")})},s.prototype.zoomTo=function(e){var t=this.diameter/e[2];this.view=e,this.node.attr("transform",function(n){return"translate("+(n.x-e[0])*t+","+(n.y-e[1])*t+")rotate(-30)"}),this.circle.attr("r",function(e){return e.r*t})},s}),function(e,t){typeof define=="function"&&define.amd?define("tree/Dendrogram.js",["d3/d3","../common/SVGWidget","./ITree","css!./Dendrogram"],t):e.tree_Dendrogram=t(e.d3,e.common_SVGWidget,e.tree_ITree)}(this,function(e,t,n){function r(e){t.call(this),n.call(this),this._class="tree_Dendrogram"}return r.prototype=Object.create(t.prototype),r.prototype.implements(n.prototype),r.prototype.publish("paletteID","default","set","Palette ID",r.prototype._palette.switch()),r.prototype.enter=function(n,r){t.prototype.enter.apply(this,arguments),this.layout=e.layout.cluster(),this.diagonal=e.svg.diagonal().projection(function(e){return[e.y,e.x]}),this.g=r.append("g")},r.prototype.update=function(e,n){var r=this;t.prototype.update.apply(this,arguments),this._palette=this._palette.switch(this._paletteID);var i=this.width()-60;this.layout.size([this.height(),i]),this.g.attr("transform","translate("+ -i/2+","+ -this.height()/2+")");var s=this.layout.nodes(this.data()),o=this.layout.links(s),u=this.g.selectAll(".link").data(o);u.enter().append("path").attr("class","link"),u.attr("d",this.diagonal),u.exit().remove();var s=this.g.selectAll(".node").data(s),a=s.enter().append("g").attr("class","node");a.on("click",function(e){r.click(e)}),a.append("circle"),a.append("text"),s.select("circle").attr("r",4.5).style("fill",function(e){return r._palette(e.label)}).append("title").text(function(e){return e.label}),s.select("text").attr("dx",function(e){return e.children?-8:8}).attr("dy",3),s.attr("transform",function(e){return"translate("+e.y+","+e.x+")"}),s.select("text").style("text-anchor",function(e){return e.children?"end":"start"}).text(function(e){return e.label}),s.exit().remove()},r}),function(e,t){typeof define=="function"&&define.amd?define("tree/SunburstPartition.js",["d3/d3","../common/SVGWidget","./ITree","../common/Text","../common/FAChar","css!./SunburstPartition"],t):e.tree_SunburstPartition=t(e.d3,e.common_SVGWidget,e.tree_ITree,e.common_Text,e.common_FAChar)}(this,function(e,t,n,r,i){function s(e){t.call(this),n.call(this),this._class="tree_SunburstPartition"}return s.prototype=Object.create(t.prototype),s.prototype.implements(n.prototype),s.prototype.publish("paletteID","default","set","Palette ID",s.prototype._palette.switch()),s.prototype.root=function(e){return arguments.length?(this._root=e,this.svg&&this.svg.selectAll("path").transition().duration(750).attrTween("d",this.arcTweenFunc(this._root)),this):this._root||this._data},s.prototype.data=function(){var e=t.prototype.data.apply(this,arguments);return arguments.length&&(this._resetRoot=!0),this},s.prototype.enter=function(t,n){var r=this;this.radius=Math.min(this.width(),this.height())/2,this._xScale=e.scale.linear().range([0,2*Math.PI]),this._yScale=e.scale.sqrt().range([0,this.radius]),this.partition=e.layout.partition().value(function(e){return e.value!==undefined?e.value:1}),this.arc=e.svg.arc().startAngle(function(e){return Math.max(0,Math.min(2*Math.PI,r._xScale(e.x)))}).endAngle(function(e){return Math.max(0,Math.min(2*Math.PI,r._xScale(e.x+e.dx)))}).innerRadius(function(e){return Math.max(0,r._yScale(e.y))}).outerRadius(function(e){return Math.max(0,r._yScale(e.y+e.dy))}),this.svg=n.append("g")},s.prototype.update=function(t,n){function o(t){e.event&&e.event.stopPropagation(),r.root(t)}var r=this;this._palette=this._palette.switch(this._paletteID),this.radius=Math.min(this.width(),this.height())/2,this._xScale.range([0,2*Math.PI]),this._yScale.range([0,this.radius]),this._dataNodes=this.partition.nodes(this._data);var i=this.svg.selectAll("path").data(this._dataNodes,function(e,t){return e.id!==undefined?e.id:t}),s=i.enter().append("path").on("click",function(e){r.click(e)}).on("dblclick",o).append("title");i.attr("d",this.arc).style("fill",function(e){return e.__viz_fill?e.__viz_fill:r._palette(e.label)}).style("stroke",function(e){return e.value>16?"white":"none"}).select("title").text(function(e){return e.label}),i.exit().remove(),this._resetRoot&&(this._resetRoot=!1,this.root(this._dataNodes[0]))},s.prototype.arcTweenFunc=function(t){var n=e.interpolate(this._xScale.domain(),[t.x,t.x+t.dx]),r=e.interpolate(this._yScale.domain(),[t.y,1]),i=e.interpolate(this._yScale.range(),[t.y?20:0,this.radius]),s=this;return function(e,t){return t?function(t){return s.arc(e)}:function(t){return s._xScale.domain(n(t)),s._yScale.domain(r(t)).range(i(t)),s.arc(e)}}},s});