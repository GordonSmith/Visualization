(function(e,t){typeof define=="function"&&define.amd?define(["../common/HTMLWidget","./Cell","../common/Text","../chart/Pie","../chart/MultiChart","../c3/Column","../c3/Line","css!./Grid"],t):e.Layout_Grid=t(e.HTMLWidget,e.Layout_Cell,e.Text,e.Chart_Pie,e.Chart_MultiChart,e.C3_Column,e.C3_Line)})(this,function(e,t,n,r,i,s,o){function u(){e.call(this),this._class="layout_Grid",this._tag="div",this._content=[]}return u.prototype=Object.create(e.prototype),u.prototype.publish("gutter",4,"number","Gap Between Widgets"),u.prototype.publish("fitTo","all","set","Sizing Strategy",["all","width"]),u.prototype.publish("content",[],"widgetArray","widgets"),u.prototype.testData=function(){return this.setContent(0,0,(new r).testData()),this.setContent(0,1,(new r).testData()),this.setContent(1,0,(new r).testData()),this.setContent(1,1,(new r).testData()),this.setContent(0,2,(new i).testData(),"Title AAA",2,2),this.setContent(2,0,(new o).testData(),"Title BBB",2,4),this},u.prototype.getDimensions=function(){var e={width:0,height:0};return this._content.forEach(function(t){e.width<t.gridCol()+t.gridColSpan()&&(e.width=t.gridCol()+t.gridColSpan()),e.height<t.gridRow()+t.gridRowSpan()&&(e.height=t.gridRow()+t.gridRowSpan())},this),e},u.prototype.clearContent=function(){this._content=this._content.filter(function(e){return e.target(null),!1})},u.prototype.setContent=function(e,n,r,i,s,o){s=s||1,o=o||1,i=i||"",this._content=this._content.filter(function(t){return t._gridRow===e&&t._gridCol===n?(t.target(null),!1):!0});if(r){var u=(new t).gridRow(e).gridCol(n).widget(r).title(i).gridRowSpan(s).gridColSpan(o);this._content.push(u)}return this},u.prototype.getContent=function(e){var t=null;return this._content.some(function(n){return n._widget._id===e?(t=n._widget,!0):!1}),t},u.prototype.childMoved=u.prototype.debounce(function(e,t){this.render()},250),u.prototype.enter=function(t,n){e.prototype.enter.apply(this,arguments),n.style("position","relative"),this._scrollBarWidth=this.getScrollbarWidth()},u.prototype.update=function(t,n){e.prototype.update.apply(this,arguments),this._parentElement.style("overflow-x",this._fitTo==="width"?"hidden":null),this._parentElement.style("overflow-y",this._fitTo==="width"?"scroll":null);var r=this.getDimensions(),i=(this.width()-(this._fitTo==="width"?this._scrollBarWidth:0))/r.width,s=this._fitTo==="all"?this.height()/r.height:i,o=this,u=n.selectAll(".cell_"+this._id).data(this._content,function(e){return e._id});u.enter().append("div").attr("class","cell_"+this._id).style("position","absolute").each(function(e){e.target(this),e.__grid_watch=e.watch(function(e,t,n){o._renderCount&&e.indexOf("grid")===0&&t!==n&&o.childMoved()})}),u.style("left",function(e){return e.gridCol()*i+o._gutter/2+"px"}).style("top",function(e){return e.gridRow()*s+o._gutter/2+"px"}).style("width",function(e){return e.gridColSpan()*i-o._gutter+"px"}).style("height",function(e){return e.gridRowSpan()*s-o._gutter+"px"}).each(function(e){e.resize()}),u.exit().each(function(e){e.target(null),e.__grid_watch&&e.__grid_watch.remove()}).remove()},u.prototype.exit=function(t,n){e.prototype.exit.apply(this,arguments)},u.prototype.render=function(t){var n=this;return e.prototype.render.call(this,function(e){if(n._content.length){var r=n._content.length;n._content.forEach(function(n,i){setTimeout(function(){n.render(function(){--r===0&&t&&t(e)})},0)})}else t&&t(e)}),this},u});