(function(e,t){typeof define=="function"&&define.amd?define(["d3/d3","../layout/Grid","./HipieDDL","../layout/Surface","../layout/Cell"],t):e.HTML=t(e.d3,e.Layout_Grid,e.HipieDDL,e.Layout_Surface,e.Layout_Cell)})(this,function(e,t,n,r,i){function s(){t.call(this),this._class="marshaller_HTML"}function o(e,t){t instanceof Object||(t=JSON.parse(t));var r=null,i={};return e.accept({visit:function(e){e instanceof n.Dashboard?(r={dashboard:e,visualizations:[]},i[e.getQualifiedID()]=r):e instanceof n.DataSource?e.databomb&&t[e.id]&&e.comms.databomb(t[e.id]):e instanceof n.Output||e instanceof n.Visualization&&e.widget&&r.visualizations.push(e)}}),i}return s.prototype=Object.create(t.prototype),s.prototype.publish("ddl_url","","string","DDL URL"),s.prototype.publish("proxy_mappings",[],"array","Proxy Mappings"),s.prototype.publish("databomb","","string","Data Bomb"),s.prototype.testData=function(){return this},s.prototype.content=function(){return t.prototype.content.apply(this,arguments)},s.prototype.setContent=function(e,n,r,i,s,o){return t.prototype.setContent.apply(this,arguments)},s.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments)},s.prototype.render=function(e){function u(){var n=o(r,i._databomb),s=0;for(var u in n){var a=0,f=0,l=Math.floor(Math.sqrt(n[u].visualizations.length));n[u].visualizations.forEach(function(e,t){t&&t%l===0&&(a++,f=0),e.widget.size({width:0,height:0});var n=i.getContent(e.widget._id);if(n)e.setWidget(n,!0);else{var r=0;i.setContent(a,f,e.widget,e.title)}f++});for(var c in n[u].dashboard.datasources)n[u].dashboard.datasources[c].fetchData({},!0)}t.prototype.render.call(i,function(t){e&&e(t)})}if(this._ddl_url===""||this._ddl_url===this._prev_ddl_url)return t.prototype.render.apply(this,arguments);this._prev_ddl_url=this._ddl_url;var r=(new n.Marshaller).proxyMappings(this._proxy_mappings),i=this,s=arguments;return this._ddl_url[0]==="["||this._ddl_url[0]==="{"?r.parse(this._ddl_url,function(){u()}):r.url(this._ddl_url,function(){u()}),this},s});