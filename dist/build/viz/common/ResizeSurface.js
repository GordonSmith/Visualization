(function(e,t){typeof define=="function"&&define.amd?define(["./Surface","css!./ResizeSurface"],t):e.common_ResizeSurface=t(e.common_Surface)})(this,function(e){function t(){e.call(this),this.handleWidth=8,this.handles=[{loc:"NW"},{loc:"N"},{loc:"NE"},{loc:"E"},{loc:"SE"},{loc:"S"},{loc:"SW"},{loc:"W"}],this._allowResize=!0;var t=this;this.dispatch=d3.dispatch("sizestart","size","sizeend"),this.drag=d3.behavior.drag().origin(function(e){return e}).on("dragstart",function(e){t.dispatch.sizestart(t,e.loc),t._allowResize&&(d3.event.sourceEvent.stopPropagation(),t._dragHandlePos={x:e.x,y:e.y},t._dragStartPos=t.pos(),t._dragStartSize=t.size(),t._prevPosSize={x:t._dragStartPos.x,y:t._dragStartPos.y,width:t._dragStartSize.width,height:t._dragStartSize.height},t._textPosSize=t._text.getBBox(!0),t._iconPosSize=t._icon.getBBox(!0),t.showContent(!1))}).on("drag",function(e){if(t._allowResize){d3.event.sourceEvent.stopPropagation();var n=d3.event.x-t._dragHandlePos.x,r=d3.event.y-t._dragHandlePos.y,i={x:0,y:0,w:0,h:0};switch(e.loc){case"NW":i.x=n/2,i.w=-n;case"N":i.y=r/2,i.h=-r;break;case"NE":i.y=r/2,i.h=-r;case"E":i.x=n/2,i.w=n;break;case"SE":i.x=n/2,i.w=n;case"S":i.y=r/2,i.h=r;break;case"SW":i.y=r/2,i.h=r;case"W":i.x=n/2,i.w=-n}var s={x:t._dragStartPos.x+i.x,y:t._dragStartPos.y+i.y,width:t._dragStartSize.width+i.w,height:t._dragStartSize.height+i.h};s.width<t._iconPosSize.width*2+t._textPosSize.width&&(s.x=t._prevPosSize.x,s.width=t._prevPosSize.width),s.height<t._textPosSize.height+48&&(s.y=t._prevPosSize.y,s.height=t._prevPosSize.height),t.pos({x:s.x,y:s.y},!1,!1).size({width:s.width,height:s.height}).render().getBBox(!0),t.dispatch.size(t,e.loc),t._prevPosSize=s}}).on("dragend",function(e){t._allowResize&&(d3.event.sourceEvent.stopPropagation(),t.showContent(!0).render(),t._container.getBBox(!0),t._titleRect.getBBox(!0),t.dispatch.sizeend(t,e.loc))})}return t.prototype=Object.create(e.prototype),t.prototype.allowResize=function(e){return arguments.length?(this._allowResize=e,this):this._allowResize},t.prototype.move=function(t){var n=e.prototype.move.apply(this,arguments);return this.updateHandles(this._domNode,this._element),n},t.prototype.update=function(t,n){e.prototype.update.apply(this,arguments),this.updateHandles(t,n)},t.prototype.updateHandles=function(e,t){var n=this._parentElement.selectAll("rect").data(this.handles,function(e){return e.loc});n.enter().append("rect").attr("class",function(e){return"resize"+e.loc}).call(this.drag);var r=this._pos.x+this._container._pos.x-this._container.width()/2,i=this._pos.y+this._titleRect._pos.y-this._titleRect.height()/2,s=this._pos.x+this._container._pos.x+this._container.width()/2,o=this._pos.y+this._container._pos.y+this._container.height()/2,u=s-r,a=o-i,f=this;n.each(function(e){switch(e.loc){case"NW":e.x=r-f.handleWidth/2,e.y=i-f.handleWidth/2,e.width=f.handleWidth,e.height=f.handleWidth;break;case"N":e.x=r+f.handleWidth/2,e.y=i-f.handleWidth/2,e.width=u-f.handleWidth,e.height=f.handleWidth;break;case"NE":e.x=s-f.handleWidth/2,e.y=i-f.handleWidth/2,e.width=f.handleWidth,e.height=f.handleWidth;break;case"E":e.x=s-f.handleWidth/2,e.y=i+f.handleWidth/2,e.width=f.handleWidth,e.height=a-f.handleWidth;break;case"SE":e.x=s-f.handleWidth/2,e.y=o-f.handleWidth/2,e.width=f.handleWidth,e.height=f.handleWidth;break;case"S":e.x=r+f.handleWidth/2,e.y=o-f.handleWidth/2,e.width=u-f.handleWidth,e.height=f.handleWidth;break;case"SW":e.x=r-f.handleWidth/2,e.y=o-f.handleWidth/2,e.width=f.handleWidth,e.height=f.handleWidth;break;case"W":e.x=r-f.handleWidth/2,e.y=i+f.handleWidth/2,e.width=f.handleWidth,e.height=a-f.handleWidth}d3.select(this).attr("x",e.x).attr("y",e.y).attr("width",e.width).attr("height",e.height)})},t});