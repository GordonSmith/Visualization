(function(e,t){typeof define=="function"&&define.amd?define(["d3/d3","../common/SVGWidget","./ITree","css!./Dendrogram"],t):e.tree_Dendrogram=t(e.d3,e.common_SVGWidget,e.tree_ITree)})(this,function(e,t,n){function r(e){t.call(this),n.call(this),this._class="tree_Dendrogram",this._drawStartPos="origin",this._maxTextWidth=0}return r.prototype=Object.create(t.prototype),r.prototype.implements(n.prototype),r.prototype.publish("paletteID","default","set","Palette ID",r.prototype._palette.switch()),r.prototype.publish("textOffset",8,"number","Text offset from circle"),r.prototype.enter=function(n,r){t.prototype.enter.apply(this,arguments),this.layout=e.layout.cluster(),this.diagonal=e.svg.diagonal().projection(function(e){return[e.y,e.x]})},r.prototype.update=function(n,r,i){var s=this;t.prototype.update.apply(this,arguments),this._palette=this._palette.switch(this._paletteID),this.x(this._maxTextWidth);var o=this.width()-this._maxTextWidth*2;this.layout.size([this.height(),o]);var u=this.layout.nodes(this.data()),a=this.layout.links(u),f=r.selectAll(".link").data(a);f.enter().append("path").attr("class","link"),f.attr("d",this.diagonal),f.exit().remove();var u=r.selectAll(".node").data(u);u.enter().append("g").attr("class","node").on("click",function(e){s.click(e)}).each(function(t){var n=e.select(this);n.append("circle"),n.append("text")});var l=0;u.attr("transform",function(e){return"translate("+e.y+","+e.x+")"}),u.select("circle").attr("r",4.5).style("fill",function(e){return s._palette(e.label)}).append("title").text(function(e){return e.label}),u.select("text").style("text-anchor",function(e){return e.children?"end":"start"}).attr("dx",function(e){return e.children?-s._textOffset:s._textOffset}).attr("dy",3).text(function(e){return e.label}).each(function(t){if(!i){var n=e.select(this).node().getBBox();n.width>l&&(l=n.width)}}),l+=this._textOffset,u.exit().remove(),!i&&this._maxTextWidth!==l&&(this._maxTextWidth=l,this.update(n,r,!0))},r});