(function(e,t){typeof define=="function"&&define.amd?define(["../common/Widget","../common/HTMLWidget","./Persist"],t):e.PropertyEditor=t(e.Widget,e.HTMLWidget,e.Persist)})(this,function(e,t,n){function r(){t.call(this),this._class="other_PropertyEditor",this._tag="div",this._columns=["Key","Value"],this._contentEditors=[]}r.prototype=Object.create(t.prototype),r.prototype.publish("show_columns",!1,"boolean","Show Columns"),r.prototype.publish("show_data",!1,"boolean","Show Data");var i=function(e,t,n,r,i){if(!e)return"";var s=e._class.split("_"),o="src/"+s.join("/"),u=s[s.length-1],a=n.split("\n").map(function(e){return e.length?"        "+e:""}).join("\n");return a+=a.length?"\n":"",i+=i.length?"\n":"",'require(["'+o+'"], function('+u+") {\n"+"    var "+t+" = new "+u+"()\n"+'        .target("divID")\n'+a+"        .render("+r.split("\n").join("\n        ")+")\n"+"    ;\n"+i+"});"},s=function(e,t,n){var r=t.split("\n").map(function(e){return e.length?"        "+e:""}).join("\n");return r+=r.length?"\n":"","function(widget) {\n    widget."+e+"\n"+r+"        .render("+n+")\n"+"    ;\n"+"}"},o=function(e,t,r){if(!e)return"";var i=n.discover(e).map(function(t){return e[t.id+"_modified"]()?"."+t.id+"("+JSON.stringify(e[t.id]())+")":""}).filter(function(e){return e!==""}).join("\n");if(t){var s=e.columns();s instanceof Array?s.length&&(i+=i.length?"\n":"",i+=".columns("+JSON.stringify(s)+")"):s&&(i+=i.length?"\n":"",i+=".columns("+JSON.stringify(s)+")")}if(r){var o=e.data();if(o instanceof Array)o.length&&(i+=i.length?"\n":"",i+=".data("+JSON.stringify(o)+")");else if(o){i+=i.length?"\n":"";try{i+=".data("+JSON.stringify(o)+")"}catch(u){i+=".data("+u+")"}}}return i};return r.prototype.getJavaScript=function(e,t,n,r){r=r||"";var u="";return this._data._content&&(u=s("_content",o(this._data._content,t,n),"")),i(this._data,e,o(this._data,t,n),u,r)},r.prototype.getPersistString=function(e){return"var "+e+" = "+JSON.stringify(n.serializeToObject(this._data,null,!1),null,"  ")+";"},r.prototype.onChange=function(e,t){},r.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments),this._parentElement.style("overflow","auto")},r.prototype.update=function(e,i){t.prototype.update.apply(this,arguments);var s=this,o=i.selectAll("#"+this._id+" > table").data(this._data,function(e){return e._id});o.enter().append("table").each(function(e){var t=d3.select(this),n=t.append("thead").append("tr"),r=t.append("tbody"),i=n.selectAll("th").data(s._columns,function(e){return e});i.enter().append("th").text(function(e){return e}),i.exit().remove()}),o.select("tbody").each(function(e){var t=d3.select(this),i=t.selectAll(".tr_"+e._id).data(n.discover(e),function(t){return e._id+"_"+t.id+"_"+t.type}),o=i.enter().append("tr").attr("class","tr_"+e._id).each(function(t){var n=d3.select(this);n.append("td").attr("class","label").text(function(e){return e.id});var i=n.append("td").attr("class","field").each(function(){var n=d3.select(this),i=null;switch(t.type){case"boolean":i=n.append("input").attr("class","input_"+e._id).attr("type","checkbox").on("change",function(){e[t.id](this.checked).render(function(){s.onChange(e,t.id),s.render()})});break;case"number":case"string":i=n.append("input").attr("class","input_"+e._id).on("change",function(){e[t.id](this.value).render(function(e){s.onChange(e,t.id),s.render()})});break;case"html-color":i=n.append("input").attr("class","input_"+e._id).on("change",function(){e[t.id](this.value).render(function(e){s.onChange(e,t.id),s.render()})});if(!s.isIE)try{var o=i,u=n.append("input").attr("type","color").on("change",function(){var e=o.node();e.value=this.value,o.on("change").apply(o.node())});u.node().value=e[t.id]()}catch(a){u.remove()}break;case"set":i=n.append("select").attr("class","input_"+e._id).on("change",function(){e[t.id](this.value).render(function(e){s.onChange(e,t.id),s.render()})}),t.set.forEach(function(e){var t=i.append("option").attr("value",e).text(e)});break;case"array":i=n.append("textarea").attr("class","input_"+e._id).attr("rows","4").attr("cols","25").on("change",function(){e[t.id](JSON.parse(this.value)).render(function(){s.onChange(e,t.id),s.render()})});break;case"widget":case"widgetArray":i=n.append("div").attr("class","input_"+e._id),e["_propertyEditor_"+t.id]=(new r).target(i.node()),e["_propertyEditor_"+t.id].onChange=function(e,t){s.onChange(e,t)};break;default:}})});i.select(".input_"+e._id).each(function(t){var n=d3.select(this);switch(t.type){case"boolean":n.node().checked=e[t.id]();break;case"html-color":n.node().value=e[t.id]();break;case"array":n.node().value=JSON.stringify(e[t.id](),null,"  ");break;case"widget":var r=e[t.id]();e["_propertyEditor_"+t.id].data(r?[r]:[]).render();break;case"widgetArray":e["_propertyEditor_"+t.id].data(e[t.id]()).render();break;case"number":case"string":case"set":default:n.node().value=e[t.id]()}}),i.exit().each(function(e){var t=d3.select(this);console.log("PropertyEditor exit:"+e._class+e._id);switch(e.type){case"widget":e.propertyEditor.target(null);break;case"widgetArray":t.html("")}}).remove();if(this._show_columns){var u=this.tbody.append("tr"),a=u.append("td").text("columns");a=u.append("td");var f=a.append("textarea").attr("rows","4").attr("cols","25").on("change",function(){e.columns(JSON.parse(this.value)).render(function(){s.onChange(e,"columns")})});f.node().value=JSON.stringify(this._data._columns)}if(this._show_columns){var u=this.tbody.append("tr"),a=u.append("td").text("data");a=u.append("td"),f=a.append("textarea").attr("rows","4").attr("cols","25").on("change",function(){e.data(JSON.parse(this.value)).render(function(){s.onChange("data")})});try{f.node().value=JSON.stringify(this._data._data)}catch(l){f.node().value=l}}}),o.exit().each(function(e){}).remove()},r.prototype.exit=function(e,n){t.prototype.exit.apply(this,arguments)},r.prototype.click=function(e){},r});