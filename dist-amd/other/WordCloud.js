!function(t,e){"function"==typeof define&&define.amd?define(["d3","../common/SVGWidget","../api/I2DChart","../api/ITooltip","d3-cloud","css!./WordCloud"],e):t.other_WordCloud=e(t.d3,t.common_SVGWidget,t.api_I2DChart,t.api_ITooltip,t.d3.layout.cloud)}(this,function(t,e,o,i,n){function s(){e.call(this),o.call(this),i.call(this),this._prevOffsetX=this.offsetX(),this._prevOffsetY=this.offsetY(),this._prevZoom=this.zoom()}return s.prototype=Object.create(e.prototype),s.prototype.constructor=s,s.prototype._class+=" other_WordCloud",s.prototype["implements"](o.prototype),s.prototype["implements"](i.prototype),s.prototype.publish("paletteID","default","set","Palette ID",s.prototype._palette["switch"](),{tags:["Basic","Shared"]}),s.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),s.prototype.publish("fontFamily","Impact","string","Font Name",null,{tags:["Basic"]}),s.prototype.publish("fontSizeFrom",6,"number","Font Size From",null,{tags:["Basic"]}),s.prototype.publish("fontSizeTo",48,"number","Font Size To",null,{tags:["Basic"]}),s.prototype.publish("angleFrom",-60,"number","Angle From",null,{tags:["Basic"]}),s.prototype.publish("angleTo",60,"number","Angle To",null,{tags:["Basic"]}),s.prototype.publish("angleCount",5,"number","Angle Count",null,{tags:["Basic"]}),s.prototype.publish("padding",0,"number","Padding",null,{tags:["Intermediate"]}),s.prototype.publish("scaleMode","linear","set","Text scaling mode",["linear","log","sqrt","pow"],{tags:["Intermediate"]}),s.prototype.publish("spiral","archimedean","set","Text scaling mode",["archimedean","rectangular"],{tags:["Intermediate"]}),s.prototype.publish("offsetX",0,"number","X offset",null,{tags:["Advanced"]}),s.prototype.publish("offsetY",0,"number","Y offset",null,{tags:["Advanced"]}),s.prototype.publish("zoom",1,"number","Zoom",null,{tags:["Advanced"]}),s.prototype.data=function(t){var o=e.prototype.data.apply(this,arguments);return arguments.length&&(this._vizData=t.map(function(t){var e={};for(var o in t)e["__viz_"+o]=t[o];return e})),o},s.prototype.enter=function(o,i){e.prototype.enter.apply(this,arguments),this._root=i.append("g"),this._canvas=document.createElement("canvas");var s=this;this._zoom=t.behavior.zoom().scaleExtent([.1,10]).on("zoom",function(){s.zoomed(s._zoom,t.event.translate,t.event.scale)}),i.call(this._zoom),this._cloud=(new n).canvas(this._canvas)},s.prototype.update=function(o,i){function n(t,e){var o=s._root.selectAll("text").data(t,function(t){return t.__viz_0?t.__viz_0.toLowerCase():""});o.enter().append("text").attr("text-anchor","middle").text(function(t){return t.__viz_0}).on("click",function(t){s.click({label:t.__viz_0,weight:t.__viz_1})}).style("opacity",1e-6).on("mouseover.tooltip",function(t){s.tooltipShow([t.__viz_0,t.__viz_1],s.columns(),1)}).on("mouseout.tooltip",function(t){s.tooltipShow()}).on("mousemove.tooltip",function(t){s.tooltipShow([t.__viz_0,t.__viz_1],s.columns(),1)}),o.style("font-size",function(t){return r(t.__viz_1)+"px"}).style("font-family",s.fontFamily()).transition().duration(1e3).attr("transform",function(t){return"translate("+[t.x,t.y]+")rotate("+t.rotate+")"}).style("fill",function(t){return s._palette(t.__viz_0?t.__viz_0.toLowerCase():"")}).style("opacity",1),o.exit().transition().duration(1e3).style("opacity",1e-4).remove()}e.prototype.update.apply(this,arguments),this._palette=this._palette["switch"](this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id())),this.zoomed(this,[this.offsetX(),this.offsetY()],this.zoom());var s=this,a=t.extent(this._vizData,function(t){return t.__viz_1}),r=t.scale[this.scaleMode()]().domain(a).range([this.fontSizeFrom(),this.fontSizeTo()]),l=t.scale.linear().domain([0,s.angleCount()-1]).range([s.angleFrom(),s.angleTo()]);this._cloud.stop().size([this.width(),this.height()]).words(this._vizData).font(this.fontFamily()).padding(this.padding()).spiral(this.spiral()).text(function(t){return t.__viz_0}).fontSize(function(t){return r(t.__viz_1)}).rotate(function(){return l(~~(Math.random()*s.angleCount()))}).on("end",n).start()},s.prototype.zoomed=function(t,e,o){if(e[0]!==this._prevOffsetX||e[1]!==this._prevOffsetY||o!==this._prevZoom){switch(this._root.attr("transform","translate("+e[0]+","+e[1]+")scale("+o+")"),t){case this:this._zoom.scale(o).translate(e);break;case this._zoom:this.offsetX(e[0]),this.offsetY(e[1]),this.zoom(o)}this._prevOffsetX=e[0],this._prevOffsetY=e[1],this._prevZoom=o}},s});