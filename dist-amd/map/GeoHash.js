!function(t,e){"function"==typeof define&&define.amd?define(["d3","topojson","./Layer","./Utility","../common/Palette","../common/Utility","css!./GeoHash"],e):t.map_GeoHash=e(t.d3,t.topojson,t.map_Layer,t.map_Utility,t.common_Palette,t.common_Utility)}(this,function(t,e,a,o,i,s){function n(){a.call(this)}return n.prototype=Object.create(a.prototype),n.prototype.constructor=n,n.prototype._class+=" map_GeoHash",n.prototype._palette=i.rainbow("default"),n.prototype.publish("paletteID","YlOrRd","set","Palette ID",n.prototype._palette["switch"](),{tags:["Basic","Shared"]}),n.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),n.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),n.prototype.publish("meshVisible",!0,"boolean","Mesh Visibility"),n.prototype.publish("meshColor",null,"html-color","Stroke Color",null,{optional:!0}),n.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),n.prototype.data=function(t){var e=a.prototype.data.apply(this,arguments);return arguments.length&&(this._dataMinWeight=null,this._dataMaxWeight=null,this.data().forEach(function(t){(!this._dataMinWeight||t[1]<this._dataMinWeight)&&(this._dataMinWeight=t[1]),(!this._dataMaxWeight||t[1]>this._dataMaxWeight)&&(this._dataMaxWeight=t[1])},this)),e},n.prototype.layerEnter=function(e,i,n){a.prototype.layerEnter.apply(this,arguments),this.geohash=new o.Geohash,this._geoHashTransform=i.append("g"),this._selection=new s.SimpleSelection(this._geoHashTransform),this.geoHashPaths=t.select(null)},n.prototype.layerUpdate=function(t){a.prototype.layerUpdate.apply(this,arguments),this._palette=this._palette["switch"](this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id())),this._geoHashTransform.style("opacity",this.opacity()),this.geoHashPaths=this._geoHashTransform.selectAll(".data").data(this.visible()?this.data():[],function(t){return t[0]});var e=this;this.geoHashPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(t){e.click(e.rowToObj(t),"weight",e._selection.selected(this))}),this.geoHashPaths.attr("d",function(a){var o=e.geohash.bounds(a[0]),i={type:"LineString",coordinates:[[o.sw.lon,o.ne.lat],[o.ne.lon,o.ne.lat],[o.ne.lon,o.sw.lat],[o.sw.lon,o.sw.lat]]};return t._d3GeoPath(i)}).style("fill",function(t){var a=e._palette(t[1],e._dataMinWeight,e._dataMaxWeight);return a}),this.geoHashPaths.exit().remove()},n.prototype.layerZoomed=function(t){a.prototype.layerZoomed.apply(this,arguments),this._geoHashTransform.attr("transform","translate("+t._zoom.translate()+")scale("+t._zoom.scale()+")").attr("stroke-width",1.5/t._zoom.scale()+"px")},n.prototype.click=function(t,e,a){console.log("Click:  "+JSON.stringify(t)+", "+e+", "+a)},n});