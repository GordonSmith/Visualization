!function(e,t){"function"==typeof define&&define.amd?define(["d3","./GMap","../common/SVGWidget"],t):e.map_GMapLayered=t(e.d3,e.map_GMap,e.common_SVGWidget)}(this,function(e,t,o){function r(){o.call(this),this._drawStartPos="origin"}function a(){t.call(this),this._layers=[]}var n=1/16,i=4096;return r.prototype=Object.create(o.prototype),r.prototype.constructor=r,r.prototype._class+=" map_Layered map_GMapLayered",r.prototype.enter=function(t,r){o.prototype.enter.apply(this,arguments),this._zoom=e.behavior.zoom().translate([0,0]).scale(1),this._d3GeoProjection=e.geo.mercator().scale(i/2/Math.PI).translate([0,0]),this._d3GeoPath=e.geo.path().projection(this._d3GeoProjection)},r.prototype.update=function(e,t){o.prototype.update.apply(this,arguments),this._hasZoomed=!0,this._hasRendered?this.zoomed():this.fullRender()},r.prototype.fullRender=function(){if(this._hasZoomed){this._hasRendered=!0,this.size(this.gmap.size());var t=this._element.selectAll(".layerContainer").data(this.gmap.layers(),function(e){return e.id()}),o=this;t.enter().append("g").attr("class","layerContainer").each(function(t){var r=e.select(this),a=o._parentOverlay.append("div");t.layerEnter(o,r,a)}),t.each(function(e){e.layerUpdate(o)}),t.exit().each(function(e){e.layerExit(o)}).remove(),this.zoomed()}},r.prototype.zoomed=function(){var e=this.gmap._overlay.getProjection();if(e){var t=new google.maps.LatLng(0,0),o=e.fromLatLngToDivPixel(t),r=parseFloat(this.surface.widgetX()),a=parseFloat(this.surface.widgetY()),i=[o.x-r,o.y-a],p=this.gmap._googleMap.getZoom();this._zoom.scale(n*(1<<p)).translate(i);var s=this._element.selectAll(".layerContainer"),c=this;s.each(function(e){e.layerZoomed(c)})}},r.prototype.projection=function(){return"mercator"},r.prototype.project=function(e,t){var o=this.surface.project(e,t);return[o.x,o.y]},a.prototype=Object.create(t.prototype),a.prototype.constructor=a,a.prototype._class+=" map_GMapLayered",a.prototype.updateCircles=function(){},a.prototype.updatePins=function(){},a.prototype.layers=function(e){return arguments.length?(this._layers=e,this):this._layers},a.prototype.enter=function(){t.prototype.enter.apply(this,arguments),this.layered=new r,this.layered.gmap=this,this.layered.surface=this._viewportSurface,this.layered.surface.widget(this.layered).render()},a.prototype.render=function(e){var o=t.prototype.render.apply(this,arguments);return this.layered.fullRender(),o},a});