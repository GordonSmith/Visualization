!function(t,e){"function"==typeof define&&define.amd?define(["d3","topojson","./Layer","./Utility","css!./OpenStreet"],e):t.map_OpenStreet=e(t.d3,t.topojson,t.map_Layer,t.map_Utility)}(this,function(t,e,r,i){function o(){r.call(this)}return o.prototype=Object.create(r.prototype),o.prototype.constructor=o,o.prototype._class+=" map_OpenStreet",o.prototype._copyrightText="Â© OpenStreetMap contributors",o.prototype.publish("tileProvider","OpenStreetMap","set","Tile Provider",["OpenStreetMap","OpenStreetMap Hot","MapQuest","MapQuest Sat","Stamen Watercolor","OpenCycleMap"],{tags:["Basic","Shared"]}),o.prototype.layerEnter=function(t,e,o){r.prototype.layerEnter.apply(this,arguments),this._tile=i.Tile(),this._openStreetTransform=e.append("g"),this._openStreet=this._openStreetTransform.append("g"),this._copyright=e.append("text").attr("x",-100).attr("y",-100).style("opacity",.5).text(this._copyrightText),this._copyrightBBox=this._copyright.node().getBBox()},o.prototype.layerUpdate=function(t){this.visible()?this._copyright.attr("x",t.width()-this._copyrightBBox.width-this._copyrightBBox.height/2).attr("y",t.height()-this._copyrightBBox.height/2).text(this._copyrightText):this._copyright.text("")},o.prototype.layerZoomed=function(t){var e=[];if(this.visible()){var r=t.project(-85,180);(!r||r[0]<=0||r[1]<=0)&&(r=[t.width(),t.height()]),this._tile.size([Math.min(t.width(),r[0]),Math.min(t.height(),r[1])]).scale(4096*t._zoom.scale()).translate(t._zoom.translate()),e=this._tile(),this._openStreetTransform.attr("transform","scale("+e.scale+")translate("+e.translate+")")}this._prevTileProvider!==this.tileProvider()&&(this._openStreet.selectAll("image").remove(),this._prevTileProvider=this.tileProvider());var i=this,o=this._openStreet.selectAll("image").data(e,function(t){return t[2]+"/"+t[0]+"/"+t[1]});o.enter().append("image").attr("xlink:href",function(t){switch(i.tileProvider()){case"OpenStreetMap Hot":return"http://"+["a","b","c"][3*Math.random()|0]+".tile.openstreetmap.fr/hot/"+t[2]+"/"+t[0]+"/"+t[1]+".png";case"MapQuest":return"http://otile"+["1","2","3","4"][4*Math.random()|0]+".mqcdn.com/tiles/1.0.0/osm/"+t[2]+"/"+t[0]+"/"+t[1]+".png";case"MapQuest Sat":return"http://otile"+["1","2","3","4"][4*Math.random()|0]+".mqcdn.com/tiles/1.0.0/sat/"+t[2]+"/"+t[0]+"/"+t[1]+".png";case"Stamen Watercolor":return"http://"+["a","b","c"][3*Math.random()|0]+".tile.stamen.com/watercolor/"+t[2]+"/"+t[0]+"/"+t[1]+".png";case"OpenCycleMap":return"http://"+["a","b"][2*Math.random()|0]+".tile.opencyclemap.org/cycle/"+t[2]+"/"+t[0]+"/"+t[1]+".png";default:return"http://"+["a","b","c"][3*Math.random()|0]+".tile.openstreetmap.org/"+t[2]+"/"+t[0]+"/"+t[1]+".png"}}).attr("width",1).attr("height",1).attr("x",function(t){return t[0]}).attr("y",function(t){return t[1]}).style("opacity",0).transition().duration(500).style("opacity",1),o.exit().remove()},o});