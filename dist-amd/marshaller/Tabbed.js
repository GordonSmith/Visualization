!function(t,a){"function"==typeof define&&define.amd?define(["d3","../layout/Tabbed","../layout/Grid","./HipieDDL","../layout/Surface","../layout/Cell"],a):t.marshaller_Tabbed=a(t.d3,t.layout_Tabbed,t.layout_Grid,t.marshaller_HipieDDL,t.layout_Surface,t.layout_Cell)}(this,function(t,a,r,o,i,e){function s(){a.call(this)}function n(t,a){a instanceof Object||a&&(a=JSON.parse(a));var r=null,i={};return t.accept({visit:function(t){t instanceof o.Dashboard?(r={dashboard:t,visualizations:[]},i[t.getQualifiedID()]=r):t instanceof o.DataSource?t.databomb&&a[t.id]&&t.comms.databomb(a[t.id]):t instanceof o.Output?t.dataSource.databomb&&t.dataSource.comms.databombOutput(t.from,t.id):t instanceof o.Visualization&&t.widget&&r.visualizations.push(t)}}),i}return s.prototype=Object.create(a.prototype),s.prototype.constructor=s,s.prototype._class+=" marshaller_Tabbed",s.prototype.publish("ddlUrl","","string","DDL URL",null,{tags:["Private"]}),s.prototype.publish("databomb","","string","Data Bomb",null,{tags:["Private"]}),s.prototype.publish("proxyMappings",{},"object","Proxy Mappings",null,{tags:["Private"]}),s.prototype.publish("designMode",!1,"boolean","Design Mode",null,{tags:["Basic"]}),s.prototype.testData2=function(){return this.ddlUrl("http://10.241.100.159:8002/WsEcl/submit/query/roxie/hipie_testrelavator3.ins002_service/json"),this},s.prototype._origDesignMode=s.prototype.designMode,s.prototype.designMode=function(t){var a=s.prototype._origDesignMode.apply(this,arguments);return arguments.length&&this.widgets().forEach(function(a){a.widget().designMode(t)}),a},s.prototype.render=function(i){function e(){var t=n(l.marshaller,l.databomb());if(!s.length){l.marshaller.dashboardTotal<=1&&l.showTabs(!1);for(var o in t){var e=new r;l.addTab(e,t[o].dashboard.title);var d=0,p=0,u=Math.floor(Math.sqrt(t[o].visualizations.length));t[o].visualizations.forEach(function(t,a){a&&a%u===0&&(d++,p=0),t.widget.size({width:0,height:0}),e.setContent(d,p,t.widget,t.title),p++})}}for(var h in t)for(var c in t[h].dashboard.datasources)t[h].dashboard.datasources[c].fetchData({},!0);a.prototype.render.call(l,function(t){i&&i(t)})}if(""===this.ddlUrl()||this.ddlUrl()===this._prev_ddlUrl&&this.databomb()===this._prev_databomb)return a.prototype.render.apply(this,arguments);this._prev_ddlUrl&&this._prev_ddlUrl!==this.ddlUrl()&&this.clearTabs(),this._prev_ddlUrl=this.ddlUrl(),this._prev_databomb=this.databomb();var s=[];this.widgets().forEach(function(t){s=s.concat(t.widget().content())});var l=this;return this.marshaller=(new o.Marshaller).proxyMappings(this.proxyMappings()).widgetMappings(t.map(s.map(function(t){return t.widget()}),function(t){return t.id()})).on("commsError",function(t,a){l.commsError(t,a)}),"["===this.ddlUrl()[0]||"{"===this.ddlUrl()[0]?this.marshaller.parse(this.ddlUrl(),function(){e()}):this.marshaller.url(this.ddlUrl(),function(){e()}),this},s.prototype.commsError=function(t,a){alert("Comms Error:\n"+t+"\n"+a)},s});