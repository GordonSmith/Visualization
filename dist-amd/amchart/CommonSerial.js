!function(t,e){"function"==typeof define&&define.amd?define(["d3","../common/HTMLWidget","amcharts-serial","require","../common/Utility","./SerialAxis"],e):t.amchart_CommonSerial=e(t.d3,t.common_HTMLWidget,t.AmCharts,t.require,t.common_Utility,t.amchart_SerialAxis)}(this,function(t,e,i,a,s,r){function o(){e.call(this),this._tag="div",this._chart={},this._selected=null,this._selections=[],this._dataUpdated=0,this._prevDataUpdated=-1,this._columnsUpdated=0,this._prevColumnsUpdated=-1,this._dateParserData=t.time.format("%Y-%m-%d").parse,this._dateParserValue=t.time.format("%Y-%m-%d").parse,this._colorObj={},this._selectionObj={},this._xAxis=new r,this._xAxis.owningWidget=this,this._yAxis=new r,this._yAxis.owningWidget=this}return o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.prototype._class+=" amchart_CommonSerial",o.prototype.publish("backwardsCompatible",!0,"boolean","Allow use of old publish parameters"),o.prototype.publish("xAxes",[],"propertyArray","xAxis",null,{max:1,tags:["Basic"]}),o.prototype.publish("yAxes",[],"propertyArray","yAxis",null,{tags:["Basic"]}),o.prototype.publish("fontSize",11,"number","Font Size",null,{tags:["Basic","Shared"]}),o.prototype.publish("fontFamily","Verdana","string","Font Name",null,{tags:["Basic","Shared","Shared"]}),o.prototype.publish("fontColor","#000000","html-color","Font Color",null,{tags:["Basic","Shared"]}),o.prototype.publish("lineWidth",1,"number","Line Thickness",null,{min:0,max:10,step:1,inputType:"range",tags:["Basic","Shared"]}),o.prototype.publish("lineColor",null,"html-color","Color of the data/content lines",null,{tags:["Basic","Shared"]}),o.prototype.publish("lineOpacity",1,"number","Line Opacity",null,{min:0,max:1,step:.001,inputType:"range",tags:["Basic","Shared"]}),o.prototype.publish("dashedLineStyle",0,"number","Length of Dashed Line. 0 = none",null,{tags:["Advanced","Shared"]}),o.prototype.publish("marginLeft",null,"number","Margin (Left)",null,{tags:["Intermediate"]}),o.prototype.publish("marginRight",null,"number","Margin (Right)",null,{tags:["Intermediate"]}),o.prototype.publish("marginTop",null,"number","Margin (Top)",null,{tags:["Intermediate"]}),o.prototype.publish("marginBottom",null,"number","Margin (Bottom)",null,{tags:["Intermediate"]}),o.prototype.publish("showScrollbar",!1,"boolean","Show Chart Scrollbar",null,{tags:["Intermediate","Shared"]}),o.prototype.publish("orientation","horizontal","set","Orientation",["horizontal","vertical"],{tags:["Intermediate"]}),o.prototype.publish("startDuration",.3,"number","Start Duration (sec)",null,{tags:["Private"]}),o.prototype.publish("useImgPatterns",!1,"boolean","Enable Image Pattern backgrounds",null,{tags:["Private"]}),o.prototype.publish("imgPatternArr",'["../ampatterns/black/pattern2.png"]',"string","Background Pattern Images (Not used if '[]')",null,{inputType:"textarea",tags:["Private"]}),o.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),o.prototype.publish("axisMinPeriod","MM","string","Minimum period when parsing dates"),o.prototype.publish("selectionColor","#f00","html-color","Font Color",null,{tags:["Basic"]}),o.prototype.publish("selectionMode","simple","set","Selection Mode",["simple","multi"],{tags:["Intermediate"]}),o.prototype.publish("showCursor",!1,"boolean","Show Chart Scrollbar",null,{tags:["Intermediate","Shared"]}),o.prototype.publish("showFirstLabel",!0,"boolean","Show first label",null,{tags:["Intermediate","Shared"]}),o.prototype.publish("showLastLabel",!0,"boolean","Show last label",null,{tags:["Intermediate","Shared"]}),o.prototype.publish("equalSpacing",!1,"boolean","Show Chart Scrollbar",null,{tags:["Intermediate","Shared"]}),o.prototype.publish("paletteGrouping","By Column","set","Palette Grouping",["By Category","By Column"],{tags:["Basic"]}),o.prototype.publish("y2",[],"array","Columns to associate with second Y-Axis"),o.prototype.publish("axisLineWidth",1,"number","Axis Line Width",null,{tags:["Intermediate","Shared"]}),o.prototype.publish("axisAlpha",1,"number","Axis Alpha",null,{tags:["Intermediate"]}),o.prototype.publish("startOnAxis",!0,"boolean","Draw Chart Starting On Axis.",null,{tags:["Intermediate"]}),o.prototype.publish("xAxisShowAllLabels",!1,"boolean","show All Category Axis Labels",null,{tags:["Intermediate"]}),o.prototype.publish("axisFontSize",null,"number","X/Y Axis Text Font Size",null,{tags:["Basic","Shared"]}),o.prototype.publishProxy("xAxisBaselineColor","_xAxis","axisBaselineColor"),o.prototype.publishProxy("yAxisBaselineColor","_yAxis","axisBaselineColor"),o.prototype.publishProxy("xAxisFontColor","_xAxis","axisFontColor"),o.prototype.publishProxy("yAxisFontColor","_yAxis","axisFontColor"),o.prototype.publishProxy("xAxisTitle","_xAxis","axisTitle"),o.prototype.publishProxy("yAxisTitle","_yAxis","axisTitle"),o.prototype.publishProxy("xAxisTitleFontSize","_xAxis","axisTitleFontSize"),o.prototype.publishProxy("yAxisTitleFontSize","_yAxis","axisTitleFontSize"),o.prototype.publishProxy("xAxisTitleFontColor","_xAxis","axisTitleFontColor"),o.prototype.publishProxy("yAxisTitleFontColor","_yAxis","axisTitleFontColor"),o.prototype.publishProxy("xAxisLabelRotation","_xAxis","axisLabelRotation"),o.prototype.publishProxy("yAxisLabelRotation","_yAxis","axisLabelRotation"),o.prototype.publishProxy("xAxisAutoGridCount","_xAxis","axisAutoGridCount"),o.prototype.publishProxy("yAxisAutoGridCount","_yAxis","axisAutoGridCount"),o.prototype.publishProxy("xAxisGridPosition","_xAxis","axisGridPosition"),o.prototype.publishProxy("xAxisBoldPeriodBeginning","_xAxis","axisBoldPeriodBeginning"),o.prototype.publishProxy("yAxisBoldPeriodBeginning","_yAxis","axisBoldPeriodBeginning"),o.prototype.publishProxy("xAxisDashLength","_xAxis","axisDashLength"),o.prototype.publishProxy("yAxisDashLength","_yAxis","axisDashLength"),o.prototype.publishProxy("xAxisFillAlpha","_xAxis","axisFillAlpha"),o.prototype.publishProxy("yAxisFillAlpha","_yAxis","axisFillAlpha"),o.prototype.publishProxy("xAxisFillColor","_xAxis","axisFillColor"),o.prototype.publishProxy("yAxisFillColor","_yAxis","axisFillColor"),o.prototype.publishProxy("xAxisGridAlpha","_xAxis","axisGridAlpha"),o.prototype.publishProxy("yAxisGridAlpha","_yAxis","axisGridAlpha"),o.prototype.publishProxy("xAxisTypeTimePattern","_xAxis","axisTypeTimePattern"),o.prototype.publishProxy("yAxisTypeTimePattern","_yAxis","axisTypeTimePattern"),o.prototype.publishProxy("xAxisType","_xAxis","axisType"),o.prototype.publishProxy("yAxisType","_yAxis","axisType"),o.prototype.publishProxy("xAxisTickFormat","_xAxis","axisTickFormat"),o.prototype.publishProxy("yAxisTickFormat","_yAxis","axisTickFormat"),o.prototype._origBackwardsCompatible=o.prototype.backwardsCompatible,o.prototype.backwardsCompatible=function(t){var e=o.prototype._origBackwardsCompatible.apply(this,arguments);return arguments.length&&this.switchProperties(t),e},o.prototype.switchProperties=function(t){t===!0?o.prototype.excludeObjs=["amchart_SerialAxis"]:o.prototype.excludeObjs=[]},o.prototype.xAxis=function(t){if(!this.xAxes()[t]){var e=new r;e._owningWidget=this,this.xAxes()[t]=e}return this.xAxes()[t]},o.prototype.yAxis=function(t){if(!this.yAxes()[t]){var e=new r;e._owningWidget=this,this.yAxes()[t]=e}return this.yAxes()[t]},o.prototype.formatData=function(t){switch(this.xAxes()[0].axisType()){case"time":return this.xAxes()[0]._parser("number"==typeof t?t.toString():t);default:return t}},o.prototype.formatValue=function(t){if(!t)return t;if(t instanceof Array)return t.map(function(t){return this.formatValue(t)},this);switch(this.yAxes()[0].axisType()){case"time":return this.yAxes()[0]._parser("number"==typeof t?t.toString():t);default:return"string"==typeof t?+t:t}},o.prototype.amFormatData=function(t){this._rangeType=null;var e=[],i=this;if(t.forEach(function(t){var a={};t.forEach(function(t,e){var s=i.columns()[e];if(t instanceof Array){var r=e-1;2===t.length?(a["openField"+r]=i.formatValue(t[0]),a["valueField"+r]=i.formatValue(t[1]),i._rangeType="normal"):(a["lowField"+r]=i.formatValue(t[0]),a["openField"+r]=i.formatValue(t[1]),a["closeField"+r]=i.formatValue(t[2]),a["highField"+r]=i.formatValue(t[3]),i._rangeType="candle-ohlc")}else 0===e?a[s]=i.formatData(t):e>=i.columns().length?a[s]=t:a[s]=i.formatValue(t)}),a.__origRow=t,e.push(a)}),"time"===this.xAxisType()){var a=i.columns()[0];e.sort(function(t,e){return t[a]-e[a]}),this.data(e.map(function(t){var e=t.__origRow;return delete t.__origRow,e}))}return e},o.prototype.updateChartOptions=function(){var e=this;this._chart.type="serial",this._chart.startDuration=this.startDuration(),this._chart.rotate="vertical"===this.orientation(),this._chart.color=this.fontColor(),this._chart.fontSize=this.fontSize(),this._chart.fontFamily=this.fontFamily(),this._chart.categoryAxis={};var a=this.xAxes()[0];switch(this._chart.categoryAxis.position=a.position()?a.position():"bottom",this._chart.categoryAxis.autoGridCount=a.axisAutoGridCount(),this._chart.categoryAxis.gridPosition=a.axisGridPosition(),this._chart.categoryAxis.axisAlpha=a.axisAlpha(),this._chart.categoryAxis.gridAlpha=a.axisGridAlpha(),this._chart.categoryAxis.startOnAxis=a.startOnAxis(),this._chart.categoryAxis.labelRotation=a.axisLabelRotation(),this._chart.categoryAxis.title=a.axisTitle(),this._chart.categoryAxis.axisColor=a.axisBaselineColor(),this._chart.categoryAxis.axisThickness=a.axisLineWidth(),this._chart.categoryAxis.boldPeriodBeginning=a.axisBoldPeriodBeginning(),this._chart.categoryAxis.dashLength=a.axisDashLength(),this._chart.categoryAxis.fillAlpha=a.axisFillAlpha(),this._chart.categoryAxis.fillColor=a.axisFillColor(),this._chart.categoryAxis.fontSize=a.axisFontSize(),this._chart.categoryAxis.color=a.axisFontColor(),this._chart.categoryAxis.titleColor=a.axisTitleFontColor(),this._chart.categoryAxis.titleFontSize=a.axisTitleFontSize(),this._chart.categoryAxis.showFirstLabel=this.showFirstLabel(),this._chart.categoryAxis.showLastLabel=this.showLastLabel(),this._chart.categoryAxis.equalSpacing=this.equalSpacing(),a.axisType()){case"time":this._chart.categoryAxis.parseDates=!0,this._chart.categoryAxis.minPeriod=this.axisMinPeriod()?this.axisMinPeriod():void 0,this._chart.categoryAxis.logarithmic=!1,a.axisTickFormat()?this.dataFormatter=t.time.format(a.axisTickFormat()):a.axisTypeTimePattern()?this.dataFormatter=t.time.format(a.axisTypeTimePattern()):this.dataFormatter=function(t){return t};break;case"log":this._chart.categoryAxis.parseDates=!1,this._chart.categoryAxis.logarithmic=!0,this.dataFormatter=a.axisTickFormat()?t.format(a.axisTickFormat()):function(t){return t};break;case"linear":default:this._chart.categoryAxis.parseDates=!1,this._chart.categoryAxis.logarithmic=!1,this.dataFormatter=a.axisTickFormat()?t.format(a.axisTickFormat()):function(t){return t}}this._chart.categoryAxis.labelFunction=function(t,i,s){switch(a.axisType()){case"time":return e.dataFormatter(a.axisTickFormat()||a.axisTypeTimePattern()?new Date(i):i);default:return e.dataFormatter(t)}};for(var s=0;s<this.yAxes().length;s++){var r=this.yAxes()[s];switch(this._chart.valueAxes[s]||this._chart.valueAxes.push(new i.ValueAxis),this._chart.valueAxes[s].id="v"+s,this._chart.valueAxes[s].position=r.position()?r.position():"left",this._chart.valueAxes[s].title=r.axisTitle(),this._chart.valueAxes[s].titleColor=r.axisTitleFontColor(),this._chart.valueAxes[s].titleFontSize=r.axisTitleFontSize(),this._chart.valueAxes[s].axisThickness=r.axisLineWidth(),this._chart.valueAxes[s].color=r.axisFontColor(),this._chart.valueAxes[s].fontSize=r.axisFontSize(),this._chart.valueAxes[s].axisColor=r.axisBaselineColor(),this._chart.valueAxes[s].axisAlpha=r.axisAlpha(),this._chart.valueAxes[s].fillColor=r.axisFillColor(),this._chart.valueAxes[s].fillAlpha=r.axisFillAlpha(),this._chart.valueAxes[s].gridAlpha=r.axisGridAlpha(),this._chart.valueAxes[s].dashLength=r.axisDashLength(),this._chart.valueAxes[s].boldPeriodBeginning=r.axisBoldPeriodBeginning(),this._chart.valueAxes[s].autoGridCount=r.axisAutoGridCount(),r.axisType()){case"time":this._chart.valueAxes[s].type="date",this._chart.valueAxes[s].parseDates=!0,this._chart.valueAxes[s].minPeriod=this.axisMinPeriod()?this.axisMinPeriod():void 0,this._chart.valueAxes[s].logarithmic=!1,r.axisTickFormat()?this.valueFormatter=t.time.format(r.axisTickFormat()):r.axisTypeTimePattern()?this.valueFormatter=t.time.format(r.axisTypeTimePattern()):this.valueFormatter=function(t){return t};break;case"log":this._chart.valueAxes[s].parseDates=!1,this._chart.valueAxes[s].logarithmic=!0,this._chart.valueAxes[s].type="numeric",this.valueFormatter=r.axisTickFormat()?t.format(r.axisTickFormat()):function(t){return t};break;case"linear":default:this._chart.valueAxes[s].parseDates=!1,this._chart.valueAxes[s].type="numeric",this._chart.valueAxes[s].logarithmic=!1,this.valueFormatter=r.axisTickFormat()?t.format(r.axisTickFormat()):function(t){return t}}this._chart.valueAxes[s].labelFunction=function(t,i,a){switch(r.axisType()){case"time":return e.valueFormatter(r.axisTickFormat()||r.axisTypeTimePattern()?new Date(i):i);default:return e.valueFormatter(t)}}}this.showScrollbar()?this._chart.chartScrollbar.enabled=!0:this._chart.chartScrollbar.enabled=!1,this.showCursor()?(this._chart.chartCursor.enabled=!0,this._chart.chartCursor.valueLineEnabled=!0,this._chart.chartCursor.valueLineBalloonEnabled=!0,this._chart.chartCursor.categoryBalloonEnabled=!0):(this._chart.chartCursor.enabled=!1,this._chart.chartCursor.valueLineEnabled=!1,this._chart.chartCursor.valueLineBalloonEnabled=!1,this._chart.chartCursor.categoryBalloonEnabled=!1),this._currXAxisTypes=this.xAxes().map(function(t){return t.axisType()}).toString(),this._currYAxisTypes=this.yAxes().map(function(t){return t.axisType()}).toString(),this._currXAxisTypeTimePatterns=this.xAxes().map(function(t){return t.axisTypeTimePattern()}).toString(),this._currYAxisTypeTimePatterns=this.yAxes().map(function(t){return t.axisTypeTimePattern()}).toString(),(this._dataUpdated>this._prevDataUpdated||this._prevYAxisType!==this._currYAxisTypes||this._prevXAxisType!==this._currXAxisTypes||this._prevXAxisTypeTimePattern!==this._currXAxisTypeTimePatterns||this._prevYAxisTypeTimePattern!==this._currYAxisTypeTimePatterns||this.paletteGrouping&&this._prevPaletteGrouping!==this.paletteGrouping()||this._columnsUpdated>this._prevColumnsUpdated)&&(this._chart.dataProvider=this.amFormatData(this.data())),this._chart.dataProvider=this.amFormatData(this.data()),this._prevDataUpdated=this._dataUpdated,this._prevColumnsUpdated=this._columnsUpdated,this._prevXAxisTypes=this._currXAxisTypes,this._prevYAxisTypes=this._currYAxisTypes,this._prevXAxisTypeTimePatterns=this._currXAxisTypeTimePatterns,this._prevYAxisTypeTimePatterns=this._currXAxisTypeTimePatterns,this.paletteGrouping&&(this._prevPaletteGrouping=this.paletteGrouping()),this.amFormatColumns(),a.axisAutoGridCount()===!1&&this.xAxisShowAllLabels()&&(this._chart.categoryAxis.gridCount=this._chart.dataProvider.length);var o,l;return this._chart.colors=[],-1!==e._class.indexOf("amchart_Area")&&(l="Area"),this._chart.dataProvider.forEach(function(t,i){e.columns().filter(function(t,e){return e>0}).forEach(function(t,a){o="By Category"===e.paletteGrouping()?e._palette(i):e._palette(t),e._chart.colors.push(o),e._chart.dataProvider[i]["color"+a]=o,"Area"!==l&&(e._chart.dataProvider[i]["linecolor"+a]=e.lineColor()?e.lineColor():o),void 0===e._colorObj[i]&&(e._colorObj[i]={}),e._colorObj[i][a]={color:o,lineColor:e.lineColor()?e.lineColor():o}})}),this._chart},o.prototype.buildGraphObj=function(t,e){var i=this,a={};a.id="g"+e,-1!==this.y2().indexOf(e)?a.valueAxis="v1":a.valueAxis="v0",a.balloonFunction=function(t,e){var i=e.valueField,a=e.chart.dataProvider;return t.category+", "+i+": "+a[t.index][i]},a.lineAlpha=i.lineOpacity(),a.lineColor=i.lineColor(),a.lineThickness=i.lineWidth(),a.dashLength=i.dashedLineStyle(),a.type=t,a.title="";var s=["value","open","close","high","low"];s.forEach(function(t){"undefined"!=typeof i["_"+t+"Field"]&&"undefined"!=typeof i["_"+t+"Field"][e]&&(a[t+"Field"]=i["_"+t+"Field"][e])});try{if(i.useImgPatterns()){var r=JSON.parse(i.imgPatternArr());"undefined"!=typeof r[e]&&(a.pattern=r[e])}else a.pattern=""}catch(o){console.log("e:"),console.log(o)}return a.colorField="color"+e,a.lineColorField="linecolor"+e,a.fillColorsField="fillcolor"+e,a},o.prototype.amFormatColumns=function(t){return this._categoryField=this.columns()[0],this._chart.categoryField=this.columns()[0],this._openField=[],this._closeField=[],this._valueField=this.columns().slice(1),this},o.prototype.enter=function(t,s){if(e.prototype.enter.apply(this,arguments),0===this.xAxes().length&&this.xAxes().push(this._xAxis),0===this.yAxes().length&&this.yAxes().push(this._yAxis),this.y2().length&&1===this.yAxes().length){var o=new r;o.owningWidget=this,this.yAxes().push(o)}var l=this,n={type:"serial",addClassNames:!0,chartScrollbar:{},chartCursor:{enabled:!1,valueLineEnabled:!1,valueLineBalloonEnabled:!1,categoryBalloonEnabled:!1,cursorAlpha:0,valueLineAlpha:.2,oneBalloonOnly:!0,balloonPointerOrientation:"vertical",valueBalloonsEnabled:!1}};"function"==typeof define&&define.amd&&(n.pathToImages=a.toUrl("amcharts-images")),this._chart=i.makeChart(t,n),this._chart.addListener("clickGraphItem",function(t){var e,i,a=t.graph,s=a.valueField,r=t.item.dataContext;if("column"===l._gType?(e=a.fillColorsField,i=a.lineColorField):"line"===l._gType?e=a.colorField:"area"===l._gType&&(e=a.colorField),e){var o=l._selected&&l._selected.dIdx===t.index&&l._selected.column===s;null!==l._selected&&(delete l._selected.data[l._selected.field],l._selected.field2&&(l._selected.data[l._selected.field2]=l._colorObj[l._selected.dIdx][l._selected.cIdx].lineColor),l._selected=null),o||(r[e]=l.selectionColor(),i&&(r[i]=l.selectionColor()),"simple"===l.selectionMode()&&(null!==l._selected&&(delete l._selected.data[l._selected.field],l._selected.field2&&(l._selected.data[l._selected.field2]=l._colorObj[l._selected.dIdx][l._selected.cIdx].lineColor)),l._selected={field:e,field2:i,data:r,dIdx:t.index,column:s,cIdx:t.target.columnIndex},l._selections.push(l._selected))),t.chart.validateData()}l.click(l.rowToObj(l.data()[t.index]),s,null!==l._selected)})},o.prototype.update=function(t,i){e.prototype.update.apply(this,arguments);var a=this;this.yAxes().forEach(function(t,e){0===e&&(a._yAxis=t),t._owningWidget=a}),this.xAxes().forEach(function(t,e){0===e&&(a._xAxis=t),t._owningWidget=a}),this.backwardsCompatible()?this.switchProperties(!0):this.switchProperties(!1),t.style.width=this.size().width+"px",t.style.height=this.size().height+"px",this._palette=this._palette["switch"](this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id()))},o.prototype.render=function(t){return e.prototype.render.apply(this,arguments)},o.prototype.data=function(t){return arguments.length&&this._dataUpdated++,e.prototype.data.apply(this,arguments)},o.prototype.columns=function(t){return arguments.length&&this._columnsUpdated++,e.prototype.columns.apply(this,arguments)},o});