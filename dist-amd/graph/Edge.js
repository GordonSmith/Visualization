!function(t,e){"function"==typeof define&&define.amd?define(["d3","../common/SVGWidget","../common/TextBox","css!./Edge"],e):t.graph_Edge=e(t.d3,t.common_SVGWidget,t.common_TextBox)}(this,function(t,e,r){function i(){e.call(this),this._points=[],this._weight=100,this._strokeDasharray=null,this._hidden=!1,this._textBox=(new r).padding(0)}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype._class+=" graph_Edge",i.prototype.publish("arcDepth",16,"number","Arc Depth",null,{tags:["Basic"]}),i.prototype.publish("tooltip","","string","Tooltip",null,{tags:["Private"]}),i.prototype.sourceVertex=function(t){return arguments.length?(this._sourceVertex=t,this):this._sourceVertex},i.prototype.targetVertex=function(t){return arguments.length?(this._targetVertex=t,this):this._targetVertex},i.prototype.sourceMarker=function(t){return arguments.length?(this._sourceMarker=t,this):this._sourceMarker},i.prototype.targetMarker=function(t){return arguments.length?(this._targetMarker=t,this):this._targetMarker},i.prototype.weight=function(t){return arguments.length?(this._weight=t,this):this._weight},i.prototype.strokeDasharray=function(t){return arguments.length?(this._strokeDasharray=t,this):this._strokeDasharray},i.prototype.points=function(t,e,r){return arguments.length?(this._points=t,this._elementPath&&this.update(null,this._element,e,r),this):this._points},i.prototype.hidden=function(t){return arguments.length?(this._hidden=t,this):this._hidden},i.prototype.text=function(t){return arguments.length?(this._textBox.text(t),this):this._textBox.text()},i.prototype.enter=function(t,r){e.prototype.enter.apply(this,arguments),this._elementPath=r.append("path"),this._tooltipElement=this._elementPath.append("title"),this._sourceMarker&&this._elementPath.attr("marker-start","url(#"+this._sourceMarker+")"),this._targetMarker&&this._elementPath.attr("marker-end","url(#"+this._targetMarker+")"),this._textBox.text()&&this._textBox.target(t).tooltip(this.tooltip()).render()},i.prototype.update=function(r,i,n,o){e.prototype.update.apply(this,arguments);var s=this;this.svgMarkerGlitch&&!o&&i.transition().duration((n?n:0)+100).each("start",function(t){s._pushMarkers(i,t)}).each("end",function(t){s._popMarkers(i,t)});var h=s._calculateEdgePoints(this._sourceVertex,this._targetVertex,this._points),a="";if(this._points.length||n,0){var p=h[2].x-h[0].x,u=h[2].y-h[0].y,l=2*Math.sqrt(p*p+u*u);a="M"+h[0].x+","+h[0].y+"A"+l+","+l+" 0 0,1 "+h[2].x+","+h[2].y}else a=t.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("bundle").tension(.75)(h);var _=this._elementPath;n&&(_=_.transition().duration(n)),_.attr("opacity",this._hidden?0:1).attr("stroke-dasharray",this._strokeDasharray).attr("d",a),this._tooltipElement.text(this.tooltip()),this._textBox.text()&&this._textBox.tooltip(this.tooltip()).move(this._findMidPoint(h),n)},i.prototype._findMidPoint=function(t){var e=t.length/2;if(t.length%2)return t[Math.floor(e)];if(t.length){var r=t[e-1],i=t[e];return{x:(r.x+i.x)/2,y:(r.y+i.y)/2}}return{x:0,y:0}},i.prototype._calculateEdgePoints=function(t,e,r){if(!t||!e)return[{x:0,y:0},{x:0,y:0}];var i=r?r.slice():[],n=0===i.length?e.pos():i[0],o=0===i.length?t.pos():i[i.length-1];if(i.unshift(t.intersection(t._pos,n)),i.push(e.intersection(e._pos,o)),i[0]||(i[0]=t._pos),i[i.length-1]||(i[i.length-1]=e._pos),2===i.length&&i[0]&&i[1]){var s=i[0].x-i[1].x,h=i[0].y-i[1].y,a=Math.sqrt(s*s+h*h);if(a){var p=(i[0].x+i[1].x)/2-h*this.arcDepth()/100,u=(i[0].y+i[1].y)/2+s*this.arcDepth()/100;i=[{x:i[0].x,y:i[0].y},{x:p,y:u},{x:i[1].x,y:i[1].y}]}}return i},i});