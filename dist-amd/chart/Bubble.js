!function(t,e){"function"==typeof define&&define.amd?define(["d3","../common/SVGWidget","../api/I2DChart","../common/Text","../common/FAChar","../common/Utility","../api/ITooltip","css!./Bubble"],e):t.chart_Bubble=e(t.d3,t.common_SVGWidget,t.api_I2DChart,t.common_Text,t.common_FAChar,t.common_Utility,t.api_ITooltip)}(this,function(t,e,i,o,n,r,a){function l(o){e.call(this),i.call(this),a.call(this),this._drawStartPos="origin",this.labelWidgets={},this.d3Pack=t.layout.pack().sort(function(t,e){return e>t?-1:t>e?1:0}).size([this.width(),this.height()]).value(function(t){return t[1]})}return l.prototype=Object.create(e.prototype),l.prototype.constructor=l,l.prototype._class+=" chart_Bubble",l.prototype["implements"](i.prototype),l.prototype["implements"](a.prototype),l.prototype.publish("paletteID","default","set","Palette ID",l.prototype._palette["switch"](),{tags:["Basic","Shared"]}),l.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),l.prototype.size=function(t){var i=e.prototype.size.apply(this,arguments);return arguments.length&&this.d3Pack.size([this.width(),this.height()]),i},l.prototype.enter=function(t,i){e.prototype.enter.apply(this,arguments),this._selection=new r.SimpleSelection(i);var o=this;this.tooltipHTML(function(t){return o.tooltipFormat({label:t[0],value:t[1]})})},l.prototype.update=function(e,i){var r=this;this._palette=this._palette["switch"](this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id()));var a=i.selectAll(".node").data(this.data().length?this.d3Pack.nodes({children:this.cloneData()}).filter(function(t){return!t.children}):[],function(t){return t[0]});a.enter().append("g").attr("class","node").attr("opacity",0).call(this._selection.enter.bind(this._selection)).on("click",function(t){r.click(r.rowToObj(t),r.columns()[1],r._selection.selected(this))}).each(function(e){var i=t.select(this);i.append("circle").attr("r",function(t){return t.r}).on("mouseout.tooltip",r.tooltip.hide).on("mousemove.tooltip",r.tooltip.show),e.__viz_faChar?r.labelWidgets[e[0]]=(new n)["char"](e.__viz_faChar).target(this).render():r.labelWidgets[e[0]]=(new o).text(e[0]).target(this).render()}),a.transition().attr("opacity",1).each(function(e){var i=t.select(this),o={x:e.x,y:e.y};if(i.select("circle").transition().attr("transform",function(t){return"translate("+o.x+","+o.y+")"}).style("fill",function(t){return r._palette(t[0])}).attr("r",function(t){return t.r}).select("title").text(function(t){return t[0]+" ("+t[1]+")"}),e.__viz_faChar)r.labelWidgets[e[0]].pos(o).render();else{var n=e[0],a=r.labelWidgets[e[0]].getBBox().width;2*e.r<16?n="":2*e.r<a&&(n=n[0]+"..."),r.labelWidgets[e[0]].pos(o).text(n).render()}}),a.exit().transition().style("opacity",0).remove()},l.prototype.exit=function(t,i){e.prototype.enter.apply(this,arguments),delete this._selection},l});